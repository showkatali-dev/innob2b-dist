import{P as F,r as A,j as e,ag as Ye,ah as He,s as D,ai as de,aj as ze,e as J,d as ee,a7 as te,ak as Z,k as re,al as Ge,am as Ke,an as Je,I as q,ao as Qe,ap as We,b as K,aq as Xe,ar as we,V as Ze,as as xe,X as Ce,at as es,v as me,au as ss,av as as,aw as ts,ax as rs,af as he,ay as ns,a9 as oe,g as ie,az as ls,aA as cs,aB as is,aC as le,aD as os,aE as ds,aF as Ne,aG as _e,aH as ye,aI as us,aJ as xs,aK as ms,aL as hs,L as ps,aM as ve,aN as bs,aO as js,aP as gs,aQ as fs,J as Ns,ab as _s,H as ys}from"./index.js";import{G as vs}from"./index.esm3.js";import{S as ws,U as Cs,a as ks,R as Ss,f as Ts,M as Fs}from"./navigation2.js";import{w as ke}from"./sweetalert2-react-content.es.js";import{c as Se,d as Te,e as Is}from"./index.esm.js";import{I as As}from"./InputDate.js";import{S as Es,N as Bs,a as G}from"./navigation.js";import{R as Ms}from"./RefundData.js";import{b as Us,c as $s}from"./index.esm2.js";import{S as ue}from"./SingleSelect.js";import{I as Os}from"./InputDateWithTime.js";import{I as Rs,C as Ls,G as Vs}from"./GetPriceAlertModal.js";import{S as qs,a as Ds}from"./SendBookingPayLinkModal.js";import"./pp.js";import"./PhoneNumberSelect.js";import"./shortcut-buttons-flatpickr.min.js";const Fe=({passenger:a})=>{const[l,s]=A.useState(!1);return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>s(!0),className:"normal-case border-transparent rounded shadow-sm shadow-primary/50 btn btn-primary btn-outline btn-xs",children:[e.jsx(Ye,{className:"text-base"})," Update Doc"]}),e.jsx(ws,{passenger:a,isOpenScanPassportModal:l,setIsOpenScanPassportModal:s})]})};Fe.propTypes={passenger:F.object.isRequired};const Ie=({passenger:a})=>{const[l,s]=A.useState(!1);return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>s(!0),className:"normal-case border-transparent rounded shadow-sm shadow-primary/50 btn btn-primary btn-outline btn-xs",children:[e.jsx(He,{className:"text-base"})," Update Contact"]}),e.jsx(Cs,{passenger:a,isOpenContactModal:l,setIsOpenContactModal:s})]})};Ie.propTypes={passenger:F.object.isRequired};const Ae=({booking_details:a,can_modify:l,pax_id:s,refetchData:j})=>{var f,S,w,x,i;const{member_id:d}=((f=J.useState())==null?void 0:f.user_data)||{},[v,n]=A.useState({tracking_id:(a==null?void 0:a.tracking_id)||"",member_id:d,passenger:((w=(S=a==null?void 0:a.pax)==null?void 0:S.data)==null?void 0:w.map(c=>({pax_id:c==null?void 0:c.pax_id,ticket_number:c==null?void 0:c.ticket_number})))||[]}),[h,r]=A.useState(!1),[u,g]=A.useState(null),{axiosInstance:_}=ee(),C=async c=>{var T,p,m;if(c.preventDefault(),!h){g(null),r(!0);try{const N=await _.post("/flight/update-booking-info",v);if(((T=N.data)==null?void 0:T.status)==="success")te.close(),j(),re("success","Success!",(p=N.data)==null?void 0:p.reason);else throw new Error((m=N==null?void 0:N.data)==null?void 0:m.reason)}catch(N){console.error(N),g(N.message)}finally{r(!1)}}};return e.jsxs("form",{onSubmit:C,className:"relative px-6 pt-4 text-start",children:[e.jsx("h3",{className:"pb-2 text-lg font-semibold",children:"Update Ticket Number"}),e.jsx("hr",{className:"mb-4"}),u&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 py-1 pl-4 mx-auto border border-l-4 rounded-r border-warning text-warning w-fit",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(Se,{})}),e.jsx("div",{className:"text-sm",children:u})]}),e.jsx("button",{onClick:()=>g(null),className:"btn btn-ghost btn-circle btn-sm text-error hover:bg-transparent hover:text-red-500",children:e.jsx(Te,{})})]})}),e.jsx("div",{className:"flex flex-col gap-5",children:(l==null?void 0:l.ticket_number)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Ticket Number"}),e.jsx("input",{type:"text",name:"supplier_confirmation_id",className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:((i=(x=v==null?void 0:v.passenger)==null?void 0:x.find(c=>c.pax_id===s))==null?void 0:i.ticket_number)||"",onChange:c=>n(T=>{var p;return{...T,passenger:(p=T==null?void 0:T.passenger)==null?void 0:p.map(m=>(m.pax_id===s&&(m.ticket_number=c.target.value),m))}})})]})}),e.jsxs("div",{className:"flex justify-end gap-4 mt-5",children:[e.jsx("button",{onClick:()=>te.close(),type:"button",className:"h-10 min-h-0 normal-case rounded-md btn btn-primary btn-outline",children:"Close"}),e.jsx("button",{type:"submit",className:"h-10 min-h-0 normal-case rounded-md btn btn-primary",children:h?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"animate-spin"})," Updating..."]}):e.jsx(e.Fragment,{children:"Update"})})]})]})};Ae.propTypes={booking_details:F.object.isRequired,can_modify:F.object,pax_id:F.string,refetchData:F.func};const Ee=({booking_details:a,pax_id:l})=>{var h;const{can_modify:s}=((h=D.useState())==null?void 0:h.booking_manage)||{},j=ke(te),d=de(),v=()=>{d.invalidateQueries(["FLIGHT_BOOKING_DETAILS"])},n=()=>{j.fire({html:e.jsx(Ae,{booking_details:a,can_modify:s,refetchData:v,pax_id:l}),showConfirmButton:!1,showCloseButton:!0,customClass:{popup:"w-full max-w-sm",htmlContainer:"!m-0",closeButton:"text-red-500"}})};return(s==null?void 0:s.ticket_number)==="NO"?null:e.jsxs("button",{onClick:n,className:"mt-3 normal-case border-transparent rounded shadow-sm shadow-primary/50 btn btn-primary btn-outline btn-xs",children:[e.jsx(ze,{className:"text-base"})," Update Ticket No."]})};Ee.propTypes={booking_details:F.object.isRequired,pax_id:F.string};const Be=({route:a})=>{var T,p,m,N,I,U,B,M;const{system_config:l}=D.useState(),{pathname:s}=Ge(),{lay_over:j,operating:{carrier_name:d,carrier:v,flight_number:n,carrier_logo:h},aircraft:{name:r},departure_time:u,origin_airport:{name:g,city:_},origin_terminal:C,arrival_time:f,destination_airport:{name:S,city:w},destination_terminal:x,baggages:i,booking_class:c}=a;return e.jsxs("div",{children:[j&&j!=="not-applicable"&&e.jsxs("div",{className:"flex items-center justify-center my-5",children:[e.jsx("hr",{className:"w-12"}),e.jsx("div",{className:"p-2 rounded-lg bg-[#f4f4f4]",children:e.jsxs("p",{className:"text-xs text-center",children:[e.jsx("span",{className:"font-bold text-[#dfa33a]",children:"Change of Airport"})," ","• Change of planes • ",Ke(j)," layover in"," ",g]})}),e.jsx("hr",{className:"w-12"})]}),e.jsxs("div",{className:"flex flex-wrap justify-between gap-x-4",children:[e.jsxs("div",{className:"relative flex gap-3 mb-4 w-fit",children:[e.jsx("img",{className:"border rounded-full w-[2.4rem] h-[2.4rem]",src:`https://gtrs-airlineimages.s3.ap-southeast-1.amazonaws.com/icon/${h}`,alt:""}),e.jsxs("h6",{className:"font-medium",children:[d," ",e.jsxs("span",{className:"text-[#9BA0B2]",children:[v," | ",n]})]}),s!=="/booking-details/flight"&&(c==null?void 0:c.seat_available)&&!!Number(c==null?void 0:c.seat_available)&&e.jsxs("div",{className:"absolute flex items-center gap-1 py-1 pl-6 pr-3 text-xs font-light text-white -right-4 bg-secondary bg-gradient-to-r from-secondary-focus to-secondary w-fit h-fit",children:[e.jsxs("span",{children:[e.jsx(Je,{className:"mr-1 text-base"}),"Seat Left:"]})," ",e.jsx("span",{children:c==null?void 0:c.seat_available}),e.jsx("span",{className:"absolute top-0 left-0 h-0 border-y-[12px] border-x-[12px] border-transparent border-l-white"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex gap-2 text-xs text-secondary/80",children:e.jsxs("p",{className:"font-medium mr-0.5",children:[e.jsx(q,{path:Qe,size:.8,className:"mr-1"})," Aircraft:"," ",r]})}),e.jsx("div",{className:"flex gap-2 text-xs text-yellow-500/80",children:e.jsxs("p",{className:"font-medium mr-0.5",children:[e.jsx(We,{className:"mr-1 text-base"})," Cabin Class:"," ",e.jsx("span",{className:"capitalize",children:c.cabin_class})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4 gap-y-8",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-2xl font-semibold",children:u.substring(11,16)}),e.jsx("p",{className:"text-sm font-medium",children:K(u.substring(0,10)).format(l.default_date_format_print)}),e.jsx("p",{className:"text-xs text-neutral",children:_}),e.jsx("p",{className:"text-xs text-neutral",children:g}),C&&e.jsxs("p",{className:"text-xs text-neutral/70",children:["Terminal ",C]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 text-center h-fit",children:[e.jsx("p",{className:"pb-1 border-b-2 border-primary w-fit text-[#9BA0B2] text-sm",children:Xe(a.departure_time,a.arrival_time)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 text-xs text-primary/70",children:[e.jsxs("p",{className:"font-medium mr-0.5",children:[e.jsx(we,{className:"mr-1"}),"Baggage:"]}),e.jsxs("p",{children:[e.jsx(Ze,{})," ",(p=(T=i==null?void 0:i.checked)==null?void 0:T.ADT)!=null&&p.title?i.checked.ADT.title:"0 pieces"]}),((N=(m=i==null?void 0:i.checked)==null?void 0:m.CNN)==null?void 0:N.title)&&e.jsxs("p",{children:[e.jsx(xe,{})," ",i.checked.CNN.title]}),((U=(I=i==null?void 0:i.checked)==null?void 0:I.INF)==null?void 0:U.title)&&e.jsxs("p",{children:[e.jsx(Ce,{})," ",i.checked.INF.title]})]}),e.jsxs("div",{className:"flex gap-2 text-xs text-secondary/80",children:[e.jsxs("p",{className:"font-medium mr-0.5",children:[e.jsx(es,{className:"mr-1"}),"Hand Baggage:"," ",i!=null&&i.carry_on?i.carry_on.ADT.title:"7 kg*"]}),e.jsxs("p",{children:[e.jsx(xe,{})," ",((M=(B=i==null?void 0:i.carry_on)==null?void 0:B.CNN)==null?void 0:M.title)||"7 kg*"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-2xl font-semibold",children:f.substring(11,16)}),e.jsx("p",{className:"text-sm font-medium",children:K(f.substring(0,10)).format(l.default_date_format_print)}),e.jsx("p",{className:"text-xs text-neutral",children:w}),e.jsx("p",{className:"text-xs text-neutral",children:S}),x&&e.jsxs("p",{className:"text-xs text-neutral/70",children:["Terminal ",x]})]})]})]})};Be.propTypes={route:F.object.isRequired};const Me=({flight_group:a})=>{const{system_config:l}=D.useState();return e.jsx("div",{className:"border rounded-lg",children:a==null?void 0:a.map(s=>e.jsxs("div",{children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("h6",{className:"font-medium",children:[s.routes[0].origin_airport.city," to"," ",s.routes.at(-1).destination_airport.city,","," ",K(s.routes[0].departure_time).format(l.default_date_format_print)]})}),e.jsx("div",{className:"p-3",children:s.routes.map(j=>e.jsx(Be,{route:j},me()))})]},me()))})};Me.propTypes={flight_group:F.array.isRequired};const Ue=({booking_details:a,isImportGDSPNR:l})=>{const{general:{booking_id:s,airlines_pnr:j,supplier_confirmation_id:d},booking:{booking_status:v},flight:{search_parameter:n,flight_group:h},pax:{data:r},terms:u,cancellation_terms:g}=a,{booking_manage:_}=D.useState(),{flight_update_baggage:C,flight_update_contacts:f,flight_update_doc:S,flight_update_meal:w,flight_update_seat:x}=_||{},i=window.location.origin;return e.jsxs("div",{className:"tab-pane",children:[e.jsx("div",{className:"w-full mb-5 overflow-x-auto",children:e.jsxs("table",{className:"table text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"p-2 bg-neutral/5 text-info",children:[!l&&e.jsx("th",{className:"text-sm text-center border",children:"Booking Id"}),e.jsx("th",{className:"text-sm text-center border",children:"Airlines PNR"}),e.jsx("th",{className:"text-sm text-center border",children:"Order Id (GDS PNR)"}),e.jsx("th",{className:"text-sm text-center border",children:"Booking Class"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[!l&&e.jsx("td",{className:"text-center border",children:s}),e.jsx("td",{className:"text-center border",children:j}),e.jsx("td",{className:"text-center border",children:d}),e.jsx("td",{className:"text-center border",children:n.booking_class})]})})]})}),e.jsx("div",{className:"mb-5",children:e.jsx(Me,{flight_group:h})}),e.jsxs("div",{className:"mb-5 border rounded",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h4",{className:"font-semibold",children:"Traveler Details"})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("table",{className:"table text-sm table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-sm border-b",children:"PASSENGER NAME"}),e.jsx("th",{className:"text-sm border-b",children:"BAGGAGE"}),e.jsx("th",{className:"text-sm border-b",children:"SEATS"}),e.jsx("th",{className:"text-sm border-b",children:"MEAL"})]})}),e.jsx("tbody",{children:r.map(c=>e.jsxs("tr",{className:"border-b-0",children:[e.jsxs("td",{className:"align-top",children:[e.jsx("div",{children:e.jsx("div",{className:"rounded badge badge-secondary",children:c.pax_type==="ADT"?e.jsxs(e.Fragment,{children:[e.jsx(ss,{})," Adult"]}):c.pax_type==="CNN"?e.jsxs(e.Fragment,{children:[e.jsx(xe,{})," Child"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{})," Infant"]})})}),e.jsxs("h2",{className:"text-lg font-semibold",children:[c.title," ",c.first_name," ",c.last_name]}),e.jsxs("p",{children:["Passport No: ",c.doc_no]}),e.jsxs("p",{children:["Passport Expire: ",c.doc_dateofexpiry]}),e.jsxs("p",{children:["Passport Country:"," ",e.jsx("img",{src:`${i}/flags/${c.doc_country}.jpg`,alt:"SG",className:"inline",style:{height:"13px"}})," ",c.doc_country]}),e.jsxs("p",{children:["Date of Birth: ",c.dob]}),(c==null?void 0:c.ticket_number)&&e.jsxs("p",{children:["Ticket No: ",c.ticket_number]}),!l&&e.jsx(e.Fragment,{children:(v==="confirm"||v==="hold")&&e.jsxs(e.Fragment,{children:[(S==null?void 0:S.toUpperCase())==="ACTIVE"&&e.jsx(Fe,{passenger:c}),(f==null?void 0:f.toUpperCase())==="ACTIVE"&&e.jsx(Ie,{passenger:c}),e.jsx(Ee,{booking_details:a,pax_id:c==null?void 0:c.pax_id})]})})]}),e.jsxs("td",{children:[e.jsx("p",{children:"Baggage Allowance (Included Baggage):"}),h==null?void 0:h.map(T=>{var p;return(p=T==null?void 0:T.routes)==null?void 0:p.map((m,N)=>{var I,U,B,M,O,y,o,t,$,k,R,L,b,P,V;return e.jsxs("div",{className:"mb-1",children:[e.jsxs("h6",{children:[e.jsx("strong",{children:m==null?void 0:m.origin})," to"," ",e.jsx("strong",{children:m==null?void 0:m.destination}),":"]}),e.jsxs("p",{className:"text-xs",children:[e.jsx(as,{})," Checked Baggage:"," ",(B=(U=(I=m==null?void 0:m.baggages)==null?void 0:I.checked)==null?void 0:U[c.pax_type])!=null&&B.weight?`${(y=(O=(M=m==null?void 0:m.baggages)==null?void 0:M.checked)==null?void 0:O[c.pax_type])==null?void 0:y.weight} ${($=(t=(o=m==null?void 0:m.baggages)==null?void 0:o.checked)==null?void 0:t[c.pax_type])==null?void 0:$.unit}`:`${(L=(R=(k=m==null?void 0:m.baggages)==null?void 0:k.checked)==null?void 0:R[c.pax_type])==null?void 0:L.pieceCount} pieces`," "]}),e.jsxs("p",{className:"text-xs",children:[e.jsx(ts,{})," Hand Baggage:"," ",(c==null?void 0:c.pax_type)!=="INF"&&((V=(P=(b=m==null?void 0:m.baggages)==null?void 0:b.carry_on)==null?void 0:P[c.pax_type])==null?void 0:V.title)||"7 kg*"]})]},N)})}),e.jsx("br",{}),e.jsx("p",{children:"Additional:"}),c.baggage_option?e.jsx("p",{children:c.baggage_option}):e.jsx("p",{children:"N/A"}),C.toUpperCase()==="ACTIVE"&&e.jsx("button",{title:"Update Baggage",className:"normal-case border-transparent rounded shadow-sm shadow-primary/50 btn btn-square btn-primary btn-outline btn-sm",children:e.jsx(we,{className:"text-lg"})})]}),e.jsxs("td",{className:"space-y-3 text-center",children:[c.seat_number?e.jsx("p",{children:"Seat Number - A1"}):e.jsx("p",{children:"N/A"}),(x==null?void 0:x.toUpperCase())==="ACTIVE"&&e.jsx("button",{title:"Update Seats",className:"normal-case border-transparent rounded shadow-sm shadow-primary/50 btn btn-primary btn-square btn-outline btn-sm",children:e.jsx(rs,{})})]}),e.jsxs("td",{className:"space-y-3 text-center",children:[c.meal_option?e.jsx("p",{children:"Meal - "}):e.jsx("p",{children:"N/A"}),(w==null?void 0:w.toUpperCase())==="ACTIVE"&&e.jsx("button",{title:"Update Meals",className:"normal-case border-transparent rounded shadow-sm shadow-primary/50 btn btn-primary btn-square btn-outline btn-sm",children:e.jsx(vs,{})})]})]},me()))})]})})})]}),(u==null?void 0:u.status)==="active"&&e.jsx("div",{className:"p-4 mb-5 border rounded",children:e.jsx("div",{className:"text-sm",dangerouslySetInnerHTML:{__html:he(u==null?void 0:u.text)}})}),(g==null?void 0:g.status)==="active"&&e.jsx("div",{className:"p-4 mb-5 border rounded",children:e.jsx("div",{className:"text-sm",dangerouslySetInnerHTML:{__html:he(g==null?void 0:g.text)}})})]})};Ue.propTypes={booking_details:F.object.isRequired};const ce=({price:a,title:l="Fare Breakdown",description:s=null})=>{const{price_breakdown:j}=a;return e.jsxs("div",{className:"mb-5 border rounded tab-pane",id:"customer_fare_tab",role:"tabpanel",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("h5",{className:"font-semibold whitespace-nowrap",children:l}),s&&e.jsxs("div",{className:"self-center text-xs border-transparent badge bg-info/5 text-info",children:[e.jsx(ns,{className:"mr-1"})," ",s]})]})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("table",{className:"table text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-sm border",children:"Passenger Type"}),e.jsx("th",{className:"text-sm border",children:"Pax Count"}),e.jsx("th",{className:"text-sm border",children:"Pax Base Fare"}),e.jsx("th",{className:"text-sm border",children:"Pax Tax"}),e.jsx("th",{className:"text-sm border",children:"Pax Sub-Total"})]})}),e.jsx("tbody",{children:j==null?void 0:j.map(d=>{var v,n,h,r,u,g;return e.jsxs("tr",{children:[e.jsx("td",{className:"border",children:e.jsx("h5",{className:"text-lg font-semibold",children:d.passenger_type==="ADT"?"Adult":d.passenger_type==="CNN"?"Child":"Infant"})}),e.jsx("td",{className:"border",children:e.jsx("h5",{className:"text-lg font-semibold",children:d.passenger_total})}),e.jsxs("td",{className:"border",children:[oe((v=d==null?void 0:d.base_fare)==null?void 0:v.currency)," ",(n=d==null?void 0:d.base_fare)==null?void 0:n.amount]}),e.jsxs("td",{className:"border",children:[oe((h=d==null?void 0:d.tax)==null?void 0:h.currency)," ",(r=d==null?void 0:d.tax)==null?void 0:r.amount]}),e.jsxs("td",{className:"border",children:[oe((u=d==null?void 0:d.total)==null?void 0:u.currency)," ",(g=d==null?void 0:d.total)==null?void 0:g.amount]})]},d.passenger_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-sm border text-base-content",colSpan:"4",children:"Total"}),e.jsxs("th",{className:"text-sm border text-base-content",children:[oe(a.total.currency)," ",a.total.amount]})]})})]})})})]})};ce.propTypes={price:F.object.isRequired};const Ps=()=>e.jsxs("div",{className:"mb-5 border rounded tab-pane",id:"activity_logs_tab",role:"tabpanel",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h5",{className:"font-semibold",children:"Booking Activity Logs"})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"flex items-start",children:e.jsxs("div",{className:"overflow-hidden text-sm grow",children:[e.jsx("h5",{className:"text-sm font-semibold",children:e.jsx("a",{href:"#",className:"text-dark",children:"Search Intiated"})}),"By"," ",e.jsx("span",{className:"text-white bg-black badge badge-sm",children:"Test User"})," ","at"," ",e.jsx("span",{className:"text-white bg-black badge badge-sm",children:"17 Jul 2023 2:51 AM"}),e.jsxs("p",{className:"mb-0 font-size-13 text-muted",children:["Last Update 17 Jul 2023 2:52 AM",e.jsx("br",{})]}),e.jsxs("p",{children:[e.jsx("br",{}),"On 17 Jul 2023 at 2:51 AM, Test User initiated a flight search for a trip from"," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"IAH"}),"to ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"KHI"}),". The search specified a departure date of"," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"2023-11-01"})," ","and indicated that there would be"," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"1 adults"}),","," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"0 child"})," ","and"," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"0 infant"})," ","traveling. The booking class selected was"," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"Economy"})," ","and the journey type was"," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"RoundTrip"}),"."]})]})})})]}),$e=({tracking_id:a,booking_status:l})=>{var O,y;const[s,j]=A.useState(!1),[d,v]=A.useState(!1),{member_id:n}=J.useState().user_data||{},{axiosInstance:h}=ee(),[r,u]=A.useState(),{booking_manage:g}=D.useState(),{customer_invoice_customization:_,customer_invoice_customization_for_confirm:C}=g||{},{data:f,isLoading:S,refetch:w}=ie({queryKey:["CUSTOMER_INVOICE",a,n],queryFn:async()=>{var t;const o=await h.post("/finance/partner-customer-booking-info",{tracking_id:a,member_id:n});if(((t=o.data)==null?void 0:t.status)==="success"){const{data:$,summery:k}=o.data,{sell_invoice_due_date:R,sell_paid_status:L,sell_paid_amount:b}=k||{},P={sell_invoice_due_date:R,sell_paid_status:L,sell_paid_amount:b};return $.forEach((V,se)=>{const{base_fare:ae,tax:Q,ticket_issue_charge:H,service_charge:W,discount:X}=(V==null?void 0:V.sell)||{};P[se]={base_fare:parseFloat(ae)-parseFloat(H),tax:Q,ticket_issue_charge:H,service_charge:W,discount:X}}),u(P),o.data}else throw o}}),{data:x}=f||{},[i,c]=A.useState(!1),T=de(),p=async o=>{var V,se,ae,Q,H,W,X,ne;if(o.preventDefault(),!s)return j(!0);if(i)return;const t=o.target,$=x.length>1?[...t.base_fare].map(E=>E.value):[(V=t.base_fare)==null?void 0:V.value],k=x.length>1?[...t.tax].map(E=>E.value):[(se=t.tax)==null?void 0:se.value],R=x.length>1?[...t.ticket_issue_charge].map(E=>E.value):[(ae=t.ticket_issue_charge)==null?void 0:ae.value],L=x.length>1?[...t.service_charge].map(E=>E.value):[(Q=t.service_charge)==null?void 0:Q.value],b=x.length>1?[...t.discount].map(E=>E.value):[(H=t.discount)==null?void 0:H.value],P={member_id:n,tracking_id:a,sell_paid_amount:r.sell_paid_amount,sell_invoice_due_date:r.sell_invoice_due_date,pax_data:x.map((E,z)=>({pax_id:E.pax_id,sell:{base_fare:$[z],tax:k[z],ticket_issue_charge:R[z],service_charge:L[z],discount:b[z]}}))};c(!0);try{const E=await h.post("/finance/partner-customer-booking-info-modify",P);if(((W=E.data)==null?void 0:W.status)==="success")j(!1),await w(),await T.invalidateQueries(["FLIGHT_BOOKING_DETAILS"]),re("success","Success!",(X=E.data)==null?void 0:X.reason);else throw new Error(((ne=E==null?void 0:E.data)==null?void 0:ne.reason)||"Something wrong!")}catch(E){re("error","Failed",E.message)}finally{c(!1)}},m=r?Object.values(r).reduce((o,t)=>(parseFloat(o)+parseFloat((t==null?void 0:t.base_fare)||0)+parseFloat((t==null?void 0:t.ticket_issue_charge)||0)).toFixed(2),0):0,N=r?Object.values(r).reduce((o,t)=>(parseFloat(o)+parseFloat((t==null?void 0:t.service_charge)||0)).toFixed(2),0):0,I=r?Object.values(r).reduce((o,t)=>(parseFloat(o)+parseFloat((t==null?void 0:t.discount)||0)).toFixed(2),0):0,U=r?Object.values(r).reduce((o,t)=>(parseFloat(o)+parseFloat((t==null?void 0:t.base_fare)||0)+parseFloat((t==null?void 0:t.ticket_issue_charge)||0)+parseFloat((t==null?void 0:t.tax)||0)+parseFloat((t==null?void 0:t.service_charge)||0)-parseFloat((t==null?void 0:t.discount)||0)).toFixed(2),0):0,B=(y=(O=x==null?void 0:x.at(0))==null?void 0:O.sell)==null?void 0:y.currency,M=x==null?void 0:x.at(0);return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:p,className:"mb-5 border rounded tab-pane",id:"customer_fare_tab",role:"tabpanel",children:[e.jsxs("div",{className:"flex flex-col gap-3 p-4 pb-1 border-b",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-2 font-semibold",children:"Personalize Your Invoice for Fare Adjustment"}),e.jsx("p",{className:"text-sm",children:"Customize your customer invoice to accurately represent fare adjustments. This can be achieved by modifying the base fare, tax, service charge, discount, and ticket issue charge. Note that the ticket issue charge will be automatically added to the base fare when sending the custom fare details via email."})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs("span",{className:"gap-1 text-xs rounded badge badge-error bg-error/10 text-error",children:[e.jsx("b",{children:"Invoice Status:"})," ",r==null?void 0:r.sell_paid_status]})}),e.jsxs("div",{className:"flex gap-2",children:[((_==null?void 0:_.toUpperCase())==="ACTIVE"&&l==="hold"||(C==null?void 0:C.toUpperCase())==="ACTIVE"&&l==="confirm")&&e.jsx("button",{type:"submit",className:"font-normal normal-case rounded btn btn-xs btn-secondary",children:i?"Updating...":e.jsxs(e.Fragment,{children:[e.jsx(ls,{})," ",s?"Update":"Modify"]})}),s&&e.jsx("button",{type:"button",onClick:()=>j(!1),className:"font-normal normal-case rounded btn btn-xs btn-secondary btn-outline",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"w-full mb-2 overflow-x-auto",children:e.jsxs("table",{className:"table text-xs text-center",children:[e.jsx("thead",{}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Customer Invoice Due Date"}),e.jsx("td",{children:e.jsx(As,{disabled:s===!1,className:`min-w-[64px] hide_arrow_key w-full rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent disabled:!border-0"}`,minDate:"",defaultValue:r==null?void 0:r.sell_invoice_due_date,action:o=>u({...r,sell_invoice_due_date:o})})}),e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Customer Total Paid:"}),e.jsx("td",{children:e.jsx("input",{autoComplete:"off",type:"number",readOnly:s===!1,className:`min-w-[64px] hide_arrow_key w-full rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:r==null?void 0:r.sell_paid_amount,onChange:o=>u({...r,sell_paid_amount:o.target.value}),name:"sell_paid_amount"})})]})})]})}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("table",{className:"table text-xs text-center",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Base Fare + Ticket Issue Charge"}),e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Tax"}),e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Service Charge"}),e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Discount"}),e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Total + Currency"})]})}),S||!r?e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:"100%",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 py-8",children:[e.jsx(Z,{className:"animate-spin"})," Loading..."]})})})}):r&&(x==null?void 0:x.map((o,t)=>{var Q,H,W,X,ne,E,z,pe,be,je,ge,fe;const{pax_id:$,customer:k,sell:R}=o||{},{title:L,first_name:b,last_name:P,pax_type:V}=k||{},se=L+" "+b+" "+P,{currency:ae}=R||{};return e.jsxs("tbody",{children:[e.jsx("tr",{children:e.jsx("th",{colSpan:"100%",className:"p-2 text-[13px] border text-start",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:["Name:"," ",e.jsx("span",{className:"font-normal",children:se})]}),e.jsxs("div",{children:["Passenger Type:"," ",e.jsx("span",{className:"font-normal",children:cs(V)})]})]})})}),e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 border bg-neutral/5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{autoComplete:"off",type:"number",readOnly:s===!1,className:`w-20 hide_arrow_key rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:(Q=r[t])==null?void 0:Q.base_fare,onChange:Y=>u({...r,[t]:{...r[t],base_fare:Y.target.value}}),name:"base_fare"}),e.jsx("span",{children:"+"}),e.jsx("input",{autoComplete:"off",type:"number",readOnly:s===!1,className:`w-20 hide_arrow_key rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:(H=r[t])==null?void 0:H.ticket_issue_charge,name:"ticket_issue_charge",onChange:Y=>u({...r,[t]:{...r[t],ticket_issue_charge:Y.target.value}})}),e.jsx("span",{children:"="}),e.jsx("input",{autoComplete:"off",type:"number",readOnly:!0,className:`w-20 hide_arrow_key rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:parseFloat((W=r[t])==null?void 0:W.base_fare)+parseFloat((X=r[t])==null?void 0:X.ticket_issue_charge)})]})}),e.jsx("td",{className:"p-2 border bg-neutral/5",children:e.jsx("input",{autoComplete:"off",type:"number",readOnly:s===!1,className:`min-w-[64px] hide_arrow_key w-full rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:(ne=r[t])==null?void 0:ne.tax,onChange:Y=>u({...r,[t]:{...r[t],tax:Y.target.value}}),name:"tax"})}),e.jsx("td",{className:"p-2 border bg-neutral/5",children:e.jsx("input",{autoComplete:"off",type:"number",readOnly:s===!1,className:`min-w-[64px] hide_arrow_key w-full rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:(E=r[t])==null?void 0:E.service_charge,onChange:Y=>u({...r,[t]:{...r[t],service_charge:Y.target.value}}),name:"service_charge"})}),e.jsx("td",{className:"p-2 border bg-neutral/5",children:e.jsx("input",{autoComplete:"off",type:"number",readOnly:s===!1,className:`min-w-[64px] hide_arrow_key w-full rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:(z=r[t])==null?void 0:z.discount,onChange:Y=>u({...r,[t]:{...r[t],discount:Y.target.value}}),name:"discount"})}),e.jsxs("td",{className:"p-2 font-medium border bg-neutral/5",children:[(parseFloat(((pe=r[t])==null?void 0:pe.base_fare)||0)+parseFloat(((be=r[t])==null?void 0:be.ticket_issue_charge)||0)+parseFloat(((je=r[t])==null?void 0:je.tax)||0)+parseFloat(((ge=r[t])==null?void 0:ge.service_charge)||0)-parseFloat(((fe=r[t])==null?void 0:fe.discount)||0)).toFixed(2)," ",ae]})]})]},$)})),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end bg-neutral/5",children:"Total Base Fare ="}),e.jsxs("td",{className:"bg-neutral/5",children:[m," ",B]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end bg-neutral/5",children:"Total Service Charge ="}),e.jsxs("td",{className:"bg-neutral/5",children:[N," ",B]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end bg-neutral/5",children:"Total Discount ="}),e.jsxs("td",{className:"bg-neutral/5",children:[I," ",B]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end bg-neutral/5",children:"Grand Total Price ="}),e.jsxs("td",{className:"bg-neutral/5",children:[U," ",B]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end bg-neutral/5",children:"Total Paid ="}),e.jsxs("td",{className:"bg-neutral/5",children:[(r==null?void 0:r.sell_paid_amount)||0," ",B]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end bg-neutral/5",children:"Balance ="}),e.jsxs("td",{className:"bg-neutral/5",children:[U-(Number(r==null?void 0:r.sell_paid_amount)||0)," ",B]})]})]})]})}),!s&&e.jsx("div",{className:"flex justify-end mt-5",children:e.jsxs("button",{type:"button",onClick:()=>v(!0),className:"font-normal normal-case rounded btn btn-primary btn-sm",children:[e.jsx(is,{})," Send Email"]})})]})]}),M&&e.jsx(ks,{isActive:d,setIsActive:v,tracking_id:a,primary_customer_data:M})]})};$e.propTypes={tracking_id:F.string,booking_status:F.string};const Ys=({supplier_uid:a,supplier_confirmation_id:l})=>{var T;const[s,j]=A.useState(!1),[d,v]=A.useState(null),[n,h]=A.useState(null),[r,u]=A.useState([]),{member_id:g}=((T=J.useState())==null?void 0:T.user_data)||{},{axiosInstance:_}=ee(),C=async()=>{var p,m;if(!s){j(!0);try{const N=await _.post("/secure?pathName=/terminal/create-session",{member_id:g,supplier_uid:a});if(((p=N.data)==null?void 0:p.status)==="success"){const{tracking_id:I,session_token:U}=N.data,B=await _.post("/secure?pathName=/terminal/execute-command",{member_id:g,tracking_id:I,session_token:U,terminal_command:`*${l}`}),{terminal_history:M}=B.data;u(M),v(I),h(U)}else throw new Error(((m=N.data)==null?void 0:m.reason)||"Something went wrong")}catch(N){console.error(N)}finally{j(!1)}}},[f,S]=A.useState(!1),w=async p=>{if(p.preventDefault(),!f){S(!0);try{const m=p.target.terminal_command.value,N=await _.post("/secure?pathName=/terminal/execute-command",{member_id:g,tracking_id:d,session_token:n,terminal_command:m}),{terminal_history:I}=N.data;u(I),p.target.reset()}catch(m){console.error(m)}finally{S(!1)}}},[x,i]=A.useState(!1),c=async()=>{var p,m;if(!x){i(!0);try{const N=await _.post("/secure?pathName=/terminal/end-session",{member_id:g,tracking_id:d,session_token:n});if(((p=N.data)==null?void 0:p.status)==="success")v(null),h(null),u([]);else throw new Error(((m=N.data)==null?void 0:m.reason)||"Something went wrong")}catch(N){console.error(N)}finally{i(!1)}}};return e.jsxs("div",{className:"w-full p-4 pt-2 border rounded-md",children:[e.jsx("h3",{className:"pb-2 text-lg font-semibold",children:"Terminal Window"}),e.jsx("hr",{className:"mb-4"}),!d&&!n&&e.jsx("div",{className:"flex gap-5 sm:items-end max-sm:flex-col",children:e.jsx("button",{onClick:C,className:`normal-case btn btn-primary rounded-md shadow shadow-primary/30 min-h-0 h-10 ${s?"pointer-events-none":""}`,children:s?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 animate-spin"})," Starting..."]}):"Start Session"})}),d&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:w,className:"flex gap-5 max-sm:flex-col sm:items-end",autoComplete:"off",children:[e.jsxs("div",{className:"flex-1 gap-2 form-control",children:[e.jsx("p",{className:"text-sm font-medium text-neutral",children:"Type Terminal Command"}),e.jsx("input",{name:"terminal_command",className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30 ",required:!0})]}),e.jsx("button",{type:"submit",className:`normal-case btn btn-primary rounded-md shadow shadow-primary/30 min-h-0 h-10 ${f?"pointer-events-none":""}`,children:f?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 animate-spin"})," Running..."]}):"Run"}),e.jsx("button",{type:"button",onClick:()=>c(),className:`normal-case btn btn-primary btn-outline rounded-md shadow shadow-primary/30 min-h-0 h-10 ${x?"pointer-events-none":""}`,children:x?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 animate-spin"})," Closing..."]}):"Close"})]}),e.jsx("div",{className:"grid gap-4 mt-8",children:r.map(p=>{var m;return e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"p-3 border rounded bg-neutral/5",children:[p!=null&&p.command_response?(m=JSON.parse(p.command_response))==null?void 0:m.map((N,I)=>e.jsx("p",{className:"text-sm",children:N},I)):null,e.jsx("p",{className:"mt-1 text-xs text-end",children:K(new Date((p==null?void 0:p.timestamp)*1e3)).format("ddd, MMM Do YYYY, h:mm:ss a")})]}),e.jsxs("div",{className:"p-3 border rounded bg-neutral/10",children:[e.jsx("p",{className:"text-sm",children:p==null?void 0:p.terminal_command}),e.jsx("p",{className:"mt-1 text-xs text-end",children:K(new Date((p==null?void 0:p.timestamp)*1e3)).format("ddd, MMM Do YYYY, h:mm:ss a")})]})]},p==null?void 0:p.timestamp)})})]})]})},Hs=["supernsn","manager","support","accounts"],Oe=({booking_details:a,isImportGDSPNR:l=!1})=>{var $,k,R,L;const[s,j]=A.useState("itinerary"),{booking_manage:d,price_view:v,system_config:n}=D.useState(),[h,r]=A.useState(!0),{booking_hold_vocuher_download:u,booking_send_vocuher:g,customer_invoice_features:_}=d||{},{show_fmg_price:C,show_supplier_price:f,show_partner_price:S,show_sell_price:w}=v||{},{general:x,booking:{booking_status:i},tracking_id:c,special_notice_status:T,special_notice:p,supplier:{info:{supplier_uid:m}},pax:{data:N},refund_data:I}=a,{sell:U,purchase:B,fmg:M,supplier:O}=(($=a==null?void 0:a.flight)==null?void 0:$.price)||{},{user_access_level:y}=((k=J.useState())==null?void 0:k.user_data)||{},o=Hs.includes(y),t=b=>btoa(JSON.stringify(b));return e.jsxs("div",{className:"p-4 rounded-lg lg:col-span-5 bg-base-200",children:[e.jsxs("div",{className:"mb-8 border rounded",children:[!l&&e.jsxs("div",{className:"flex justify-between p-4 border-b max-sm:flex-col",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mb-1 text-2xl font-semibold",children:x==null?void 0:x.booking_id}),e.jsx("p",{className:"text-neutral",children:"Booking ID"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[i==="confirm"&&e.jsxs(le,{to:`/voucher/flight?q=${btoa(c)}`,target:"_blank",className:"h-10 min-h-0 text-sm btn border-neutral/70 hover:bg-neutral/70 hover:!text-white btn-outline btn-success normal-case",children:[e.jsx(q,{path:os,size:.8})," E-ticket"]}),(i==="confirm"||i==="hold"&&(u==null?void 0:u.toUpperCase())==="YES")&&e.jsxs("div",{className:"dropdown dropdown-end",children:[e.jsxs("button",{tabIndex:"0",className:"h-10 min-h-0 text-sm btn border-neutral/70 hover:bg-neutral/70 hover:!text-white btn-outline btn-info normal-case",children:[e.jsx(q,{path:ds,size:.8})," Download"," ",e.jsx(Ne,{})]}),e.jsxs("ul",{tabIndex:"0",className:"z-20 p-2 mt-3 overflow-hidden !rounded shadow-md menu menu-sm dropdown-content shadow-primary/20 bg-base-200 w-64 join join-vertical",children:[e.jsx("li",{className:"border-t join-item",children:e.jsxs("details",{open:!0,children:[e.jsx("summary",{className:"!py-2 rounded-none hover:bg-primary/10",children:"With Fare"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(le,{to:`/voucher?q=${t({tracking_id:c,price:!0})}`,target:"_blank",className:"!py-1 !rounded",children:"Download Voucher"})}),N==null?void 0:N.map(b=>e.jsx(_e.Fragment,{children:e.jsx("li",{className:"border-t join-item",children:e.jsxs(le,{to:`/voucher?q=${t({tracking_id:c,price:!0,pax_id:b==null?void 0:b.pax_id,ticket:!0})}`,target:"_blank",className:"!py-1 !rounded",children:[b==null?void 0:b.title," ",b==null?void 0:b.first_name," ",b==null?void 0:b.last_name]})})},b==null?void 0:b.Id))]})]})}),e.jsx("li",{className:"border-t join-item",children:e.jsxs("details",{children:[e.jsx("summary",{className:"!py-2 rounded-none hover:bg-primary/10",children:"Without Fare"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(le,{to:`/voucher?q=${t({tracking_id:c})}`,target:"_blank",className:"!py-1 !rounded",children:"Download Voucher"})}),N==null?void 0:N.map(b=>e.jsx(_e.Fragment,{children:e.jsx("li",{className:"border-t join-item",children:e.jsxs(le,{to:`/voucher?q=${t({tracking_id:c,pax_id:b==null?void 0:b.pax_id,ticket:!0})}`,target:"_blank",className:"!py-1 !rounded",children:[b==null?void 0:b.title," ",b==null?void 0:b.first_name," ",b==null?void 0:b.last_name]})})},b==null?void 0:b.Id))]})]})})]})]}),i==="hold"&&e.jsx(e.Fragment,{children:e.jsxs("button",{type:"button",onClick:()=>{var b;return(b=document.getElementById("send_booking_pay_link_modal"))==null?void 0:b.showModal()},className:"h-10 min-h-0 text-sm btn border-neutral/70 hover:bg-neutral/70 hover:!text-white btn-outline btn-info normal-case",children:[e.jsx(q,{path:ye,size:.8})," Send Pay Link"," "]})}),(i==="hold"&&g==="ACTIVE"&&u==="YES"||i==="confirm"&&g==="ACTIVE")&&e.jsxs("button",{type:"button",onClick:()=>{var b;return(b=document.getElementById("send_voucher_modal"))==null?void 0:b.showModal()},className:"h-10 min-h-0 text-sm btn border-neutral/70 hover:bg-neutral/70 hover:!text-white btn-outline btn-secondary normal-case",children:[e.jsx(q,{path:ye,size:.8})," Send Voucher"]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"h-10 w-10 p-0 min-h-0 btn border-neutral/70 hover:!text-white btn-outline btn-neutral normal-case",children:e.jsx(us,{className:"text-xl"})})]})]}),i==="hold"&&T==="active"&&e.jsx("div",{className:"p-2",children:e.jsx("div",{className:"p-2 text-sm border rounded-md border-warning/20 text-error",children:e.jsxs("div",{className:"relative flex items-end gap-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-red-600 b-1",children:"***Attention***"}),e.jsx("div",{className:`text-red-400 ${h?"":"line-clamp-1"}`,dangerouslySetInnerHTML:{__html:he(p)||""}})]}),e.jsx("button",{onClick:()=>r(!h),className:"absolute bottom-0 right-0 pl-3 text-xs font-medium text-info shrink-0 bg-gradient-to-r from-base-200/50 via-base-200 to-base-200",children:h?e.jsxs(e.Fragment,{children:["View Less ",e.jsx(xs,{})]}):e.jsxs(e.Fragment,{children:["View Details ",e.jsx(Ne,{})]})})]})})}),i==="initiated"&&e.jsx("div",{className:"p-2",children:e.jsx("div",{className:"p-2 text-sm border rounded-md border-warning/20 text-error",children:e.jsxs("div",{className:"relative flex items-end gap-5",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-yellow-500 b-1",children:"***Attention***"}),e.jsx("div",{className:`text-yellow-400 ${h?"":"line-clamp-1"}`,children:e.jsxs("p",{children:["The session for this booking has been expired. Please click ",e.jsx("strong",{children:"Search again"})," to make a new booking."]})})]}),e.jsx(Ss,{booking_details:a})]})})}),e.jsx("div",{className:"w-full overflow-auto whitespace-nowrap hide_scrollbar",children:e.jsxs(Es,{slidesPerView:"auto",spaceBetween:0,freeMode:!0,modules:[Ts,Bs,Fs],mousewheel:!0,navigation:{prevEl:".tab-btn-prev",nextEl:".tab-btn-next"},className:"px-4 text-sm font-medium",children:[e.jsx(G,{onClick:()=>j("itinerary"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="itinerary"?"border-b-primary":""}`,children:"Itinerary"}),w==="YES"&&e.jsxs(G,{onClick:()=>j("fare_breakdown_customer"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="fare_breakdown_customer"?"border-b-primary":""}`,children:[e.jsx("p",{children:"Fare"}),e.jsx("p",{className:"text-[10px] font-light",children:"(Customer)"})]}),S==="YES"&&e.jsxs(G,{onClick:()=>j("fare_breakdown"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="fare_breakdown"?"border-b-primary":""}`,children:[e.jsx("p",{children:"Fare"}),e.jsx("p",{className:"text-[10px] font-light",children:"(Agent)"})]}),(C==null?void 0:C.toUpperCase())==="YES"&&e.jsxs(G,{onClick:()=>j("fare_breakdown_fmg"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="fare_breakdown_fmg"?"border-b-primary":""}`,children:[e.jsx("p",{children:"FMG Fare"}),e.jsxs("p",{className:"text-[10px] font-light",children:["(",(R=M==null?void 0:M.total)==null?void 0:R.currency,")"]})]}),f==="YES"&&e.jsxs(G,{onClick:()=>j("fare_breakdown_supplier"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="fare_breakdown_supplier"?"border-b-primary":""}`,children:[e.jsx("p",{children:"Supplier Fare"}),e.jsxs("p",{className:"text-[10px] font-light",children:["(Airlines - ",(L=O==null?void 0:O.total)==null?void 0:L.currency,")"]})]}),(i==="confirm"||i==="hold")&&(n==null?void 0:n.show_gds_terminal_option)==="YES"&&e.jsx(G,{onClick:()=>j("terminal"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="terminal"?"border-b-primary":""}`,children:"Terminal"}),!l&&o&&(_==null?void 0:_.toUpperCase())==="ACTIVE"&&(i==="confirm"||i==="hold")&&e.jsxs(G,{onClick:()=>j("customer_invoice"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="customer_invoice"?"border-b-primary":""}`,children:[e.jsx("p",{children:"Invoice"}),e.jsx("p",{className:"text-[10px] font-light",children:"(Custom)"})]}),i==="cancel"&&(I==null?void 0:I.length)>0&&e.jsx(G,{onClick:()=>j("customer_invoice"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="customer_invoice"?"border-b-primary":""}`,children:e.jsx("p",{children:"Refund"})}),e.jsx("button",{className:"absolute top-0 bottom-0 left-0 z-20 w-4 text-lg duration-100 bg-black/5 text-primary tab-btn-prev hover:bg-primary hover:text-primary-content",children:e.jsx(ms,{})}),e.jsx("button",{className:"absolute top-0 bottom-0 right-0 z-20 w-4 text-lg duration-100 bg-black/5 text-primary tab-btn-next hover:bg-primary hover:text-primary-content",children:e.jsx(hs,{})})]})})]}),e.jsxs("div",{id:"flight-tab-content",className:"tab-content",children:[s==="itinerary"&&e.jsx(Ue,{booking_details:a,isImportGDSPNR:l}),s==="fare_breakdown_customer"&&w==="YES"&&e.jsx(ce,{price:U,isCustomer:!0,tracking_id:c,title:"Fare Breakdown (Customer)",description:"After adding your markup to make this amount visible to your customer."}),((S==null?void 0:S.toUpperCase())==="YES"||l)&&s==="fare_breakdown"&&e.jsx(ce,{price:B,title:"Agent Fare",description:"The fare expressed in your currency. This represents the amount you need to pay, serving as the cost of the tickets."}),((C==null?void 0:C.toUpperCase())==="YES"||l)&&s==="fare_breakdown_fmg"&&e.jsx(ce,{price:M,title:"FMG Fare",description:"Adjusted after deducting airline commission and modifying the markup and margin."}),((f==null?void 0:f.toUpperCase())==="YES"||l)&&s==="fare_breakdown_supplier"&&e.jsx(ce,{price:O,title:"Supplier Fare",description:"The actual fare from the airline's Global Distribution System (GDS)"}),s==="activity_logs"&&e.jsx(Ps,{}),(_==null?void 0:_.toUpperCase())==="ACTIVE"&&o&&s==="customer_invoice"&&e.jsx($e,{tracking_id:c,booking_status:i}),(i==="confirm"||i==="hold")&&(n==null?void 0:n.show_gds_terminal_option)==="YES"&&s==="terminal"&&e.jsx(Ys,{supplier_uid:m,supplier_confirmation_id:x==null?void 0:x.supplier_confirmation_id}),i==="cancel"&&s==="refund"&&e.jsx(Ms,{refund_data:I})]})]})};Oe.propTypes={booking_details:F.object.isRequired};const Re=({info:a})=>{const{book_by:l,ip_address:s}=a;return e.jsx("div",{className:"mb-5 border rounded card",children:e.jsxs("div",{className:"gap-0 px-2 py-3 card-body",children:[e.jsx("h5",{className:"mb-1 text-sm font-semibold",children:"Book By"}),e.jsxs("div",{children:[" ",e.jsxs("a",{href:"#",className:"flex items-center",children:[e.jsxs("div",{className:"w-10 p-1 mr-2 border rounded-full avatar shrink-0",children:[" ",e.jsx("img",{src:"https://png.pngtree.com/png-vector/20220709/ourmid/pngtree-businessman-user-avatar-wearing-suit-with-red-tie-png-image_5809521.png",alt:"",className:"rounded-full"})," "]}),e.jsx("div",{className:"grow",children:e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium",children:l}),e.jsx("p",{className:"text-[13px]",children:s})]})})]})," "]})]})})};Re.propTypes={info:F.object.isRequired};const Le=({details:a})=>{var h;const{brand_name:l,partner_profile_code:s,support_email:j,country:d,website:v}=a||{},{data:n=[]}=ie(["COUNTRY"],async()=>{const r=window.location.origin,u=await ps.get(`${r}/country.json`);return Object.values(u.data.data).map(g=>({label:`${g.country_name} (${g.country_code})`,value:g.country_code}))});return e.jsx("div",{className:"mb-5 border rounded card",children:e.jsxs("div",{className:"gap-0 px-2 py-3 text-center card-body",children:[e.jsx("h5",{className:"mb-1 text-sm font-semibold",children:l}),e.jsxs("div",{className:"space-y-1 text-[10px] text-start",children:[s&&e.jsxs("div",{className:"font-semibold",children:["Partner Code:"," ",e.jsx("span",{className:"font-normal",children:s})]}),j&&e.jsxs("div",{className:"font-semibold",children:["Email:"," ",e.jsx("a",{href:"mailto:support_email",className:"font-normal hover:underline",children:j})]}),v&&e.jsxs("div",{className:"font-semibold",children:["Website:"," ",e.jsx("a",{href:"{website}",className:"font-normal hover:underline",children:v})]}),d&&e.jsxs("div",{className:"font-semibold",children:["Country:"," ",e.jsx("span",{className:"font-normal",children:(h=n==null?void 0:n.find(r=>(r==null?void 0:r.value)===d))==null?void 0:h.label})]})]})]})})};Le.propTypes={details:F.object.isRequired};const Ve=({auto_cancel:a})=>{const[l,s]=A.useState(j(a));A.useEffect(()=>{const r=setInterval(()=>{s(j(a))},1e3);return()=>clearInterval(r)},[a]);function j(r){const u=new Date,_=new Date(r)-u;if(_<=0)return{days:0,hours:0,minutes:0,seconds:0};const C=Math.floor(_/(1e3*60*60*24)),f=Math.floor(_%(1e3*60*60*24)/(1e3*60*60)),S=Math.floor(_%(1e3*60*60)/(1e3*60)),w=Math.floor(_%(1e3*60)/1e3);return{days:C,hours:f,minutes:S,seconds:w}}const{days:d,hours:v,minutes:n,seconds:h}=l;return e.jsxs("h3",{className:"text-sm",children:["Auto Cancel"," ",e.jsx("span",{className:"font-semibold tracking-tight text-red-500",children:`${d}d ${v}h ${n}m ${h}s`})]})};Ve.propTypes={auto_cancel:F.string};const qe=({booking_details:a,can_modify:l,airports:s,flight_supplier_options:j,refetchData:d})=>{var S,w,x,i,c,T,p,m,N,I,U,B,M,O;const{member_id:v}=((S=J.useState())==null?void 0:S.user_data)||{},[n,h]=A.useState({tracking_id:(a==null?void 0:a.tracking_id)||"",member_id:v,supplier_uid:((x=(w=a==null?void 0:a.supplier)==null?void 0:w.info)==null?void 0:x.supplier_uid)||"",supplier_confirmation_id:((i=a==null?void 0:a.general)==null?void 0:i.supplier_confirmation_id)||"",airlines_pnr:((c=a==null?void 0:a.general)==null?void 0:c.airlines_pnr)||"",booking_status:((T=a==null?void 0:a.booking)==null?void 0:T.booking_status)||"hold",ticket_status:((p=a==null?void 0:a.booking)==null?void 0:p.ticket_status)||"queue",departure_airport:((m=a==null?void 0:a.flight)==null?void 0:m.departure_airport)||"",arrival_airport:((N=a==null?void 0:a.flight)==null?void 0:N.arrival_airport)||"",journey_type:((U=(I=a==null?void 0:a.flight)==null?void 0:I.search_parameter)==null?void 0:U.journey_type)||"OneWay",auto_cancel_status:((B=a==null?void 0:a.booking)==null?void 0:B.auto_cancel_status)||"pending",auto_cancel:((M=a==null?void 0:a.booking)==null?void 0:M.auto_cancel)||"",booking_remarks:((O=a==null?void 0:a.general)==null?void 0:O.booking_remarks)||""}),[r,u]=A.useState(!1),[g,_]=A.useState(null),{axiosInstance:C}=ee(),f=async y=>{var o,t,$;if(y.preventDefault(),!r){_(null),u(!0);try{const k=await C.post("/flight/update-booking-info",n);if(((o=k.data)==null?void 0:o.status)==="success")te.close(),d(),re("success","Success!",(t=k.data)==null?void 0:t.reason);else throw new Error(($=k==null?void 0:k.data)==null?void 0:$.reason)}catch(k){console.error(k),_(k.message)}finally{u(!1)}}};return e.jsxs("form",{onSubmit:f,className:"relative px-6 py-4 text-start",children:[e.jsx("h3",{className:"pb-2 text-lg font-semibold",children:"Update Booking Info"}),e.jsx("hr",{className:"mb-4"}),g&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 py-1 pl-4 mx-auto border border-l-4 rounded-r border-warning text-warning w-fit",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(Se,{})}),e.jsx("div",{className:"text-sm",children:g})]}),e.jsx("button",{onClick:()=>_(null),className:"btn btn-ghost btn-circle btn-sm text-error hover:bg-transparent hover:text-red-500",children:e.jsx(Te,{})})]})}),e.jsxs("div",{className:"flex flex-col gap-5 sm:grid sm:grid-cols-2",children:[(l==null?void 0:l.supplier_confirmation_id)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Order ID/GDS PNR"}),e.jsx("input",{type:"text",name:"supplier_confirmation_id",className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(n==null?void 0:n.supplier_confirmation_id)||"",onChange:y=>h(o=>({...o,supplier_confirmation_id:y.target.value}))})]}),(l==null?void 0:l.airlines_pnr)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Airlines PNR"}),e.jsx("input",{type:"text",name:"airlines_pnr",className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(n==null?void 0:n.airlines_pnr)||"",onChange:y=>h(o=>({...o,airlines_pnr:y.target.value}))})]}),(l==null?void 0:l.booking_status)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Booking Status"}),e.jsxs("select",{type:"text",name:"booking_status",className:"w-full h-10 text-sm bg-transparent rounded select select-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(n==null?void 0:n.booking_status)||"hold",onChange:y=>h(o=>({...o,booking_status:y.target.value})),children:[e.jsx("option",{value:"hold",children:"Hold"}),e.jsx("option",{value:"confirm",children:"Confirm"}),e.jsx("option",{value:"cancel",children:"Cancel"})]})]}),(l==null?void 0:l.auto_cancel_status)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Auto Cancel Status"}),e.jsxs("select",{type:"text",name:"auto_cancel_status",className:"w-full h-10 text-sm bg-transparent rounded select select-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(n==null?void 0:n.auto_cancel_status)||"pending",onChange:y=>h(o=>({...o,auto_cancel_status:y.target.value})),children:[e.jsx("option",{value:"pending",children:"Schedule Auto Cancel"}),e.jsx("option",{value:"processing",children:"Cancel On Process"}),e.jsx("option",{value:"auto-cancel-review",children:"Auto Cancel Failed"}),e.jsx("option",{value:"auto-cancel",children:"Complete"})]})]}),(l==null?void 0:l.auto_cancel)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Auto Cancel"}),e.jsx(Os,{className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",disabled:!((n==null?void 0:n.auto_cancel_status)==="pending"||(n==null?void 0:n.auto_cancel_status)==="processing"),defaultValue:((n==null?void 0:n.auto_cancel_status)==="pending"||(n==null?void 0:n.auto_cancel_status)==="processing")&&(n==null?void 0:n.auto_cancel)||"",action:y=>h(o=>({...o,auto_cancel:y}))})]}),(l==null?void 0:l.ticket_status)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Ticket Status"}),e.jsxs("select",{type:"text",name:"ticket_status",className:"w-full h-10 text-sm bg-transparent rounded select select-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(n==null?void 0:n.ticket_status)||"queue",onChange:y=>h(o=>({...o,ticket_status:y.target.value})),children:[e.jsx("option",{value:"queue",children:"Pending Check"}),e.jsx("option",{value:"processing",children:"Verifying Ticket Number"}),e.jsx("option",{value:"issued",children:"Ticket Issued"})]})]}),(l==null?void 0:l.booking_remarks)==="YES"&&e.jsxs("label",{className:"col-span-2 gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Booking Remarks"}),e.jsx("textarea",{name:"booking_remarks",className:"w-full text-sm bg-transparent rounded textarea textarea-bordered focus:outline-0 focus:border-neutral/30",defaultValue:(n==null?void 0:n.booking_remarks)||"",onChange:y=>h(o=>({...o,booking_remarks:y.target.value}))})]}),(l==null?void 0:l.departure_airport)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Departure Airport"}),e.jsx(ue,{name:"departure_airport",className:"w-full h-10 text-sm bg-transparent !rounded input input-bordered min-h-8 focus:outline-0 focus:!border-neutral/30 !border-base-content/20",action:y=>h(o=>{var t;return{...o,departure_airport:((t=y==null?void 0:y.at(0))==null?void 0:t.value)||""}}),defaultValue:(n==null?void 0:n.departure_airport)||"",options:s})]}),(l==null?void 0:l.arrival_airport)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Arrival Airport"}),e.jsx(ue,{name:"arrival_airport",className:"w-full h-10 text-sm bg-transparent !rounded input input-bordered min-h-8 focus:outline-0 focus:!border-neutral/30 !border-base-content/20",action:y=>h(o=>{var t;return{...o,arrival_airport:((t=y==null?void 0:y.at(0))==null?void 0:t.value)||""}}),defaultValue:(n==null?void 0:n.arrival_airport)||"",options:s})]}),(l==null?void 0:l.supplier_uid)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Supplier UID"}),e.jsx(ue,{type:"text",name:"supplier_uid",className:"w-full h-10 text-sm bg-transparent !rounded input input-bordered min-h-8 focus:outline-0 focus:!border-neutral/30 !border-base-content/20",action:y=>h(o=>{var t;return{...o,supplier_uid:((t=y==null?void 0:y.at(0))==null?void 0:t.value)||""}}),defaultValue:(n==null?void 0:n.supplier_uid)||"",options:j})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx("button",{onClick:()=>te.close(),type:"button",className:"normal-case rounded-md btn btn-primary btn-outline",children:"Close"}),e.jsx("button",{type:"submit",className:"normal-case rounded-md btn btn-primary",children:r?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"animate-spin"})," Updating..."]}):e.jsx(e.Fragment,{children:"Update"})})]})]})};qe.propTypes={booking_details:F.object.isRequired,can_modify:F.object,airlines:F.array,airports:F.array,flight_supplier_options:F.array,refetchData:F.func};const De=({booking_details:a})=>{var _,C;const{data:l}=((_=D.useState())==null?void 0:_.supplier_option)||{},{can_modify:s}=((C=D.useState())==null?void 0:C.booking_manage)||{},j=ke(te),{axiosInstance:d}=ee(),v=l==null?void 0:l.map(f=>({label:`${f==null?void 0:f.title} (${f==null?void 0:f.supplier_uid})`,value:f==null?void 0:f.supplier_uid})),{data:n}=ie({queryKey:["AIRLINES_DATA"],queryFn:async()=>{var w,x;const f=await d.get("/tools/airlines-data");return(x=Object.values((w=f.data)==null?void 0:w.data))==null?void 0:x.map(i=>({label:`${i==null?void 0:i.airline_name} (${i==null?void 0:i.iata_code})`,value:i==null?void 0:i.iata_code}))}}),{data:h}=ie({queryKey:["AIRPORTS_DATA"],queryFn:async()=>{var w;return(w=(await d.get("/tools/airport-autosuggetion-data")).data)==null?void 0:w.map(x=>({label:`${x==null?void 0:x.airport_name} (${x==null?void 0:x.code})`,value:x==null?void 0:x.code}))}}),r=de(),u=()=>{r.invalidateQueries(["FLIGHT_BOOKING_DETAILS"])},g=()=>{j.fire({html:e.jsx(qe,{booking_details:a,can_modify:s,airlines:n,airports:h,flight_supplier_options:v,refetchData:u}),showConfirmButton:!1,showCloseButton:!0,customClass:{popup:"w-full max-w-5xl",htmlContainer:"!m-0",closeButton:"text-red-500"}})};return e.jsxs("button",{onClick:g,className:"h-8 font-normal normal-case rounded btn btn-outline btn-warning flex-nowrap whitespace-nowrap btn-xs",children:[e.jsx(Us,{className:"shrink-0"}),"Update Booking"]})};De.propTypes={booking_details:F.object.isRequired};const zs=["supernsn","administrator","manager"],Pe=({booking_details:a})=>{var O,y;const{user_access_level:l}=((O=J.useState())==null?void 0:O.user_data)||{},{booking:s,general:j,partner:d,tracking_id:v,flight:n}=a||{},{booking_manage:h,system_config:r}=D.useState(),{booking_auto_cancel:u,flight_confirm_cancel:g,flight_issue_ticket:_,flight_issue_ticket_reissue:C,flight_price_change_alert:f}=h||{},{service_type:S,timestamp:w,last_update:x}=j||{},{booking_status:i,ticket_status:c}=s||{},{search_parameter:T,modify:p}=n||{},{axiosInstance:m}=ee(),{member_id:N}=((y=J.useState())==null?void 0:y.user_data)||{},[I,U]=A.useState(!1),B=de(),M=async()=>{var o,t,$;if(!I){U(!0);try{const k=await m.post("/secure?pathName=/supplier-booking-details",{member_id:N,tracking_id:v});if(((o=k==null?void 0:k.data)==null?void 0:o.status)==="success")await B.invalidateQueries(["FLIGHT_BOOKING_DETAILS"]),re("success","Booking Details Synced",(t=k.data)==null?void 0:t.reason);else throw new Error(($=k==null?void 0:k.data)==null?void 0:$.reason)}catch(k){re("error","Sync Failed!",k.message)}finally{U(!1)}}};return e.jsxs("div",{className:"sticky p-4 rounded-lg bg-base-200 h-fit top-5 lg:col-span-2",children:[e.jsx("div",{className:`mb-5 rounded card ${s.booking_status==="hold"?"bg-warning border-warning":""} ${s.booking_status==="confirm"?"bg-success border-success":""} ${s.booking_status==="cancel"?"bg-error border-error":"bg-info border-info"}`,children:e.jsxs("div",{className:"gap-0 px-2 py-3 text-center card-body",children:[e.jsx("h3",{className:"text-2xl font-semibold leading-tight text-white capitalize",children:(u==null?void 0:u.toUpperCase())==="DISABLE"&&s.booking_status==="hold"?"Immediate Purchase":s.booking_status}),(u==null?void 0:u.toUpperCase())==="ACTIVE"&&((s==null?void 0:s.booking_status)==="confirm"||(s==null?void 0:s.booking_status)==="hold")&&e.jsx(e.Fragment,{children:e.jsx("p",{className:"text-sm",children:K(new Date(s.auto_cancel)).format("DD-MMM-YY HH:mma")})}),(u==null?void 0:u.toUpperCase())==="ACTIVE"&&s.booking_status==="hold"&&e.jsx(Ve,{auto_cancel:s.auto_cancel})]})}),e.jsx("div",{className:"mb-5 border rounded card",children:e.jsx("div",{className:"px-2 py-3 text-sm card-body",children:e.jsxs("ul",{className:"space-y-0.5",children:[e.jsx("li",{children:e.jsx("p",{className:"pb-2",children:"Booking Summery:"})}),e.jsxs("li",{className:"text-xs",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Created:"})," ",K(new Date(w*1e3)).format(`${r.default_date_format_print} HH:mm a`)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Last Update:"})," ",K(new Date(x*1e3)).format(`${r.default_date_format_print} HH:mm a`)]})]}),e.jsx("li",{children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Service Type:"})," ",S]})}),e.jsx("li",{children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Journey Type:"})," ",T.journey_type]})}),e.jsx("li",{children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:" Booking Status:"})," ",e.jsx("span",{className:`badge badge-sm text-white text-[10px] capitalize ${i==="hold"?"badge-warning":i==="confirm"?"badge-success":"badge-info"}`,children:i})]})}),i==="confirm"&&e.jsx("li",{children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Ticket Status:"})," ",e.jsx("span",{className:"badge badge-sm badge-secondary text-[10px] capitalize",children:c})]})})]})})}),["confirm","hold"].includes(s.booking_status)&&zs.includes(l)&&(p==null?void 0:p.itinerary)==="active"&&e.jsx("div",{className:"mb-5 border rounded card",children:e.jsxs("div",{className:"px-2 py-3 text-center card-body",children:[e.jsx("h5",{className:"text-sm font-semibold",children:"Manage Flight Booking"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.booking_status==="hold"&&e.jsx(e.Fragment,{children:(_==null?void 0:_.toUpperCase())==="ACTIVE"&&e.jsxs("button",{onClick:()=>{var o;return(o=document.getElementById("issue_ticket_modal"))==null?void 0:o.showModal()},className:"h-8 normal-case rounded btn btn-outline btn-success flex-nowrap whitespace-nowrap btn-xs",children:[e.jsx(q,{path:ve,size:.7})," ","Issue Ticket"]})}),s.booking_status==="confirm"&&(C==null?void 0:C.toUpperCase())==="ACTIVE"&&e.jsxs("button",{onClick:()=>{var o;return(o=document.getElementById("issue_ticket_modal"))==null?void 0:o.showModal()},className:"h-8 normal-case rounded btn btn-outline btn-success flex-nowrap whitespace-nowrap btn-xs",children:[e.jsx(q,{path:ve,size:.7})," ","Reissue Ticket"]}),(s.booking_status==="hold"||s.booking_status==="confirm")&&e.jsxs(e.Fragment,{children:[((g==null?void 0:g.toUpperCase())==="ACTIVE"||s.booking_status==="hold")&&e.jsxs("button",{onClick:()=>{var o;return(o=document.getElementById("cancel_flight_modal"))==null?void 0:o.showModal()},className:"h-8 normal-case rounded btn btn-outline btn-error flex-nowrap whitespace-nowrap btn-xs",children:[e.jsx(q,{path:bs,size:.7})," Cancel"," ",s.booking_status==="hold"?"Flight":"Ticket"]}),s.booking_status==="hold"&&(f==null?void 0:f.toUpperCase())==="YES"&&e.jsxs("button",{onClick:()=>{var o;return(o=document.getElementById("get_price_alert_modal"))==null?void 0:o.showModal()},className:"h-8 text-xs font-normal normal-case btn btn-outline btn-warning flex-nowrap whitespace-nowrap btn-xs",children:[e.jsx($s,{className:"shrink-0"}),"Get Price Alert"]}),e.jsx("button",{onClick:M,className:"h-8 text-xs font-normal normal-case btn btn-outline btn-info flex-nowrap whitespace-nowrap btn-xs",children:I?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Is,{}),"Sync Booking Details"]})}),e.jsx(De,{booking_details:a})]})]})]})}),e.jsx(Le,{details:d}),e.jsx(Re,{info:j}),e.jsx("div",{className:"flex items-center justify-between px-2 py-3 mb-5 space-y-1 border rounded",children:e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-semibold text-primary",children:[e.jsx(q,{path:js,size:.7})," Submitted Contacts Details to Airlines"]}),e.jsxs("p",{className:"text-xs",children:[e.jsx(q,{path:gs,size:.7})," Email:",d==null?void 0:d.agency_email]}),e.jsxs("p",{className:"text-xs",children:[e.jsx(q,{path:fs,size:.7})," Contact Number:"," ",d==null?void 0:d.agency_isd_code,d==null?void 0:d.agency_contact_no]})]})})]})};Pe.propTypes={booking_details:F.object.isRequired};const oa=()=>{const{site_title:a}=D.useState(),[l]=Ns(),s=l.get("tracking_id"),{user_data:{member_id:j}}=J.useState(w=>w),{axiosInstance:d}=ee(),{data:v,isLoading:n,error:h,refetch:r}=ie(["FLIGHT_BOOKING_DETAILS",s,j],async()=>{var i,c,T;const w=await d.post("/booking-details",{tracking_id:s,member_id:j}),x=(c=(i=w.data)==null?void 0:i.booking)==null?void 0:c.booking_status;if(["hold","confirm","cancel","initiated"].includes(x))return w.data;throw{...w,message:((T=w.data)==null?void 0:T.reason)||"Request failed!"}});if(n)return e.jsx(_s,{});if(h)throw h;const{general:{booking_id:u},booking:{booking_status:g},pax:{primary:_},flight:{modify:{itinerary:C}},special_notice_status:f,special_notice:S}=v;return e.jsxs(e.Fragment,{children:[e.jsx(ys,{children:e.jsxs("title",{children:["Flight Booking Details",a?" - "+a:""]})}),e.jsx("main",{className:"container min-h-screen pt-20 mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 gap-5 pt-2 lg:grid-cols-7",children:[e.jsx(Oe,{booking_details:v}),e.jsx(Pe,{booking_details:v})]})}),g==="hold"&&C==="active"&&e.jsxs(e.Fragment,{children:[e.jsx(Rs,{data:{booking_id:u,tracking_id:s},refetchBookingDetails:r}),e.jsx(qs,{data:{booking_id:u,tracking_id:s,guest_info:_}})]}),(g==="hold"||g==="confirm")&&C==="active"&&e.jsxs(e.Fragment,{children:[e.jsx(Ds,{data:{booking_id:u,tracking_id:s,guest_info:_}}),e.jsx(Ls,{data:{booking_id:u,tracking_id:s,booking_status:g,special_notice_status:f,special_notice:S},refetchBookingDetails:r}),e.jsx(Vs,{data:{booking_id:u,tracking_id:s},refetchBookingDetails:r})]})]})};export{oa as default};
