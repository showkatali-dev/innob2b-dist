import{o as S,e as b,q as e,a4 as K,a5 as L,T as P,m as Q,I as X,be as B,ab as G}from"./index-254b55ba.js";import{e as J,dc as T,c as U,aa as C,n as Z,W as O,ad as ee,b as te}from"./App-71368aaa.js";import{P as se}from"./PhoneNumberSelect-a059f26a.js";import{I as ae}from"./InputDateWithTime-8c64c144.js";import"./index-467d1d55.js";const ne=({pay_tracking_id:c})=>{var s;const{site_title:f}=S.useState(),{checkout_url:y}=((s=S.useState())==null?void 0:s.system_config)||{},[a,h]=b.useState(null),[n,d]=b.useState(!1),{data:m,isLoading:N}=J({queryKey:["PAYMENT_INFO",c],queryFn:async()=>{var l;const r=await C.post(`${y}/review`,{pay_tracking_id:c});return h(((l=r.data)==null?void 0:l.payment_option[0])||null),r.data}}),v=async()=>{var r,l;if(!n){d(!0);try{const i={pay_tracking_id:c,gateway_partner_code:a==null?void 0:a.gateway_partner_code},j=await C.post(`${y}/pay`,i);if(((r=j.data)==null?void 0:r.status)==="success")window.location.replace((l=j.data)==null?void 0:l.gateway_redirect_url);else throw new Error("Failed to process payment")}catch(i){console.error(i),P("error","Error",i==null?void 0:i.message)}finally{d(!1)}}};if(N)return e.jsx(K,{});if((m==null?void 0:m.status)!=="success")return e.jsx(T,{to:"/online-payment"});const{payment_option:p}=m||{},{amount:_,currency:u,charges:o,payable:w}=(a==null?void 0:a.gateway)||{};return e.jsxs("main",{className:"container min-h-screen pt-20",children:[e.jsx(L,{children:e.jsxs("title",{children:["Payment",f?" - "+f:""]})}),e.jsxs("div",{className:"w-full pt-2",children:[e.jsx("h3",{className:"pb-2 text-lg font-semibold",children:"Review Payment"}),e.jsx("hr",{className:"mb-4"}),e.jsxs("div",{className:"grid gap-5 overflow-hidden border rounded-lg sm:grid-cols-2 text-start",children:[e.jsx("div",{className:"p-5 bg-primary text-primary-content",children:e.jsxs("div",{children:[e.jsx("h1",{children:"Summary of Payment"}),e.jsxs("ul",{className:"pl-3 mt-4 text-sm leading-relaxed list-disc list-inside list text-primary-content/80",children:[e.jsxs("li",{className:"capitalize",children:["Payment Option: ",a==null?void 0:a.gateway_name]}),e.jsxs("li",{children:["Amount: ",_," ",u]}),e.jsxs("li",{children:["Fixed Charge: ",o==null?void 0:o.fixed_charge," ",u]}),e.jsxs("li",{children:["Service Fee: ",o==null?void 0:o.service_fee," ",u]}),e.jsxs("li",{children:["Total Payable: ",w," ",u]})]})]})}),e.jsxs("div",{className:"p-5 text-start",children:[e.jsx("h2",{className:"mb-2 text-lg font-semibold",children:"Select Payment Option"}),e.jsx("div",{className:"grid grid-cols-2 gap-5",children:p==null?void 0:p.map(r=>{const{gateway_name:l,gateway_code:i}=r||{};return e.jsxs("div",{onClick:()=>h(r),className:U("capitalize flex justify-center items-center rounded w-full ring-base-content/20 h-16 ring-[1px] !border-l-8 border-2 border-transparent cursor-pointer text-lg font-bold text-primary gap-1",(a==null?void 0:a.gateway_name)===l&&"border-warning ring-0"),children:[e.jsx("img",{src:i==="stripe"?"/stripe_logo.webp":"/bkash_logo.png",alt:"",className:"w-8"})," ",e.jsx("span",{children:l})]},i)})}),e.jsx("div",{className:"flex justify-end mt-12",children:e.jsx("button",{onClick:v,className:"h-10 min-h-0 text-base font-normal normal-case rounded btn btn-primary",children:n?"Processing...":"Pay Now"})})]})]})]})]})},de=()=>{var F;const{site_title:c,system_config:f}=S.useState(),{checkout_url:y}=f||{},[a,h]=b.useState(!1),[n,d]=b.useState(null),{member_id:m,fullname:N,email:v,partner_id:p,default_currency:_,isd_code:u,mobile:o,login_key:w}=((F=Q.useState())==null?void 0:F.user_data)||{},[s,r]=b.useState({isd_code:u,contact_number:o,service_details:"",name:N,email:v,amount:"",payment_link_valid:""}),[l]=Z(),i=l.get("pay_tracking_id"),j=async t=>{var E,I,D;if(t.preventDefault(),a)return;h(!0),d(null);const{name:A,email:M,isd_code:V,contact_number:z,amount:R,service_details:W,payment_link_valid:q}=s,{origin:k}=location,H={name:A,email:M,member_id:m,isd_code:V,contact_number:z,ftm_partner_id:p,service_details:W,payment_type:"amount",amount:R,currency:_,payment_link_valid:q,collection_type:"payment_link",tracking_id:G().slice(0,8),payment_link_base_url:k+"/online-payment",redirect_url:k+"/online-payment/status"};try{const x=await C.post(`${y}/request`,H);if(((E=x.data)==null?void 0:E.status)==="success"){const{pay_tracking_id:Y}=x.data;d({payment_link:`${k}/online-payment?pay_tracking_id=${Y}`,pay_link_valid:q,message:(I=x.data)==null?void 0:I.reason})}else P("error","Sending Failed!",(D=x.data)==null?void 0:D.reason)}catch(x){P("error","Sending Failed!",x.message)}finally{h(!1)}};let{pathname:g,search:$}=O();return g=g.endsWith("/")?g.slice(0,-1):g,i?e.jsx(ne,{pay_tracking_id:i}):w?e.jsxs("main",{className:"container min-h-screen pt-20",children:[e.jsx(L,{children:e.jsxs("title",{children:["Payment",c?" - "+c:""]})}),e.jsxs("form",{onSubmit:j,className:"w-full pt-2",children:[e.jsx("h3",{className:"pb-2 text-lg font-semibold",children:"Send Payment Link"}),e.jsx("hr",{className:"mb-4"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-y-4 gap-x-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Enter your name."}),e.jsx("input",{autoComplete:"off",type:"text",name:"name",className:"w-full h-10 text-sm rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30 ",value:s.name,onChange:t=>r({...s,name:t.target.value}),required:!0,placeholder:"Name"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Enter Your Email"}),e.jsx("input",{autoComplete:"off",type:"text",name:"receiver_id",className:"w-full h-10 text-sm rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30 ",value:s.email,onChange:t=>r({...s,email:t.target.value}),required:!0,placeholder:"Email"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Mobile"}),e.jsx(se,{placeholder:"Enter Mobile Number",className:"!h-10 !text-sm !bg-transparent !rounded input !input-bordered focus:outline-0 min-h-8 !w-full",defaultValue:String(s.isd_code||"")+String(s.contact_number||""),action:t=>r({...s,isd_code:t==null?void 0:t.isd_code,contact_number:t==null?void 0:t.mobile})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Input Amount."}),e.jsxs("div",{className:"w-full join",children:[e.jsx("span",{className:"flex items-center px-4 border rounded-l bg-neutral/10 text-neutral join-item border-neutral/20",children:_}),e.jsx("input",{autoComplete:"off",type:"text",name:"amount",className:"flex-1 w-full h-10 text-sm rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30 hide_arrow_key join-item",value:s.amount||"",onChange:t=>r({...s,amount:t.target.value}),required:!0,placeholder:"Amount"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Service Details."}),e.jsx("textarea",{type:"text",name:"service_details",className:"w-full text-sm rounded textarea textarea-bordered min-h-16 focus:outline-0 focus:border-neutral/30",required:!0,value:s.service_details||"",onChange:t=>r({...s,service_details:t.target.value}),placeholder:"Service Details",maxLength:249})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Input Validity."}),e.jsx(ae,{name:"payment_link_valid",action:t=>r({...s,payment_link_valid:t}),defaultValue:s.payment_link_valid,minDate:"today",className:"w-full h-10 text-sm rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",required:!0,placeholder:"Valid till"})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{type:"submit",className:`normal-case btn btn-primary rounded-md min-w-[160px] shadow shadow-primary/30 min-h-0 h-10 ${a?"pointer-events-none":""}`,children:a?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"mr-2 animate-spin"})," Processing..."]}):"Send"})})]}),n&&e.jsxs("div",{className:"relative flex items-center gap-4 p-4 mt-8 border rounded-lg border-success bg-success/10 text-success",children:[e.jsx("button",{onClick:()=>d(null),className:"absolute top-1 right-1 btn btn-ghost btn-circle btn-sm",children:e.jsx(te,{})}),e.jsx("button",{onClick:t=>{navigator.clipboard.writeText(n==null?void 0:n.payment_link),t.target.textContent="Copied",setTimeout(()=>t.target.textContent="Copy",2e3)},className:"absolute font-normal normal-case bottom-1 right-2 !glass btn btn-ghost btn-xs text-primary/70 hover:text-primary",children:"Copy link"}),e.jsx(X,{path:B,size:1,className:"text-xl"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:n==null?void 0:n.message}),e.jsxs("p",{children:["Payment link:"," ",e.jsx("a",{href:n==null?void 0:n.payment_link,target:"_blank",rel:"noreferrer",children:n==null?void 0:n.payment_link}),"."]})]})]})]}):e.jsx(T,{to:"/login",replace:!0,state:{pathname:g+$}})};export{de as default};
