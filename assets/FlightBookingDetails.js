import{e as T,o as e,m as M,u as z,l as R,Q as q,O as J,I as O,at as H,au as Z,X as ee,Y as se}from"./index.js";import{P as v,a as V,b as P,S as $,T as K,q as te}from"./App.js";import{B as ae}from"./index4.js";import{c as re,d as ne,e as le}from"./index.esm2.js";import{b as oe,c as ce}from"./index.esm3.js";import{B as ie,a as ue}from"./BookingAgencyDetails.js";import{w as de}from"./sweetalert2-react-content.es.js";import{S as U}from"./SingleSelect.js";import{I as pe}from"./InputDateWithTime.js";import{I as me,C as he,G as xe}from"./GetPriceAlertModal.js";import{S as ge,a as je}from"./SendBookingPayLinkModal.js";import"./index.esm4.js";import"./navigation2.js";import"./navigation.js";import"./pp.js";import"./InputDate.js";import"./shortcut-buttons-flatpickr.min.js";import"./PhoneNumberSelect.js";import"./FlightItineraryData.js";import"./ActivityLogs.js";import"./RefundData.js";const Q=({auto_cancel:t})=>{const[a,r]=T.useState(b(t));T.useEffect(()=>{const l=setInterval(()=>{r(b(t))},1e3);return()=>clearInterval(l)},[t]);function b(l){const o=new Date,m=new Date(l)-o;if(m<=0)return{days:0,hours:0,minutes:0,seconds:0};const x=Math.floor(m/(1e3*60*60*24)),c=Math.floor(m%(1e3*60*60*24)/(1e3*60*60)),C=Math.floor(m%(1e3*60*60)/(1e3*60)),d=Math.floor(m%(1e3*60)/1e3);return{days:x,hours:c,minutes:C,seconds:d}}const{days:w,hours:j,minutes:S,seconds:s}=a;return e.jsx("div",{className:"mb-5 rounded card bg-error border-error",children:e.jsxs("div",{className:"p-5 text-center card-body",children:[e.jsx("p",{className:"text-sm text-white",children:"System will cancel the booking automatically"}),e.jsx("h3",{className:"mt-2 font-mono text-2xl font-extrabold text-white capitalize",children:`${w}d ${j}h ${S}m ${s}s`})]})})};Q.propTypes={auto_cancel:v.string};const W=({booking_details:t,can_modify:a,airlines:r,airports:b,flight_supplier_options:w,refetchData:j})=>{var d,u,p,I,k,A,B,y,h,E,F,f,L,Y;const{member_id:S}=((d=R.useState())==null?void 0:d.user_data)||{},[s,l]=T.useState({tracking_id:(t==null?void 0:t.tracking_id)||"",member_id:S,supplier_uid:((p=(u=t==null?void 0:t.supplier)==null?void 0:u.info)==null?void 0:p.supplier_uid)||"",supplier_confirmation_id:((I=t==null?void 0:t.general)==null?void 0:I.supplier_confirmation_id)||"",airlines_pnr:((k=t==null?void 0:t.general)==null?void 0:k.airlines_pnr)||"",booking_status:((A=t==null?void 0:t.booking)==null?void 0:A.booking_status)||"hold",ticket_status:((B=t==null?void 0:t.booking)==null?void 0:B.ticket_status)||"queue",departure_airport:((y=t==null?void 0:t.flight)==null?void 0:y.departure_airport)||"",arrival_airport:((h=t==null?void 0:t.flight)==null?void 0:h.arrival_airport)||"",journey_type:((F=(E=t==null?void 0:t.flight)==null?void 0:E.search_parameter)==null?void 0:F.journey_type)||"OneWay",auto_cancel_status:((f=t==null?void 0:t.booking)==null?void 0:f.auto_cancel_status)||"pending",auto_cancel:((L=t==null?void 0:t.booking)==null?void 0:L.auto_cancel)||"",booking_remarks:((Y=t==null?void 0:t.general)==null?void 0:Y.booking_remarks)||""}),[o,g]=T.useState(!1),[m,x]=T.useState(null),{axiosInstance:c}=V(),C=async n=>{var i,N,G;if(n.preventDefault(),!o){x(null),g(!0);try{const _=await c.post("/flight/update-booking-info",s);if(((i=_.data)==null?void 0:i.status)==="success")$.close(),j(),q("success","Success!",(N=_.data)==null?void 0:N.reason);else throw new Error((G=_==null?void 0:_.data)==null?void 0:G.reason)}catch(_){console.error(_),x(_.message)}finally{g(!1)}}};return e.jsxs("form",{onSubmit:C,className:"relative px-6 py-4 text-start",children:[e.jsx("h3",{className:"pb-2 text-lg font-semibold",children:"Update Booking Info"}),e.jsx("hr",{className:"mb-4"}),m&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 py-1 pl-4 mx-auto border border-l-4 rounded-r border-warning text-warning w-fit",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(re,{})}),e.jsx("div",{className:"text-sm",children:m})]}),e.jsx("button",{onClick:()=>x(null),className:"btn btn-ghost btn-circle btn-sm text-error hover:bg-transparent hover:text-red-500",children:e.jsx(ne,{})})]})}),e.jsxs("div",{className:"flex flex-col gap-5 sm:grid sm:grid-cols-2",children:[(a==null?void 0:a.supplier_confirmation_id)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Order ID/GDS PNR"}),e.jsx("input",{type:"text",name:"supplier_confirmation_id",className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(s==null?void 0:s.supplier_confirmation_id)||"",onChange:n=>l(i=>({...i,supplier_confirmation_id:n.target.value}))})]}),(a==null?void 0:a.airlines_pnr)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Airlines PNR"}),e.jsx("input",{type:"text",name:"airlines_pnr",className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(s==null?void 0:s.airlines_pnr)||"",onChange:n=>l(i=>({...i,airlines_pnr:n.target.value}))})]}),(a==null?void 0:a.booking_status)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Booking Status"}),e.jsxs("select",{type:"text",name:"booking_status",className:"w-full h-10 text-sm bg-transparent rounded select select-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(s==null?void 0:s.booking_status)||"hold",onChange:n=>l(i=>({...i,booking_status:n.target.value})),children:[e.jsx("option",{value:"hold",children:"Hold"}),e.jsx("option",{value:"confirm",children:"Confirm"}),e.jsx("option",{value:"cancel",children:"Cancel"})]})]}),(a==null?void 0:a.auto_cancel_status)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Auto Cancel Status"}),e.jsxs("select",{type:"text",name:"auto_cancel_status",className:"w-full h-10 text-sm bg-transparent rounded select select-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(s==null?void 0:s.auto_cancel_status)||"pending",onChange:n=>l(i=>({...i,auto_cancel_status:n.target.value})),children:[e.jsx("option",{value:"pending",children:"Schedule Auto Cancel"}),e.jsx("option",{value:"processing",children:"Cancel On Process"}),e.jsx("option",{value:"auto-cancel-review",children:"Auto Cancel Failed"}),e.jsx("option",{value:"auto-cancel",children:"Complete"})]})]}),(a==null?void 0:a.auto_cancel)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Auto Cancel"}),e.jsx(pe,{className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",disabled:!((s==null?void 0:s.auto_cancel_status)==="pending"||(s==null?void 0:s.auto_cancel_status)==="processing"),defaultValue:((s==null?void 0:s.auto_cancel_status)==="pending"||(s==null?void 0:s.auto_cancel_status)==="processing")&&(s==null?void 0:s.auto_cancel)||"",action:n=>l(i=>({...i,auto_cancel:n}))})]}),(a==null?void 0:a.ticket_status)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Ticket Status"}),e.jsxs("select",{type:"text",name:"ticket_status",className:"w-full h-10 text-sm bg-transparent rounded select select-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(s==null?void 0:s.ticket_status)||"queue",onChange:n=>l(i=>({...i,ticket_status:n.target.value})),children:[e.jsx("option",{value:"queue",children:"Pending Check"}),e.jsx("option",{value:"processing",children:"Verifying Ticket Number"}),e.jsx("option",{value:"issued",children:"Ticket Issued"})]})]}),(a==null?void 0:a.booking_remarks)==="YES"&&e.jsxs("label",{className:"col-span-2 gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Booking Remarks"}),e.jsx("textarea",{name:"booking_remarks",className:"w-full text-sm bg-transparent rounded textarea textarea-bordered focus:outline-0 focus:border-neutral/30",defaultValue:(s==null?void 0:s.booking_remarks)||"",onChange:n=>l(i=>({...i,booking_remarks:n.target.value}))})]}),(a==null?void 0:a.departure_airport)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Departure Airport"}),e.jsx(U,{name:"departure_airport",className:"w-full h-10 text-sm bg-transparent !rounded input input-bordered min-h-8 focus:outline-0 focus:!border-neutral/30 !border-base-content/20",action:n=>l(i=>{var N;return{...i,departure_airport:((N=n==null?void 0:n.at(0))==null?void 0:N.value)||""}}),defaultValue:(s==null?void 0:s.departure_airport)||"",options:b})]}),(a==null?void 0:a.arrival_airport)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Arrival Airport"}),e.jsx(U,{name:"arrival_airport",className:"w-full h-10 text-sm bg-transparent !rounded input input-bordered min-h-8 focus:outline-0 focus:!border-neutral/30 !border-base-content/20",action:n=>l(i=>{var N;return{...i,arrival_airport:((N=n==null?void 0:n.at(0))==null?void 0:N.value)||""}}),defaultValue:(s==null?void 0:s.arrival_airport)||"",options:b})]}),(a==null?void 0:a.supplier_uid)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Supplier UID"}),e.jsx(U,{type:"text",name:"supplier_uid",className:"w-full h-10 text-sm bg-transparent !rounded input input-bordered min-h-8 focus:outline-0 focus:!border-neutral/30 !border-base-content/20",action:n=>l(i=>{var N;return{...i,supplier_uid:((N=n==null?void 0:n.at(0))==null?void 0:N.value)||""}}),defaultValue:(s==null?void 0:s.supplier_uid)||"",options:w})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx("button",{onClick:()=>$.close(),type:"button",className:"normal-case rounded-md btn btn-primary btn-outline",children:"Close"}),e.jsx("button",{type:"submit",className:"normal-case rounded-md btn btn-primary",children:o?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"animate-spin"})," Updating..."]}):e.jsx(e.Fragment,{children:"Update"})})]})]})};W.propTypes={booking_details:v.object.isRequired,can_modify:v.object,airlines:v.array,airports:v.array,flight_supplier_options:v.array,refetchData:v.func};const D=({booking_details:t})=>{var m,x;const{data:a}=((m=M.useState())==null?void 0:m.supplier_option)||{},{can_modify:r}=((x=M.useState())==null?void 0:x.booking_manage)||{},b=de($),{axiosInstance:w}=V(),j=a==null?void 0:a.map(c=>({label:`${c==null?void 0:c.title} (${c==null?void 0:c.supplier_uid})`,value:c==null?void 0:c.supplier_uid})),{data:S}=P({queryKey:["AIRLINES_DATA"],queryFn:async()=>{var d,u;const c=await w.get("/tools/airlines-data");return(u=Object.values((d=c.data)==null?void 0:d.data))==null?void 0:u.map(p=>({label:`${p==null?void 0:p.airline_name} (${p==null?void 0:p.iata_code})`,value:p==null?void 0:p.iata_code}))}}),{data:s}=P({queryKey:["AIRPORTS_DATA"],queryFn:async()=>{var d;return(d=(await w.get("/tools/airport-autosuggetion-data")).data)==null?void 0:d.map(u=>({label:`${u==null?void 0:u.airport_name} (${u==null?void 0:u.code})`,value:u==null?void 0:u.code}))}}),l=z(),o=()=>{l.invalidateQueries(["FLIGHT_BOOKING_DETAILS"])},g=()=>{b.fire({html:e.jsx(W,{booking_details:t,can_modify:r,airlines:S,airports:s,flight_supplier_options:j,refetchData:o}),showConfirmButton:!1,showCloseButton:!0,customClass:{popup:"w-full max-w-5xl",htmlContainer:"!m-0",closeButton:"text-red-500"}})};return e.jsxs("button",{onClick:g,className:"font-normal normal-case btn btn-outline btn-warning flex-nowrap whitespace-nowrap",children:[e.jsx(oe,{className:"text-lg"}),"Update Booking Info"]})};D.propTypes={booking_details:v.object.isRequired};const be=["supernsn","administrator","manager"],X=({booking_details:t})=>{var A,B,y;const{user_access_level:a}=((A=R.useState())==null?void 0:A.user_data)||{},{booking:r,general:b,partner:w,flight:j,tracking_id:S}=t||{},{system_config:s,booking_manage:l}=M.useState(),{booking_auto_cancel:o,flight_confirm_cancel:g,flight_issue_ticket:m,flight_issue_ticket_reissue:x,flight_price_change_alert:c}=l||{},{axiosInstance:C}=V(),{member_id:d}=((B=R.useState())==null?void 0:B.user_data)||{},[u,p]=T.useState(!1),I=z(),k=async()=>{var h,E,F;if(!u){p(!0);try{const f=await C.post("/secure?pathName=/supplier-booking-details",{member_id:d,tracking_id:S});if(((h=f==null?void 0:f.data)==null?void 0:h.status)==="success")await I.invalidateQueries(["FLIGHT_BOOKING_DETAILS"]),q("success","Booking Details Synced",(E=f.data)==null?void 0:E.reason);else throw new Error((F=f==null?void 0:f.data)==null?void 0:F.reason)}catch(f){q("error","Sync Failed!",f.message)}finally{p(!1)}}};return e.jsxs("div",{className:"sticky p-4 rounded-lg bg-base-200 h-fit top-5",children:[e.jsx("div",{className:`mb-5 rounded card ${r.booking_status==="hold"?"bg-warning border-warning":""} ${r.booking_status==="confirm"?"bg-success border-success":""} ${r.booking_status==="cancel"?"bg-error border-error":"bg-info border-info"}`,children:e.jsxs("div",{className:"p-5 text-center card-body",children:[e.jsx("h3",{className:"mb-2 text-2xl font-semibold text-white capitalize",children:(o==null?void 0:o.toUpperCase())==="DISABLE"&&r.booking_status==="hold"?"Immediate Purchase":r.booking_status}),(o==null?void 0:o.toUpperCase())==="ACTIVE"&&((r==null?void 0:r.booking_status)==="confirm"||(r==null?void 0:r.booking_status)==="hold")&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm",children:(r==null?void 0:r.booking_status)==="hold"?"Auto Release of Bookings":"Last Update"}),e.jsx("p",{className:"text-sm",children:J(new Date(r.auto_cancel)).format(`dddd, ${s.default_date_format_print} HH:mma`)})]})]})}),(o==null?void 0:o.toUpperCase())==="ACTIVE"&&r.booking_status==="hold"&&e.jsx(Q,{auto_cancel:r.auto_cancel}),["confirm","hold"].includes(r.booking_status)&&be.includes(a)&&((y=j==null?void 0:j.modify)==null?void 0:y.itinerary)==="active"&&e.jsx("div",{className:"mb-5 border rounded card",children:e.jsxs("div",{className:"p-5 text-center card-body",children:[e.jsx("h5",{className:"mb-1 font-semibold",children:"Manage Flight Booking"}),e.jsxs("div",{className:"grid gap-2",children:[r.booking_status==="hold"&&e.jsx(e.Fragment,{children:(m==null?void 0:m.toUpperCase())==="ACTIVE"&&e.jsxs("button",{onClick:()=>{var h;return(h=document.getElementById("issue_ticket_modal"))==null?void 0:h.showModal()},className:"normal-case btn btn-outline btn-success flex-nowrap whitespace-nowrap",children:[e.jsx(O,{path:H,size:.8})," ","Issue Ticket"]})}),r.booking_status==="confirm"&&(x==null?void 0:x.toUpperCase())==="ACTIVE"&&e.jsxs("button",{onClick:()=>{var h;return(h=document.getElementById("issue_ticket_modal"))==null?void 0:h.showModal()},className:"normal-case btn btn-outline btn-success flex-nowrap whitespace-nowrap",children:[e.jsx(O,{path:H,size:.8})," ","Reissue Ticket"]}),(r.booking_status==="hold"||r.booking_status==="confirm")&&e.jsxs(e.Fragment,{children:[((g==null?void 0:g.toUpperCase())==="ACTIVE"||r.booking_status==="hold")&&e.jsxs("button",{onClick:()=>{var h;return(h=document.getElementById("cancel_flight_modal"))==null?void 0:h.showModal()},className:"normal-case btn btn-outline btn-error flex-nowrap whitespace-nowrap",children:[e.jsx(O,{path:Z,size:.8})," Cancel"," ",r.booking_status==="hold"?"Flight":"Ticket"]}),r.booking_status==="hold"&&(c==null?void 0:c.toUpperCase())==="YES"&&e.jsxs("button",{onClick:()=>{var h;return(h=document.getElementById("get_price_alert_modal"))==null?void 0:h.showModal()},className:"font-normal normal-case btn btn-outline btn-warning flex-nowrap whitespace-nowrap",children:[e.jsx(ce,{className:"text-lg"}),"Get Price Alert"]}),e.jsx("button",{onClick:k,className:"font-normal normal-case btn btn-outline btn-info flex-nowrap whitespace-nowrap",children:u?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{}),"Sync Booking Details"]})}),e.jsx(D,{booking_details:t})]})]})]})}),e.jsx(ie,{details:w}),e.jsx(ue,{info:b})]})};X.propTypes={booking_details:v.object.isRequired};const Pe=()=>{const{site_title:t}=M.useState(),[a]=te(),r=a.get("tracking_id"),{user_data:{member_id:b}}=R.useState(d=>d),{axiosInstance:w}=V(),{data:j,isLoading:S,error:s,refetch:l}=P(["FLIGHT_BOOKING_DETAILS",r,b],async()=>{var p,I,k;const d=await w.post("/booking-details",{tracking_id:r,member_id:b}),u=(I=(p=d.data)==null?void 0:p.booking)==null?void 0:I.booking_status;if(["hold","confirm","cancel","initiated"].includes(u))return d.data;throw{...d,message:((k=d.data)==null?void 0:k.reason)||"Request failed!"}});if(S)return e.jsx(ee,{});if(s)throw s;const{general:{booking_id:o},booking:{booking_status:g},pax:{primary:m},flight:{modify:{itinerary:x}},special_notice_status:c,special_notice:C}=j;return e.jsxs(e.Fragment,{children:[e.jsx(se,{children:e.jsxs("title",{children:["Flight Booking Details",t?" - "+t:""]})}),e.jsx("main",{className:"container min-h-screen pt-20 mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 gap-5 pt-2 lg:grid-cols-4",children:[e.jsx(ae,{booking_details:j}),e.jsx(X,{booking_details:j})]})}),g==="hold"&&x==="active"&&e.jsxs(e.Fragment,{children:[e.jsx(me,{data:{booking_id:o,tracking_id:r},refetchBookingDetails:l}),e.jsx(ge,{data:{booking_id:o,tracking_id:r,guest_info:m}})]}),(g==="hold"||g==="confirm")&&x==="active"&&e.jsxs(e.Fragment,{children:[e.jsx(je,{data:{booking_id:o,tracking_id:r,guest_info:m}}),e.jsx(he,{data:{booking_id:o,tracking_id:r,booking_status:g,special_notice_status:c,special_notice:C},refetchBookingDetails:l}),e.jsx(xe,{data:{booking_id:o,tracking_id:r},refetchBookingDetails:l})]})]})};export{Pe as default};
