import{R as p,e as T,u as W,q as r,m as z,Q as G,T as H}from"./index-6d69b58d.js";import{W as X,d as Y,o as Z,dc as $,Q as ee,ej as te}from"./App-3b6aba26.js";var R=function(n){return typeof n=="object"&&n!==null},ne=function(n){var D=n.value,y=D===void 0?"":D,v=n.numInputs,i=v===void 0?4:v,k=n.onChange,_=n.onPaste,O=n.renderInput,b=n.shouldAutoFocus,x=b===void 0?!1:b,S=n.inputType,I=S===void 0?"text":S,j=n.renderSeparator,m=n.placeholder,h=n.containerStyle,u=n.inputStyle,w=n.skipDefaultStyles,C=w===void 0?!1:w,f=p.useState(0),s=f[0],N=f[1],l=p.useRef([]),g=function(){return y?y.toString().split(""):[]},E=I==="number"||I==="tel";p.useEffect(function(){l.current=l.current.slice(0,i)},[i]),p.useEffect(function(){var e;x&&((e=l.current[0])===null||e===void 0||e.focus())},[x]);var M=function(){if(typeof m=="string"){if(m.length===i)return m;m.length>0&&console.error("Length of the placeholder should be equal to the number of inputs.")}},L=function(e){var t=E?!isNaN(Number(e)):typeof e=="string";return t&&e.trim().length===1},V=function(e){var t=e.target.value;L(t)&&(A(t),d(s+1))},q=function(e){var t=e.nativeEvent,a=e.target.value;if(!L(a)){if(a.length===i){var o=a.split("").some(function(c){return!L(c)});o||(F(a.split("")),d(i-1))}t.data===null&&t.inputType==="deleteContentBackward"&&(e.preventDefault(),A(""),d(s-1)),e.target.value=""}},B=function(e){return function(t){N(t),e.target.select()}},Q=function(){N(s-1)},K=function(e){var t=g();[e.code,e.key].includes("Backspace")?(e.preventDefault(),A(""),d(s-1)):e.code==="Delete"?(e.preventDefault(),A("")):e.code==="ArrowLeft"?(e.preventDefault(),d(s-1)):e.code==="ArrowRight"||e.key===t[s]?(e.preventDefault(),d(s+1)):(e.code==="Spacebar"||e.code==="Space"||e.code==="ArrowUp"||e.code==="ArrowDown")&&e.preventDefault()},d=function(e){var t,a,o=Math.max(Math.min(i-1,e),0);l.current[o]&&((t=l.current[o])===null||t===void 0||t.focus(),(a=l.current[o])===null||a===void 0||a.select(),N(o))},A=function(e){var t=g();t[s]=e[0],F(t)},F=function(e){var t=e.join("");k(t)},U=function(e){var t;e.preventDefault();var a=g(),o=s,c=e.clipboardData.getData("text/plain").slice(0,i-s).split("");if(!(E&&c.some(function(J){return isNaN(Number(J))}))){for(var P=0;P<i;++P)P>=s&&c.length>0&&(a[P]=(t=c.shift())!==null&&t!==void 0?t:"",o++);d(o),F(a)}};return p.createElement("div",{style:Object.assign({display:"flex",alignItems:"center"},R(h)&&h),className:typeof h=="string"?h:void 0,onPaste:_},Array.from({length:i},function(e,t){return t}).map(function(e){var t,a,o;return p.createElement(p.Fragment,{key:e},O({value:(t=g()[e])!==null&&t!==void 0?t:"",placeholder:(o=(a=M())===null||a===void 0?void 0:a[e])!==null&&o!==void 0?o:void 0,ref:function(c){return l.current[e]=c},onChange:V,onFocus:function(c){return B(c)(e)},onBlur:Q,onKeyDown:K,onPaste:U,autoComplete:"off","aria-label":"Please enter OTP character ".concat(e+1),style:Object.assign(C?{}:{width:"1em",textAlign:"center"},R(u)?u:{}),className:typeof u=="string"?u:void 0,type:I,inputMode:E?"numeric":"text",onInput:q},e),e<i-1&&(typeof j=="function"?j(e):j))}))};const se=({redirectTo:n=null})=>{const[D,y]=T.useState(!1),[v,i]=T.useState(""),[k,_]=T.useState(!1),{state:O}=X(),{email:b,password:x,member_id:S}=O||{},{axiosInstance:I}=Y(),j=W(),m=Z();if(!b||!x||!S)return r.jsx($,{to:"/login",from:{redirectTo:n}});const h=async u=>{var w,C;if(u.preventDefault(),!!v){y(!0);try{const f=await I.post("/user/secure-login-otp",{email:b,password:x,member_id:S,otp:v,save_device:k?"yes":"no"});if(((w=f.data)==null?void 0:w.status)==="success"){const{login_key:s,member_id:N,token:l}=f.data;localStorage.setItem("user_info",JSON.stringify({login_key:s,member_id:N,token:l})),z.update(g=>{g.token=l}),j.invalidateQueries({queryKey:["USER_INFO"]}),G(),n&&m(n)}else throw new Error(((C=f.data)==null?void 0:C.reason)||"Something wrong!")}catch(f){H("error","Failed!",f.message)}finally{y(!1)}}};return D?r.jsx(ee,{}):r.jsxs("form",{onSubmit:h,children:[r.jsx("p",{className:"mb-8 text-sm text-center text-neutral/80",children:"Please enter the OTP, sent to your email"}),r.jsxs("div",{className:"flex flex-col w-full gap-y-4",children:[r.jsx("div",{className:"flex items-center justify-center mb-3",children:r.jsx(ne,{value:v,onChange:i,numInputs:5,renderSeparator:r.jsx("span",{}),renderInput:u=>r.jsx("input",{...u,className:"!w-12 rounded input input-bordered !outline-0 bg-transparent mx-1"})})}),r.jsx("div",{className:"flex justify-between",children:r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-neutral",children:[r.jsx("input",{type:"checkbox",className:"bg-red-500 border-red-500 checked:bg-success checked:border-success toggle",checked:k,onChange:u=>_(u.target.checked)}),r.jsx("span",{children:"Save device"})]})}),r.jsxs("button",{type:"submit",className:"h-10 min-h-0 font-normal normal-case transition-all duration-300 rounded-full shadow-lg btn btn-primary shadow-primary/50 hover:shadow-none",children:["Log In ",r.jsx(te,{})]})]})]})};export{se as L};
