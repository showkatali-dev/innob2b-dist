import{ac as V,o as e,m as S,Q as g,G as f,U as C,e as m,a5 as A,a6 as P}from"./index-310eb18e.js";import{P as _,aq as R,ar as q,ag as B,as as O,e as h,at as U,au as L,x as T,an as Q,ao as z,a as J,c as K,w as W,b as X}from"./App-a086c8b0.js";import{I as Z}from"./InputDateRange-dd2f98c1.js";import{D as $}from"./DropDownSelectCheckout-70736dec.js";import{T as Y}from"./TextInputCheckout-3f3801aa.js";import{h as j}from"./index.esm-8d26453f.js";import{B as ee}from"./BookingList2-6b12fafc.js";import"./shortcut-buttons-flatpickr.min-fbf85869.js";import"./SingleSelect-725dcd70.js";import"./index.esm-1baba325.js";const N=({label:o,isRequired:p=!1,action:x,defaultValue:r,placeholder:i="",minDate:t})=>{const d=V();return e.jsxs("div",{className:"sb-input-container",children:[e.jsxs("label",{className:"sb-label",htmlFor:d,children:[o," ",p&&"*"]}),e.jsx(Z,{action:x,className:"sb-input",defaultValue:r,minDate:t,placeholder:i})]})};N.propTypes={label:_.string.isRequired,isRequired:_.bool,action:_.func.isRequired,defaultValue:_.array,minDate:_.string,placeholder:_.string};const ae=({booking_lists:o})=>{const{booking_manage:p}=S.useState(),{booking_auto_cancel:x}=p||{};return e.jsx("div",{className:"w-full mb-8 overflow-x-auto",children:e.jsxs("table",{className:"table text-sm mb-28 booking-list-table bg-base-200",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary/10 text-primary",children:[e.jsx("th",{className:"text-sm border border-t-4 border-t-primary-focus",children:"Sl"}),e.jsx("th",{className:"text-sm border border-t-4 border-t-primary-focus",children:"Reference"}),e.jsx("th",{className:"text-sm border border-t-4 border-t-primary-focus",children:"Stay (Departure & Arrival)"}),e.jsx("th",{className:"text-sm border border-t-4 border-t-primary-focus",children:"Hotel/Airlines"}),e.jsx("th",{className:"text-sm border border-t-4 border-t-primary-focus",children:"Amount"}),e.jsx("th",{className:"text-sm border border-t-4 border-t-primary-focus",children:"Status"})]})}),e.jsx("tbody",{children:o.map((r,i)=>{var t;return e.jsxs("tr",{children:[e.jsx("th",{className:"text-sm border",children:i+1}),e.jsxs("td",{className:"max-w-xs overflow-hidden border",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[r.service_type==="FLIGHT"&&e.jsx(R,{}),r.service_type==="HOTEL"&&e.jsx(q,{})," ",e.jsxs("span",{className:"flex flex-wrap items-center",children:[r.booking_id," ",r.service_type==="FLIGHT"&&r.airlines_pnr&&e.jsxs("span",{className:"text-[10px] border-transparent rounded-full badge badge-sm bg-warning/10 text-warning whitespace-normal",children:["PNR: ",r.airlines_pnr]})]})]}),e.jsx("p",{children:g(new Date(r.timestamp*1e3)).format("DD MMM YYYY hh:mm a")}),e.jsx("p",{className:"text-xs",children:r.entry_n})]}),e.jsxs("td",{className:"border",children:[e.jsxs("p",{children:[g(new Date(r.checkin_departure_date)).format("DD-MMM-YY")," ","to"," ",g(new Date(r.checkout_arrival_date)).format("DD-MMM-YY")]}),(x==null?void 0:x.toUpperCase())==="ACTIVE"&&(r==null?void 0:r.booking_status)==="hold"&&e.jsx("p",{className:"text-[10.5px] px-2 inline bg-warning/10 text-warning rounded-full",children:r.auto_cancel})]}),e.jsxs("td",{className:"text-xs border",children:[e.jsx("p",{children:r.primary_guest_name}),r.service_type==="FLIGHT"&&e.jsxs("p",{children:[r.departure_airport,"-",r.arrival_airport," (",r.journey_type,")"]}),r.service_type==="HOTEL"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{children:((t=r.carrier_hotel)==null?void 0:t.length)>25?`${r.carrier_hotel.substring(0,25)}..`:r.carrier_hotel}),e.jsx(B,{button:e.jsx(O,{className:"text-info"}),position:"bottom",children:e.jsx("div",{className:"p-2",children:e.jsx("p",{children:r.carrier_hotel})})})]})]}),e.jsxs("td",{className:"text-xs border",children:[e.jsxs("p",{children:["Sell: ",f(r.currency)," ",r.sell_total_price]}),e.jsxs("p",{children:["Purchase: ",f(r.currency)," ",r.total_amount]}),e.jsxs("p",{children:["Margin: ",f(r.currency)," ",(r.sell_total_price-r.total_amount).toFixed(2)]})]}),e.jsx("td",{className:"border",children:r.booking_status==="confirm"?e.jsx(h,{to:r.service_type==="FLIGHT"?`/booking-details/flight?tracking_id=${r.tracking_id}`:r.service_type==="HOTEL"?`/booking-details/hotel?tracking_id=${r.tracking_id}`:`/booking-details/car?tracking_id=${r.tracking_id}`,className:"w-24 m-1 text-white normal-case rounded btn btn-sm btn-success flex-nowrap",children:"Confirm"}):r.booking_status==="hold"?e.jsx(h,{to:r.service_type==="FLIGHT"?`/booking-details/flight?tracking_id=${r.tracking_id}`:r.service_type==="HOTEL"?`/booking-details/hotel?tracking_id=${r.tracking_id}`:`/booking-details/car?tracking_id=${r.tracking_id}`,className:"w-24 m-1 text-white normal-case rounded btn btn-sm btn-warning flex-nowrap",children:"Hold"}):r.booking_status==="initiated"?e.jsx(h,{to:r.service_type==="FLIGHT"?`/booking-details/flight?tracking_id=${r.tracking_id}`:r.service_type==="HOTEL"?`/booking-details/hotel?tracking_id=${r.tracking_id}`:`/booking-details/car?tracking_id=${r.tracking_id}`,className:"w-24 m-1 normal-case rounded btn btn-sm btn-outline hover:text-white btn-info flex-nowrap",children:"Initiated"}):r.booking_status==="cancel"?e.jsx(h,{to:r.service_type==="FLIGHT"?`/booking-details/flight?tracking_id=${r.tracking_id}`:r.service_type==="HOTEL"?`/booking-details/hotel?tracking_id=${r.tracking_id}`:`/booking-details/car?tracking_id=${r.tracking_id}`,className:"w-24 m-1 text-white normal-case rounded btn btn-sm btn-error flex-nowrap",children:"Canceled"}):e.jsx("button",{onClick:()=>C("error",`Booking Status: ${r.booking_status}`,`This booking is not available for booking status ${r.booking_status}`),className:"w-24 m-1 normal-case rounded btn btn-sm btn-outline hover:text-white btn-error flex-nowrap",children:"Failed"})})]},r.booking_id)})})]})})},I=o=>btoa(JSON.stringify(o)),re=({booking_lists:o,carrier_url:p})=>{var y,k;const{booking_manage:x}=S.useState(),{booking_auto_cancel:r,booking_hold_vocuher_download:i}=x||{},[t,d]=m.useState([]),[l,u]=m.useState(1),[b,w]=m.useState(0);return m.useEffect(()=>{if(!o)return;const a=o.map((v,D)=>(v.index=D+1,v));w(Math.ceil(a.length/10));const n=a.slice((l-1)*10,(l-1)*10+10);d(n)},[o,l]),e.jsxs("div",{className:"mb-8 border-t-4 rounded-lg bg-base-200 shadow-sam border-t-primary",children:[e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("table",{className:"table max-sm:!text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-sm font-medium uppercase",children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Stay (Departure & Arrival)"}),e.jsx("th",{children:"Hotel/Airlines"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:t.map(a=>{var n;return e.jsxs("tr",{className:"duration-200 cursor-auto hover:bg-base-100 group",children:[e.jsx("th",{className:"border-0 border-y bg-base-200 group-hover:bg-[#eff5f9] duration-200",children:a==null?void 0:a.index}),e.jsx("td",{className:"max-w-xs overflow-hidden border-0 border-y bg-base-200 group-hover:bg-[#eff5f9] duration-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full flex justify-center items-center p-0.5 border",children:[a.service_type==="FLIGHT"&&e.jsx("img",{src:`${p}/${a.carrier_hotel}.png`,alt:"",className:"w-full h-full rounded-full"}),a.service_type==="HOTEL"&&e.jsx(U,{className:"text-2xl"})," "]}),e.jsxs("div",{children:[e.jsx("p",{children:e.jsxs("span",{className:"flex flex-wrap items-center",children:[a.booking_id," ",a.service_type==="FLIGHT"&&a.airlines_pnr&&e.jsxs("span",{className:"text-[10px] border-transparent rounded-full badge badge-sm bg-warning/10 text-warning whitespace-normal",children:["PNR: ",a.airlines_pnr]})]})}),e.jsx("p",{children:g(new Date(a.timestamp*1e3)).format("DD MMM YYYY hh:mm a")}),e.jsx("p",{className:"text-xs",children:a.entry_n})]})]})}),e.jsxs("td",{className:"border-0 border-y bg-base-200 group-hover:bg-[#eff5f9] duration-200",children:[e.jsxs("p",{children:[g(new Date(a.checkin_departure_date)).format("DD-MMM-YY")," ","to"," ",g(new Date(a.checkout_arrival_date)).format("DD-MMM-YY")]}),(r==null?void 0:r.toUpperCase())==="ACTIVE"&&(a==null?void 0:a.booking_status)==="hold"&&e.jsx("p",{className:"text-[10.5px] px-2 inline bg-warning/10 text-warning rounded-full",children:a.auto_cancel})]}),e.jsxs("td",{className:"border-0 border-y bg-base-200 group-hover:bg-[#eff5f9] duration-200",children:[e.jsx("p",{className:"font-medium",children:a.primary_guest_name}),a.service_type==="FLIGHT"&&e.jsxs("p",{className:"text-xs",children:[a.departure_airport,"-",a.arrival_airport," (",a.journey_type,")"]}),a.service_type==="HOTEL"&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("p",{children:((n=a.carrier_hotel)==null?void 0:n.length)>25?`${a.carrier_hotel.substring(0,25)}..`:a.carrier_hotel}),e.jsx(B,{button:e.jsx(O,{className:"text-info"}),position:"bottom",children:e.jsx("div",{className:"p-2",children:e.jsx("p",{children:a.carrier_hotel})})})]})]}),e.jsxs("td",{className:"border-0 border-y bg-base-200 group-hover:bg-[#eff5f9] duration-200",children:[e.jsxs("p",{children:["Sell: ",f(a.currency)," ",a.sell_total_price]}),e.jsxs("p",{children:["Purchase: ",f(a.currency)," ",a.total_amount]}),e.jsxs("p",{children:["Margin: ",f(a.currency)," ",(a.sell_total_price-a.total_amount).toFixed(2)]})]}),e.jsx("td",{className:"border-0 border-y bg-base-200 group-hover:bg-[#eff5f9] duration-200",children:e.jsx("div",{className:"flex items-center justify-between gap-5 py-4 overflow-hidden",children:a.booking_status==="confirm"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs border-transparent badge badge-success bg-success/10 text-success",children:"Confirm"}),e.jsxs("div",{className:"flex justify-center gap-4 px-4 py-2 duration-200 translate-x-full rounded-lg shadow-lg opacity-0 shadow-secondary/10 group-hover:translate-x-0 group-hover:opacity-100 bg-base-200",children:[e.jsx(h,{to:a.service_type==="FLIGHT"?`/booking-details/flight?tracking_id=${a.tracking_id}`:a.service_type==="HOTEL"?`/booking-details/hotel?tracking_id=${a.tracking_id}`:`/booking-details/car?tracking_id=${a.tracking_id}`,className:"text-lg duration-200 drop-shadow text-primary hover:text-primary-focus",title:"View Details",children:e.jsx(j,{})}),e.jsx("a",{href:`/voucher?q=${I({tracking_id:a.tracking_id})}`,target:"_blank",className:"text-lg duration-200 drop-shadow text-primary hover:text-primary-focus",title:"Download Voucher",children:e.jsx(L,{})})]})]}):a.booking_status==="hold"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs border-transparent badge badge-warning bg-warning/10 text-warning",children:"Hold"}),e.jsxs("div",{className:"flex justify-center gap-4 px-4 py-2 duration-200 translate-x-full rounded-lg shadow-lg opacity-0 shadow-secondary/10 group-hover:translate-x-0 group-hover:opacity-100 bg-base-200",children:[e.jsx(h,{to:a.service_type==="FLIGHT"?`/booking-details/flight?tracking_id=${a.tracking_id}`:a.service_type==="HOTEL"?`/booking-details/hotel?tracking_id=${a.tracking_id}`:`/booking-details/car?tracking_id=${a.tracking_id}`,className:"text-lg duration-200 drop-shadow text-primary hover:text-primary-focus",title:"View Details",children:e.jsx(j,{})}),(i==null?void 0:i.toUpperCase())==="YES"&&e.jsx("a",{href:`/voucher?q=${I({tracking_id:a.tracking_id})}`,target:"_blank",className:"text-lg duration-200 drop-shadow text-primary hover:text-primary-focus",title:"Download Voucher",children:e.jsx(L,{})})]})]}):a.booking_status==="initiated"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs border-transparent badge badge-info bg-info/10 text-info",children:"Initiated"}),e.jsx("div",{className:"flex justify-center gap-4 px-4 py-2 duration-200 translate-x-full rounded-lg shadow-lg opacity-0 shadow-secondary/10 group-hover:translate-x-0 group-hover:opacity-100 bg-base-200",children:e.jsx(h,{to:a.service_type==="FLIGHT"?`/booking-details/flight?tracking_id=${a.tracking_id}`:a.service_type==="HOTEL"?`/booking-details/hotel?tracking_id=${a.tracking_id}`:`/booking-details/car?tracking_id=${a.tracking_id}`,className:"text-lg duration-200 drop-shadow text-primary hover:text-primary-focus",title:"View Details",children:e.jsx(j,{})})})]}):a.booking_status==="cancel"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs border-transparent badge badge-secondary bg-secondary/10 text-secondary",children:"Cancel"}),e.jsx("div",{className:"flex justify-center gap-4 px-4 py-2 duration-200 translate-x-full rounded-lg shadow-lg opacity-0 shadow-secondary/10 group-hover:translate-x-0 group-hover:opacity-100 bg-base-200",children:e.jsx(h,{to:a.service_type==="FLIGHT"?`/booking-details/flight?tracking_id=${a.tracking_id}`:a.service_type==="HOTEL"?`/booking-details/hotel?tracking_id=${a.tracking_id}`:`/booking-details/car?tracking_id=${a.tracking_id}`,className:"text-lg duration-200 drop-shadow text-primary hover:text-primary-focus",title:"View Details",children:e.jsx(j,{})})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs border-transparent badge badge-error bg-error/10 text-error",children:"Failed"}),e.jsx("div",{className:"flex justify-center gap-4 px-4 py-2 duration-200 translate-x-full rounded-lg shadow-lg opacity-0 shadow-secondary/10 group-hover:translate-x-0 group-hover:opacity-100 bg-base-200",children:e.jsx("button",{onClick:()=>C("error",`Booking Status: ${a.booking_status}`,`This booking is not available for booking status ${a.booking_status}`),className:"text-lg duration-200 drop-shadow text-primary hover:text-primary-focus",title:"View Details",children:e.jsx(j,{})})})]})})})]},a.booking_id)})})]})}),e.jsxs("div",{className:"flex items-center justify-between p-3 mt-1",children:[e.jsxs("div",{className:"text-xs",children:["Showing ",(y=t==null?void 0:t.at(0))==null?void 0:y.index," to ",(k=t==null?void 0:t.at(-1))==null?void 0:k.index," ","of ",o==null?void 0:o.length," entries"]}),e.jsxs("div",{className:"flex justify-end text-sm gap-0.5",children:[e.jsx("div",{onClick:()=>l>1&&u(l-1),className:T("inline-flex items-center justify-center w-8 duration-100 cursor-pointer h-7 hover:bg-neutral/10 opacity-0 pointer-events-none",l>1&&"opacity-100 pointer-events-auto"),children:e.jsx(Q,{})}),[...Array(b)].map((a,n)=>e.jsx("div",{onClick:()=>u(n+1),className:T("inline-flex items-center justify-center w-8 duration-100 cursor-pointer h-7 hover:bg-neutral/10",n+1===l?"bg-neutral/10":""),children:n+1},n)),e.jsx("div",{onClick:()=>l<b&&u(l+1),className:T("inline-flex items-center justify-center w-8 duration-100 cursor-pointer h-7 hover:bg-neutral/10 opacity-0 pointer-events-none",l<b&&"opacity-100 pointer-events-auto"),children:e.jsx(z,{})})]})]})]})},te=[{label:"Any",value:"any"},{label:"Flight",value:"FLIGHT"},{label:"Hotel",value:"HOTEL"}],se=[{label:"Any",value:"any"},{label:"Hold",value:"hold"},{label:"Confirm",value:"confirm"},{label:"Failed",value:"failed"},{label:"Cancel",value:"cancel"},{label:"Initiated",value:"initiated"},{label:"Pending",value:"pending"}],he=()=>{var H,M;const{site_title:o,component_version:p}=S.useState(),{booking_list:x}=(p==null?void 0:p.booking)||{},{axiosInstance:r}=J(),[i]=K(),[t,d]=m.useState({member_id:"all",service_type:"any",generated_date_start:"",generated_date_end:"",book_date_start:"",book_date_end:"",booking_status:"any"}),l={member_id:"all",service_type:i.get("service_type")||"any",generated_date_start:i.get("generated_date_start")||g().subtract(1,"month").format("YYYY-MM-DD"),generated_date_end:i.get("generated_date_end")||g().format("YYYY-MM-DD"),book_date_start:i.get("book_date_start")||"",book_date_end:i.get("book_date_end")||"",booking_status:i.get("booking_status")||"any"},{data:u,error:b,isLoading:w}=W(["MY_BOOKINGS",l],async()=>{var c,F;const s=await r.post("/booking-list",l);if(((c=s.data)==null?void 0:c.status)==="success")return d(l),s.data.data=s.data.data.map((E,G)=>({...E,index:G+1})),s.data;throw{...s,message:((F=s.data)==null?void 0:F.reason)||"Request failed!"}}),y=X(),k=async s=>{s.preventDefault();const c=new URLSearchParams(Object.entries(t)).toString();y(`/my-bookings?${c}`)},a=(s,c)=>{d({service_type:"any",generated_date_start:"",generated_date_end:"",book_date_start:"",book_date_end:"",booking_status:"any",[s]:c})};if(w)return e.jsx(A,{});if(b)throw b;const{data:n,supplier_data:v}=u||{},D=(M=(H=u==null?void 0:u.resources)==null?void 0:H.base_url)==null?void 0:M.carrier;return e.jsxs("main",{className:"container min-h-screen pt-20",children:[e.jsx(P,{children:e.jsxs("title",{children:["Bookings",o?" - "+o:""]})}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("form",{onSubmit:k,className:"relative p-4 mb-16 rounded-lg shadow-sam bg-base-200",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-5 mb-5 sm:mb-8 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx($,{label:"Service Type",action:s=>{var c;return d({...t,service_type:((c=s[0])==null?void 0:c.value)||""})},options:te,defaultValue:t.service_type||null,placeholder:"Select Service Type"}),e.jsx(N,{label:"Booking Created",action:s=>{s[0]&&s[1]?d({...t,generated_date_start:g(s[0]).format("YYYY-MM-DD"),generated_date_end:g(s[1]).format("YYYY-MM-DD")}):d({...t,generated_date_start:"",generated_date_end:""})},defaultValue:t.generated_date_start&&t.generated_date_end?[t.generated_date_start,t.generated_date_end]:null,placeholder:"Select Booking Created Dates"}),e.jsx(N,{label:"Stay Between / Departure & Arrival",action:s=>{s[0]&&s[1]?d({...t,book_date_start:g(s[0]).format("YYYY-MM-DD"),book_date_end:g(s[1]).format("YYYY-MM-DD")}):d({...t,book_date_start:"",book_date_end:""})},defaultValue:t.book_date_start&&t.book_date_end?[t.book_date_start,t.book_date_end]:null,placeholder:"Select"}),e.jsx(N,{label:"Auto Cancel Date Between",action:s=>console.log(s),placeholder:"Select"}),e.jsx(Y,{label:"Booking ID",action:s=>a("booking_id",s.target.value),defaultValue:t.booking_id||null,placeholder:"Type Booking ID"}),e.jsx(Y,{label:"PNR/Confirmation/Supplier ID",action:s=>a("supplier_confirmation_id",s.target.value),defaultValue:t.supplier_confirmation_id||null,placeholder:"Type Supplier Confirmation ID"}),e.jsx(Y,{label:"Lead Guest Name",action:s=>a("primary_guest_name",s.target.value),defaultValue:t.primary_guest_name||null,placeholder:"Type Guest Name"}),e.jsx($,{label:"Booking Status",action:s=>{var c;return d({...t,booking_status:(c=s[0])==null?void 0:c.value})},options:se,defaultValue:t.booking_status||null,placeholder:"Select Booking Status"})]}),e.jsx("button",{type:"submit",className:"btn btn-lg min-h-0 h-12 btn-primary sm:absolute static top-full left-1/2 sm:-translate-x-1/2 sm:-translate-y-1/2 sm:active:!-translate-x-1/2 sm:active:!-translate-y-1/2 sm:active:scale-95 !animate-none normal-case flex-nowrap font-normal max-sm:w-full",children:"Search"})]}),(n==null?void 0:n.length)>0?e.jsx(e.Fragment,{children:x==="3"?e.jsx(re,{booking_lists:n,carrier_url:D}):x==="2"?e.jsx(ee,{booking_lists:n,supplier_data:v}):e.jsx(ae,{booking_lists:n})}):e.jsx("p",{className:"py-10 text-center text-error",children:"No result found"})]})]})};export{he as default};
