import{e as C,m as E,q as e,T as h,o as H,ad as z,aB as R}from"./index-5b04c002.js";import{P as S,d as q,ad as A,e as Y,ae as U,c as V,aa as D}from"./App-94c4b974.js";import{b as K}from"./index.esm-737ce12a.js";const Q=({data:d,refetchBookingDetails:b})=>{const[m,r]=C.useState(!1),{axiosInstance:t}=q(),{tracking_id:p,booking_id:y}=d,{user_data:{member_id:j}}=E.useState(),N=async g=>{var f,x,_;g.preventDefault(),r(!0);const u=g.target,o=u.notes.value,a=u.price_change_accepted.value,v={notes:o,price_change_accepted:a,member_id:j,tracking_id:p};try{const s=await t.post("/flight/issue-ticket",v);document.getElementById("issue_ticket_modal").close(),((f=s.data)==null?void 0:f.status)==="success"?(h("success","Issue Successful",(x=s.data)==null?void 0:x.reason),b()):h("error","Issue Failed",(_=s.data)==null?void 0:_.reason)}catch(s){document.getElementById("issue_ticket_modal").close(),h("error","Issue Failed",s.message)}finally{r(!1)}};return e.jsx("dialog",{id:"issue_ticket_modal",className:"modal",children:e.jsxs("form",{onSubmit:N,className:"p-4 modal-box",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Flight - Issue Ticket - ",y]}),e.jsx("hr",{className:"mb-4"}),e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Please provide notes for ticket issuance."}),e.jsx("input",{autoComplete:"off",type:"text",name:"notes",className:"input input-bordered min-h-8 text-sm rounded h-10 focus:outline-0 focus:border-neutral/30 mb-2 w-full max-w-[300px]",placeholder:"Type notes"}),e.jsx("p",{className:"mt-4 mb-2 text-sm font-medium text-neutral",children:"Are you agree with the authorized price modification during ticket issuance? We will inform you if there are changes to the price at the time of ticket issuance."}),e.jsxs("select",{type:"text",name:"price_change_accepted",className:"select select-bordered min-h-8 text-sm rounded h-10 focus:outline-0 focus:border-neutral/30 mb-4 w-full max-w-[300px]",defaultValue:"no",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]}),e.jsx("hr",{}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"submit",className:`normal-case btn btn-success btn-sm btn-outline ${m?"pointer-events-none":""}`,children:m?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mr-2 animate-spin"})," Processing..."]}):"Issue Ticket"}),e.jsx("button",{type:"button",onClick:()=>document.getElementById("issue_ticket_modal").close(),className:"normal-case btn btn-sm btn-outline text-neutral/70 hover:bg-neutral/70 border-neutral/70 hover:border-neutral/70",children:"Close"})]})]})})};Q.propTypes={data:S.object.isRequired,refetchBookingDetails:S.func.isRequired};const W=({data:d,refetchBookingDetails:b})=>{const{booking_manage:m}=H.useState(),{booking_auto_cancel:r}=m||{},[t,p]=C.useState(!1),{axiosInstance:y}=q(),{tracking_id:j,booking_id:N,booking_status:g,special_notice_status:u,special_notice:o}=d,{user_data:{member_id:a}}=E.useState(),v=C.useMemo(()=>Math.floor(1e5+Math.random()*9e5),[]),f=async x=>{var l,T,P,w;x.preventDefault(),p(!0);const I={reason:((l=x.target.reason)==null?void 0:l.value)||"n/a",member_id:a,tracking_id:j};try{const c=await y.post("/flight/cancel-booking",I);document.getElementById("cancel_flight_modal").close(),((T=c.data)==null?void 0:T.status)==="success"?(h("success","Flight Canceled",(P=c.data)==null?void 0:P.reason),b()):h("error","Cancellation Failed",(w=c.data)==null?void 0:w.reason)}catch(c){h("error","Cancellation Failed",c.message)}finally{p(!1)}};return e.jsx("dialog",{id:"cancel_flight_modal",className:"modal",children:e.jsxs("form",{onSubmit:f,className:"max-w-2xl p-4 rounded-md modal-box",children:[e.jsxs("h3",{className:"pb-2 text-lg font-semibold",children:["Cancel Flight Ticket - ",N]}),e.jsx("hr",{className:"mb-4"}),g==="hold"&&u==="active"&&e.jsxs("div",{className:"p-2 mb-4 text-sm border rounded-md border-warning/20 text-warning",children:[e.jsx("h2",{className:"mb-1 text-lg font-semibold text-red-600",children:"***Attention***"}),e.jsx("div",{className:"mb-2 font-light text-red-400 inner-html",dangerouslySetInnerHTML:{__html:z(o)||""}})]}),(r==null?void 0:r.toUpperCase())==="YES"?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-2 text-sm font-medium text-neutral",children:["Type"," ",e.jsx("strong",{className:"pointer-events-none select-none",children:v})," ","to Cancel the Flight Ticket"]}),e.jsx("input",{autoComplete:"off",type:"text",name:"reason",className:"input input-bordered min-h-8 text-sm rounded h-10 focus:outline-0 focus:border-neutral/30 w-full max-w-[300px]"}),e.jsx("hr",{className:"mt-4"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-2 text-sm font-medium text-neutral",children:["To cancel the booking, simply click the"," ",e.jsx("strong",{children:"Cancel Flight"})," button."]}),e.jsx("hr",{className:"mt-4"})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"submit",className:`normal-case btn btn-error btn-sm btn-outline rounded-md ${t?"pointer-events-none":""}`,children:t?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mr-2 animate-spin"})," Processing..."]}):"Cancel Flight"}),e.jsx("button",{onClick:()=>document.getElementById("cancel_flight_modal").close(),type:"button",className:"normal-case rounded-md btn btn-sm btn-outline text-neutral/70 hover:bg-neutral/70 border-neutral/70 hover:border-neutral/70",children:"Close"})]})]})})};W.propTypes={data:S.object.isRequired,refetchBookingDetails:S.func.isRequired};const J=({data:d,refetchBookingDetails:b})=>{const[m,r]=C.useState(!1),{axiosInstance:t}=q(),{tracking_id:p,booking_id:y}=d,[j,N]=C.useState(!1),{user_data:{member_id:g}}=E.useState(),u=async o=>{var _,s,I;o.preventDefault(),r(!0);const a=o.target,v=a.notes.value,f=a.price_change_accepted.value,x={notes:v,price_change_accepted:f,member_id:g,tracking_id:p};try{const l=await t.post("/flight/issue-ticket",x);document.getElementById("get_price_alert_modal").close(),((_=l.data)==null?void 0:_.status)==="success"?(h("success","Updated Successfully",(s=l.data)==null?void 0:s.reason),b()):h("error","Failed",(I=l.data)==null?void 0:I.reason)}catch(l){h("error","Failed",l.message)}finally{r(!1)}};return e.jsx("dialog",{id:"get_price_alert_modal",className:"modal",children:e.jsxs("form",{onSubmit:u,className:"p-4 modal-box",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Get Price Alert - ",y]}),e.jsx("hr",{className:"mb-4"}),e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Activate this service?"}),e.jsxs("select",{type:"text",name:"",className:"select select-bordered min-h-8 text-sm rounded h-10 focus:outline-0 focus:border-neutral/30 mb-4 w-full max-w-[300px]",defaultValue:"no",onChange:o=>N(o.target.value==="yes"),children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]}),j&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Get service for"}),e.jsx("select",{type:"text",name:"",className:"select select-bordered min-h-8 text-sm rounded h-10 focus:outline-0 focus:border-neutral/30 mb-4 w-full max-w-[300px]",defaultValue:"no",children:[...Array(48)].map((o,a)=>e.jsxs("option",{value:a+1,children:[a+1," ",a>0?"Hours":"Hour"]},a))})]}),e.jsx("hr",{}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"submit",className:`normal-case btn btn-warning btn-sm btn-outline ${m?"pointer-events-none":""}`,children:m?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mr-2 animate-spin"})," Processing..."]}):"Activate"}),e.jsx("button",{type:"button",onClick:()=>document.getElementById("get_price_alert_modal").close(),className:"normal-case btn btn-sm btn-outline text-neutral/70 hover:bg-neutral/70 border-neutral/70 hover:border-neutral/70",children:"Close"})]})]})})};J.propTypes={data:S.object.isRequired,refetchBookingDetails:S.func.isRequired};const ee=({data:d})=>{var B,M,L;const{isActive:b}=R.useState(),{currency:m,amount:r}=((L=(M=(B=d==null?void 0:d.flight)==null?void 0:B.price)==null?void 0:M.sell)==null?void 0:L.total)||{},[t,p]=C.useState(null),[y,j]=C.useState(!1),{tracking_id:N,booking_id:g}=d,{checkout_url:u}=H.useState(n=>n.system_config)||{},{email:o,fullname:a,member_id:v,isd_code:f,mobile:x,partner_id:_}=E.useState(n=>n.user_data)||{},{data:s,isLoading:I}=Y({queryKey:["FLIGHT_ISSUE_TICKET_BY_CARD",b,u,g,o,a,v,f,x,_,r,m,N],enabled:b,queryFn:async()=>{var i,F;const n={name:a,email:o,member_id:v,isd_code:f,contact_number:x,ftm_partner_id:_,service_details:"flight_issue_ticket",payment_type:"amount",amount:r,currency:m,payment_link_valid:"",collection_type:"deposit",tracking_id:N,payment_link_base_url:origin+"/online-payment",redirect_url:origin+"/online-payment/status"},k=await D.post(`${u}/request`,n);return p(((F=(i=k.data)==null?void 0:i.payment_option)==null?void 0:F.at(0))||null),k.data}}),{payment_option:l}=s||{},{pay_tracking_id:T}=(s==null?void 0:s.data)||{},{amount:P,currency:w,charges:c,payable:G}=(t==null?void 0:t.gateway)||{},$=async()=>{var n,k;if(!y){j(!0);try{const i={pay_tracking_id:T,gateway_partner_code:t==null?void 0:t.gateway_partner_code},F=await D.post(`${u}/pay`,i);if(((n=F.data)==null?void 0:n.status)==="success")window.location.replace((k=F.data)==null?void 0:k.gateway_redirect_url);else throw new Error("Failed to process payment")}catch(i){console.error(i),h("error","Error",i==null?void 0:i.message)}finally{j(!1)}}};return e.jsx("dialog",{className:"z-50 modal",open:b,children:e.jsxs("div",{className:"max-w-5xl p-4 rounded modal-box bg-base-200",children:[e.jsxs("h3",{className:"mb-2 text-lg font-semibold",children:["Flight - Issue Ticket - ",g]}),e.jsx("button",{type:"button",onClick:()=>R.update(n=>{n.isActive=!1}),className:"absolute text-lg hover:bg-error/10 text-error btn btn-ghost top-2 right-2 btn-circle btn-sm",children:e.jsx(K,{})}),e.jsx("hr",{className:"mb-4"}),e.jsxs("div",{className:"overflow-auto max-h-80",children:[I&&e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx(U,{className:"text-4xl animate animate-spin"})}),s&&e.jsxs("div",{className:"grid gap-5 overflow-hidden border rounded-lg sm:grid-cols-2 text-start",children:[e.jsx("div",{className:"p-5 bg-primary text-primary-content",children:e.jsxs("div",{children:[e.jsx("h1",{children:"Summary of Payment"}),e.jsxs("ul",{className:"pl-3 mt-4 text-sm leading-relaxed list-disc list-inside list text-primary-content/80",children:[e.jsxs("li",{className:"capitalize",children:["Payment Option: ",t==null?void 0:t.gateway_name]}),e.jsxs("li",{children:["Amount: ",P," ",w]}),e.jsxs("li",{children:["Fixed Charge: ",c==null?void 0:c.fixed_charge," ",w]}),e.jsxs("li",{children:["Service Fee: ",c==null?void 0:c.service_fee," ",w]}),e.jsxs("li",{children:["Total Payable: ",G," ",w]})]})]})}),e.jsxs("div",{className:"p-5 text-start",children:[e.jsx("h2",{className:"mb-2 text-lg font-semibold",children:"Select Payment Option"}),e.jsx("div",{className:"grid grid-cols-2 gap-5",children:l==null?void 0:l.map(n=>{const{gateway_name:k,gateway_code:i}=n||{};return e.jsxs("div",{onClick:()=>p(n),className:V("capitalize flex justify-center items-center rounded w-full ring-base-content/20 h-16 ring-[1px] !border-l-8 border-2 border-transparent cursor-pointer text-lg font-bold text-primary gap-1",(t==null?void 0:t.gateway_name)===k&&"border-warning ring-0"),children:[e.jsx("img",{src:i==="stripe"?"/stripe_logo.webp":"/bkash_logo.png",alt:"",className:"w-8"})," ",e.jsx("span",{children:k})]},i)})})]})]})]}),e.jsx("div",{className:"modal-action",children:s&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:$,type:"button",className:"h-10 min-h-0 text-base font-normal normal-case rounded btn btn-primary",children:y?"Processing...":"Pay Now"})})})]})})};export{W as C,J as G,Q as I,ee as a};
