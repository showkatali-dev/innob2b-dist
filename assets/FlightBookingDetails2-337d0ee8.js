import{e as E,q as e,o as J,u as ue,m as te,T as le,av as fe,P as W,ab as Le,ad as pe,H as ae,aw as He,I as z,ax as ze,ay as Ge,R as Ne,az as ve,aA as me,aB as Ke,aC as Qe,aD as We,aE as Je,aF as Xe,a4 as Ze,a5 as es}from"./index-40b4770e.js";import{P as T,R as ss,U as as,d as re,S as ce,V as ne,W as ts,X as ns,Y as rs,Z as ls,_ as cs,v as is,$ as os,a0 as ds,a1 as xs,a2 as us,a3 as ms,a4 as hs,e as xe,a5 as ps,a6 as bs,L as oe,a7 as _e,a8 as js,a9 as gs,m as fs,j as Ns,aa as vs,ab as _s,ac as ys,n as ws}from"./App-ab507ef2.js";import{S as Cs,U as Ss,a as ks,b as Fs,R as Ts}from"./RegenerateSearch-249f0508.js";import{w as we}from"./sweetalert2-react-content.es-aa8c434c.js";import{e as Ce,b as Se,f as ke,g as Is}from"./index.esm-ce81629e.js";import{I as As}from"./InputDate-b308223d.js";import{f as Es,M as Bs}from"./navigation-0d4973ae.js";import{S as Ms,N as $s,a as se}from"./navigation-bc61dbd5.js";import{R as Rs}from"./RefundData-f1adda88.js";import{S as he}from"./SingleSelect-75481dc3.js";import{I as Us}from"./InputDateWithTime-22deaa87.js";import{I as Ys,a as Os,C as Ds,G as Ps}from"./IssueTicketByCardModal-fe7257d8.js";import{S as qs,a as Vs}from"./SendBookingPayLinkModal-717d008b.js";import"./pp-2d25b381.js";import"./PhoneNumberSelect-bde40788.js";import"./index-bbca9b35.js";const Fe=({passenger:a})=>{const[l,s]=E.useState(!1);return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>s(!0),className:"normal-case rounded btn btn-primary btn-xs",children:[e.jsx(ss,{className:"text-base"})," Update Doc"]}),e.jsx(Cs,{passenger:a,isOpenScanPassportModal:l,setIsOpenScanPassportModal:s})]})};Fe.propTypes={passenger:T.object.isRequired};const Te=({passenger:a})=>{const[l,s]=E.useState(!1);return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>s(!0),className:"normal-case rounded btn btn-secondary btn-xs",children:[e.jsx(as,{className:"text-base"})," Update Contact"]}),e.jsx(Ss,{passenger:a,isOpenContactModal:l,setIsOpenContactModal:s})]})};Te.propTypes={passenger:T.object.isRequired};const Ie=({booking_details:a,can_modify:l,pax_id:s,refetchData:j})=>{var f,k,F,o,u;const{member_id:m}=((f=te.useState())==null?void 0:f.user_data)||{},[x,r]=E.useState({tracking_id:(a==null?void 0:a.tracking_id)||"",member_id:m,passenger:((F=(k=a==null?void 0:a.pax)==null?void 0:k.data)==null?void 0:F.map(w=>({pax_id:w==null?void 0:w.pax_id,ticket_number:w==null?void 0:w.ticket_number})))||[]}),[i,n]=E.useState(!1),[v,_]=E.useState(null),{axiosInstance:g}=re(),N=async w=>{var c,p,S;if(w.preventDefault(),!i){_(null),n(!0);try{const d=await g.post("/flight/update-booking-info",x);if(((c=d.data)==null?void 0:c.status)==="success")ce.close(),j(),le("success","Success!",(p=d.data)==null?void 0:p.reason);else throw new Error((S=d==null?void 0:d.data)==null?void 0:S.reason)}catch(d){console.error(d),_(d.message)}finally{n(!1)}}};return e.jsxs("form",{onSubmit:N,className:"relative px-6 pt-4 text-start",children:[e.jsx("h3",{className:"pb-2 text-lg font-semibold",children:"Update Ticket Number"}),e.jsx("hr",{className:"mb-4"}),v&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 py-1 pl-4 mx-auto border border-l-4 rounded-r border-warning text-warning w-fit",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(Ce,{})}),e.jsx("div",{className:"text-sm",children:v})]}),e.jsx("button",{onClick:()=>_(null),className:"btn btn-ghost btn-circle btn-sm text-error hover:bg-transparent hover:text-red-500",children:e.jsx(Se,{})})]})}),e.jsx("div",{className:"flex flex-col gap-5",children:(l==null?void 0:l.ticket_number)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Ticket Number"}),e.jsx("input",{type:"text",name:"supplier_confirmation_id",className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:((u=(o=x==null?void 0:x.passenger)==null?void 0:o.find(w=>w.pax_id===s))==null?void 0:u.ticket_number)||"",onChange:w=>r(c=>{var p;return{...c,passenger:(p=c==null?void 0:c.passenger)==null?void 0:p.map(S=>(S.pax_id===s&&(S.ticket_number=w.target.value),S))}})})]})}),e.jsxs("div",{className:"flex justify-end gap-4 mt-5",children:[e.jsx("button",{onClick:()=>ce.close(),type:"button",className:"h-10 min-h-0 normal-case rounded-md btn btn-primary btn-outline",children:"Close"}),e.jsx("button",{type:"submit",className:"h-10 min-h-0 normal-case rounded-md btn btn-primary",children:i?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"animate-spin"})," Updating..."]}):e.jsx(e.Fragment,{children:"Update"})})]})]})};Ie.propTypes={booking_details:T.object.isRequired,can_modify:T.object,pax_id:T.string,refetchData:T.func};const Ae=({booking_details:a,pax_id:l})=>{var i;const{can_modify:s}=((i=J.useState())==null?void 0:i.booking_manage)||{},j=we(ce),m=ue(),x=()=>{m.invalidateQueries(["FLIGHT_BOOKING_DETAILS"])},r=()=>{j.fire({html:e.jsx(Ie,{booking_details:a,can_modify:s,refetchData:x,pax_id:l}),showConfirmButton:!1,showCloseButton:!0,customClass:{popup:"w-full max-w-sm",htmlContainer:"!m-0",closeButton:"text-red-500"}})};return(s==null?void 0:s.ticket_number)==="NO"?null:e.jsx("button",{onClick:r,className:"mt-2 text-white normal-case rounded btn btn-warning btn-xs flex-nowrap",children:"Update Ticket No."})};Ae.propTypes={booking_details:T.object.isRequired,pax_id:T.string};const Ee=({route:a})=>{J.useState(),ts();const{lay_over:l,operating:{carrier_name:s,carrier:j,flight_number:m,carrier_logo:x},aircraft:{name:r},departure_time:i,origin:n,destination:v,origin_airport:{name:_,city:g},origin_terminal:N,arrival_time:f,destination_airport:{name:k,city:F},destination_terminal:o,booking_class:u,flight_time:w}=a;return e.jsxs("div",{children:[l&&l!=="not-applicable"&&e.jsx("div",{className:"flex items-center justify-center my-1",children:e.jsx("div",{className:"p-1 px-2 rounded-lg bg-[#f4f4f4]",children:e.jsxs("p",{className:"text-[10px] text-center",children:[e.jsx("span",{className:"font-bold text-[#dfa33a]",children:"Change of Airport"})," ","• Change of planes • ",fe(l)," layover in"," ",_]})})}),e.jsxs("div",{className:"flex flex-wrap justify-between gap-x-4",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"text-sm font-medium",children:[s," ",e.jsxs("span",{className:"text-[#9BA0B2]",children:[j," | ",m]})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{children:u.cabin_class}),e.jsx("p",{children:r})]})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"text-sm font-semibold",children:n}),e.jsxs("p",{className:"text-neutral",children:["Terminal ",N]})]}),e.jsx("div",{children:e.jsx("p",{className:"text-xs",children:W(i.substring(0,16)).format("DD-MM-YYYY HH:mm")})}),e.jsx("div",{className:"flex flex-col items-center self-center justify-center gap-2 text-center h-fit",children:e.jsx("p",{className:"pb-1 border-b-2 border-primary w-fit text-[#9BA0B2] text-sm",children:fe(w)})}),e.jsx("div",{children:e.jsx("p",{className:"text-xs",children:W(f.substring(0,16)).format("DD-MM-YYYY HH:mm")})}),e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"text-sm font-semibold",children:v}),e.jsxs("p",{className:"text-neutral",children:["Terminal ",o]})]})]})]})};Ee.propTypes={route:T.object.isRequired};const Be=({flight_group:a,journey_type:l})=>{const{system_config:s}=J.useState();return e.jsx("div",{className:"border rounded-lg",children:a==null?void 0:a.map((j,m)=>e.jsxs("div",{className:"flex gap-3 p-3",children:[l==="RoundTrip"&&m===2?e.jsx(ns,{className:"mt-1 text-2xl text-info shrink-0"}):e.jsx(rs,{className:"mt-1 text-2xl text-info shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h6",{className:"mb-1 text-sm font-bold",children:[j.routes[0].origin_airport.city," to"," ",j.routes.at(-1).destination_airport.city,","," ",W(j.routes[0].departure_time.slice(0,10)).format(s.default_date_format_print)]}),e.jsx("div",{children:j.routes.map((x,r)=>e.jsx(Ee,{route:x},r))})]})]},m))})};Be.propTypes={flight_group:T.array.isRequired};const Me=({booking_details:a,isImportGDSPNR:l})=>{const{general:{booking_id:s,airlines_pnr:j,supplier_confirmation_id:m},booking:{booking_status:x},flight:{search_parameter:r,flight_group:i,read_ssr:n},pax:{data:v},terms:_,cancellation_terms:g}=a,{booking_manage:N,system_config:f}=J.useState(),{flight_doc_file_required:k}=f||{},{flight_update_baggage:F,flight_update_contacts:o,flight_update_doc:u}=N||{},w=window.location.origin;return e.jsxs("div",{className:"tab-pane",children:[e.jsx("div",{className:"w-full mb-5 overflow-x-auto",children:e.jsxs("table",{className:"table text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"p-2 bg-neutral/5 text-info",children:[!l&&e.jsx("th",{className:"text-sm text-center border",children:"Booking Id"}),e.jsx("th",{className:"text-sm text-center border",children:"Airlines PNR"}),e.jsx("th",{className:"text-sm text-center border",children:"Order Id (GDS PNR)"}),e.jsx("th",{className:"text-sm text-center border",children:"Booking Class"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[!l&&e.jsx("td",{className:"text-center border",children:s}),e.jsx("td",{className:"text-center border",children:j}),e.jsx("td",{className:"text-center border",children:m}),e.jsx("td",{className:"text-center border",children:r.booking_class})]})})]})}),e.jsx("div",{className:"mb-5",children:e.jsx(Be,{flight_group:i,journey_type:r==null?void 0:r.journey_type})}),e.jsxs("div",{className:"mb-5 border rounded",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h4",{className:"font-semibold",children:"Traveler Details"})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("table",{className:"table text-sm table-bordered !align-top",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-sm border-b",children:"PASSENGER NAME"}),e.jsx("th",{className:"text-sm border-b",children:"BAGGAGE"}),e.jsx("th",{className:"text-sm border-b",children:"Action"})]})}),e.jsx("tbody",{children:v.map(c=>e.jsxs("tr",{className:"border-b-0",children:[e.jsxs("td",{className:"align-top",children:[e.jsx("div",{children:e.jsx("div",{className:"rounded badge badge-secondary",children:c.pax_type==="ADT"?e.jsxs(e.Fragment,{children:[e.jsx(ls,{})," Adult"]}):c.pax_type==="CNN"?e.jsxs(e.Fragment,{children:[e.jsx(cs,{})," Child"]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{})," Infant"]})})}),e.jsxs("h2",{className:"text-lg font-semibold",children:[c.title," ",c.first_name," ",c.last_name]}),e.jsxs("p",{children:["Passport No: ",c.doc_no]}),e.jsxs("p",{children:["Passport Expire: ",c.doc_dateofexpiry]}),c.doc_country&&e.jsxs("p",{children:["Passport Country:"," ",e.jsx("img",{src:`${w}/flags/${c.doc_country}.jpg`,alt:"SG",className:"inline",style:{height:"13px"}})," ",c.doc_country]}),(c==null?void 0:c.contact_no)&&e.jsxs("p",{children:["Mobile No: ",c.contact_no]}),(c==null?void 0:c.ticket_number)&&e.jsxs("p",{children:["Ticket No: ",c.ticket_number]}),(c==null?void 0:c.passport_copy)&&e.jsxs("a",{href:c.passport_copy,target:"_blank",rel:"noreferrer",className:"text-xs font-medium text-primary hover:text-primary-focus",children:["View passport ",e.jsx(os,{})]})]}),e.jsxs("td",{className:"align-top",children:[e.jsx("p",{children:"Baggage Allowance (Included Baggage):"}),i==null?void 0:i.map(p=>{var S;return(S=p==null?void 0:p.routes)==null?void 0:S.map((d,I)=>{var U,B,M,R,C,h,t,$,A,Y,O,b,P,D,q;return e.jsxs("div",{className:"flex flex-wrap gap-2 mb-1",children:[e.jsxs("h6",{children:[e.jsx("strong",{children:d==null?void 0:d.origin})," to"," ",e.jsx("strong",{children:d==null?void 0:d.destination}),":"]}),e.jsxs("p",{className:"text-xs",children:[e.jsx(ds,{})," ",(M=(B=(U=d==null?void 0:d.baggages)==null?void 0:U.checked)==null?void 0:B[c.pax_type])!=null&&M.weight?`${(h=(C=(R=d==null?void 0:d.baggages)==null?void 0:R.checked)==null?void 0:C[c.pax_type])==null?void 0:h.weight} ${(A=($=(t=d==null?void 0:d.baggages)==null?void 0:t.checked)==null?void 0:$[c.pax_type])==null?void 0:A.unit}`:`${(b=(O=(Y=d==null?void 0:d.baggages)==null?void 0:Y.checked)==null?void 0:O[c.pax_type])==null?void 0:b.pieceCount} pieces`," "]}),e.jsxs("p",{className:"text-xs",children:[e.jsx(xs,{})," ",(c==null?void 0:c.pax_type)!=="INF"&&((q=(D=(P=d==null?void 0:d.baggages)==null?void 0:P.carry_on)==null?void 0:D[c.pax_type])==null?void 0:q.title)||"7 kg*"]})]},I)})}),e.jsx("br",{}),e.jsx("p",{children:"Additional:"}),c.baggage_option?e.jsx("p",{children:c.baggage_option}):e.jsx("p",{children:"N/A"}),F.toUpperCase()==="ACTIVE"&&e.jsx("button",{title:"Update Baggage",className:"normal-case border-transparent rounded shadow-sm shadow-primary/50 btn btn-square btn-primary btn-outline btn-sm",children:e.jsx(us,{className:"text-lg"})})]}),e.jsx("td",{children:e.jsx("div",{className:"flex flex-col items-center",children:!l&&e.jsx(e.Fragment,{children:(x==="confirm"||x==="hold")&&e.jsxs(e.Fragment,{children:[(u==null?void 0:u.toUpperCase())==="ACTIVE"&&e.jsx(Fe,{passenger:c}),(o==null?void 0:o.toUpperCase())==="ACTIVE"&&e.jsx(Te,{passenger:c}),e.jsx(Ae,{booking_details:a,pax_id:c==null?void 0:c.pax_id}),k==="YES"&&e.jsx(ks,{passenger:c})]})})})})]},Le()))})]})})})]}),(n==null?void 0:n.length)>0&&e.jsx("div",{className:"w-full mb-5 overflow-x-auto",children:e.jsxs("table",{className:"table text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"p-2 text-info",children:[e.jsx("th",{className:"text-sm border",children:"SSR Code"}),e.jsx("th",{className:"text-sm border",children:"Details"})]})}),e.jsx("tbody",{children:n==null?void 0:n.map(c=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-bold border",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:c==null?void 0:c.code}),(c==null?void 0:c.name)&&e.jsx(ms,{button:e.jsx("button",{className:"text-lg text-neutral hover:text-info",children:e.jsx(ke,{})}),children:e.jsx("div",{className:"px-3 py-3 max-w-52",children:e.jsx("p",{className:"mb-1 text-xs text-info",children:c==null?void 0:c.name})})})]})}),e.jsxs("td",{className:"border",children:[e.jsx("p",{className:"text-[13px]",children:c==null?void 0:c.message}),(c==null?void 0:c.statusCode)&&e.jsxs("div",{className:"flex mt-1 text-[10px] badge-sm border-transparent rounded badge badge-info bg-warning/10 text-warning",children:["Status Code: ",c.statusCode]})]})]},c==null?void 0:c.Id))})]})}),(_==null?void 0:_.status)==="active"&&e.jsx("div",{className:"p-4 mb-5 border rounded",children:e.jsx("div",{className:"text-sm inner-html",dangerouslySetInnerHTML:{__html:pe(_==null?void 0:_.text)}})}),(g==null?void 0:g.status)==="active"&&e.jsx("div",{className:"p-4 mb-5 border rounded",children:e.jsx("div",{className:"text-sm inner-html",dangerouslySetInnerHTML:{__html:pe(g==null?void 0:g.text)}})})]})};Me.propTypes={booking_details:T.object.isRequired};const de=({price:a,title:l="Fare Breakdown",description:s=null})=>{var m;const{price_breakdown:j}=a;return e.jsxs("div",{className:"mb-5 border rounded tab-pane",id:"customer_fare_tab",role:"tabpanel",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("h5",{className:"font-semibold whitespace-nowrap",children:l}),s&&e.jsxs("div",{className:"self-center text-xs border-transparent badge bg-info/5 text-info",children:[e.jsx(hs,{className:"mr-1"})," ",s]})]})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("table",{className:"table text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-sm border",children:"Passenger Type"}),e.jsx("th",{className:"text-sm border",children:"Pax Count"}),e.jsx("th",{className:"text-sm border",children:"Pax Base Fare"}),e.jsx("th",{className:"text-sm border",children:"Pax Tax"}),e.jsx("th",{className:"text-sm border",children:"Pax Sub-Total"})]})}),e.jsx("tbody",{children:j==null?void 0:j.map(x=>{var r,i,n,v,_,g,N,f,k;return e.jsxs("tr",{children:[e.jsx("td",{className:"border",children:e.jsx("h5",{className:"text-lg font-semibold",children:x.passenger_type==="ADT"?"Adult":x.passenger_type==="CNN"?"Child":"Infant"})}),e.jsx("td",{className:"border",children:e.jsx("h5",{className:"text-lg font-semibold",children:x.passenger_total})}),e.jsxs("td",{className:"border",children:[ae((r=x==null?void 0:x.base_fare)==null?void 0:r.currency)," ",(n=Number((i=x==null?void 0:x.base_fare)==null?void 0:i.amount))==null?void 0:n.toFixed(2)]}),e.jsxs("td",{className:"border",children:[ae((v=x==null?void 0:x.tax)==null?void 0:v.currency)," ",(g=Number((_=x==null?void 0:x.tax)==null?void 0:_.amount))==null?void 0:g.toFixed(2)]}),e.jsxs("td",{className:"border",children:[ae((N=x==null?void 0:x.total)==null?void 0:N.currency)," ",(k=Number((f=x==null?void 0:x.total)==null?void 0:f.amount))==null?void 0:k.toFixed(2)]})]},x.passenger_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-sm border text-base-content",colSpan:"4",children:"Total"}),e.jsxs("th",{className:"text-sm border text-base-content",children:[ae(a.total.currency)," ",(m=Number(a.total.amount))==null?void 0:m.toFixed(2)]})]})})]})})})]})};de.propTypes={price:T.object.isRequired};const Ls=()=>e.jsxs("div",{className:"mb-5 border rounded tab-pane",id:"activity_logs_tab",role:"tabpanel",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h5",{className:"font-semibold",children:"Booking Activity Logs"})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"flex items-start",children:e.jsxs("div",{className:"overflow-hidden text-sm grow",children:[e.jsx("h5",{className:"text-sm font-semibold",children:e.jsx("a",{href:"#",className:"text-dark",children:"Search Intiated"})}),"By"," ",e.jsx("span",{className:"text-white bg-black badge badge-sm",children:"Test User"})," ","at"," ",e.jsx("span",{className:"text-white bg-black badge badge-sm",children:"17 Jul 2023 2:51 AM"}),e.jsxs("p",{className:"mb-0 font-size-13 text-muted",children:["Last Update 17 Jul 2023 2:52 AM",e.jsx("br",{})]}),e.jsxs("p",{children:[e.jsx("br",{}),"On 17 Jul 2023 at 2:51 AM, Test User initiated a flight search for a trip from"," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"IAH"}),"to ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"KHI"}),". The search specified a departure date of"," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"2023-11-01"})," ","and indicated that there would be"," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"1 adults"}),","," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"0 child"})," ","and"," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"0 infant"})," ","traveling. The booking class selected was"," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"Economy"})," ","and the journey type was"," ",e.jsx("span",{className:"text-white badge badge-sm bg-info",children:"RoundTrip"}),"."]})]})})})]}),$e=({tracking_id:a,booking_status:l})=>{var R,C;const[s,j]=E.useState(!1),[m,x]=E.useState(!1),{member_id:r}=te.useState().user_data||{},{axiosInstance:i}=re(),[n,v]=E.useState(),{booking_manage:_}=J.useState(),{customer_invoice_customization:g,customer_invoice_customization_for_confirm:N}=_||{},{data:f,isLoading:k,refetch:F}=xe({queryKey:["CUSTOMER_INVOICE",a,r],queryFn:async()=>{var t;const h=await i.post("/finance/partner-customer-booking-info",{tracking_id:a,member_id:r});if(((t=h.data)==null?void 0:t.status)==="success"){const{data:$,summery:A}=h.data,{sell_invoice_due_date:Y,sell_paid_status:O,sell_paid_amount:b}=A||{},P={sell_invoice_due_date:Y,sell_paid_status:O,sell_paid_amount:b};return $.forEach((D,q)=>{const{base_fare:X,tax:G,ticket_issue_charge:L,service_charge:K,discount:Q}=(D==null?void 0:D.sell)||{};P[q]={base_fare:parseFloat(X)-parseFloat(L),tax:G,ticket_issue_charge:L,service_charge:K,discount:Q}}),v(P),h.data}else throw h}}),{data:o}=f||{},[u,w]=E.useState(!1),c=ue(),p=async h=>{var D,q,X,G,L,K,Q,ee;if(h.preventDefault(),!s)return j(!0);if(u)return;const t=h.target,$=o.length>1?[...t.base_fare].map(y=>y.value):[(D=t.base_fare)==null?void 0:D.value],A=o.length>1?[...t.tax].map(y=>y.value):[(q=t.tax)==null?void 0:q.value],Y=o.length>1?[...t.ticket_issue_charge].map(y=>y.value):[(X=t.ticket_issue_charge)==null?void 0:X.value],O=o.length>1?[...t.service_charge].map(y=>y.value):[(G=t.service_charge)==null?void 0:G.value],b=o.length>1?[...t.discount].map(y=>y.value):[(L=t.discount)==null?void 0:L.value],P={member_id:r,tracking_id:a,sell_paid_amount:n.sell_paid_amount,sell_invoice_due_date:n.sell_invoice_due_date,pax_data:o.map((y,H)=>({pax_id:y.pax_id,sell:{base_fare:$[H],tax:A[H],ticket_issue_charge:Y[H],service_charge:O[H],discount:b[H]}}))};w(!0);try{const y=await i.post("/finance/partner-customer-booking-info-modify",P);if(((K=y.data)==null?void 0:K.status)==="success")j(!1),await F(),await c.invalidateQueries(["FLIGHT_BOOKING_DETAILS"]),le("success","Success!",(Q=y.data)==null?void 0:Q.reason);else throw new Error(((ee=y==null?void 0:y.data)==null?void 0:ee.reason)||"Something wrong!")}catch(y){le("error","Failed",y.message)}finally{w(!1)}},S=n?Object.values(n).reduce((h,t)=>(parseFloat(h)+parseFloat((t==null?void 0:t.base_fare)||0)+parseFloat((t==null?void 0:t.ticket_issue_charge)||0)).toFixed(2),0):0,d=n?Object.values(n).reduce((h,t)=>(parseFloat(h)+parseFloat((t==null?void 0:t.service_charge)||0)).toFixed(2),0):0,I=n?Object.values(n).reduce((h,t)=>(parseFloat(h)+parseFloat((t==null?void 0:t.discount)||0)).toFixed(2),0):0,U=n?Object.values(n).reduce((h,t)=>(parseFloat(h)+parseFloat((t==null?void 0:t.base_fare)||0)+parseFloat((t==null?void 0:t.ticket_issue_charge)||0)+parseFloat((t==null?void 0:t.tax)||0)+parseFloat((t==null?void 0:t.service_charge)||0)-parseFloat((t==null?void 0:t.discount)||0)).toFixed(2),0):0,B=(C=(R=o==null?void 0:o.at(0))==null?void 0:R.sell)==null?void 0:C.currency,M=o==null?void 0:o.at(0);return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:p,className:"mb-5 border rounded tab-pane",id:"customer_fare_tab",role:"tabpanel",children:[e.jsxs("div",{className:"flex flex-col gap-3 p-4 pb-1 border-b",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-2 font-semibold",children:"Personalize Your Invoice for Fare Adjustment"}),e.jsx("p",{className:"text-sm",children:"Customize your customer invoice to accurately represent fare adjustments. This can be achieved by modifying the base fare, tax, service charge, discount, and ticket issue charge. Note that the ticket issue charge will be automatically added to the base fare when sending the custom fare details via email."})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs("span",{className:"gap-1 text-xs rounded badge badge-error bg-error/10 text-error",children:[e.jsx("b",{children:"Invoice Status:"})," ",n==null?void 0:n.sell_paid_status]})}),e.jsxs("div",{className:"flex gap-2",children:[((g==null?void 0:g.toUpperCase())==="ACTIVE"&&l==="hold"||(N==null?void 0:N.toUpperCase())==="ACTIVE"&&l==="confirm")&&e.jsx("button",{type:"submit",className:"font-normal normal-case rounded btn btn-xs btn-secondary",children:u?"Updating...":e.jsxs(e.Fragment,{children:[e.jsx(ps,{})," ",s?"Update":"Modify"]})}),s&&e.jsx("button",{type:"button",onClick:()=>j(!1),className:"font-normal normal-case rounded btn btn-xs btn-secondary btn-outline",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"w-full mb-2 overflow-x-auto",children:e.jsxs("table",{className:"table text-xs text-center",children:[e.jsx("thead",{}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Customer Invoice Due Date"}),e.jsx("td",{children:e.jsx(As,{disabled:s===!1,className:`min-w-[64px] hide_arrow_key w-full rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent disabled:!border-0"}`,minDate:"",defaultValue:n==null?void 0:n.sell_invoice_due_date,action:h=>v({...n,sell_invoice_due_date:h})})}),e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Customer Total Paid:"}),e.jsx("td",{children:e.jsx("input",{autoComplete:"off",type:"number",readOnly:s===!1,className:`min-w-[64px] hide_arrow_key w-full rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:n==null?void 0:n.sell_paid_amount,onChange:h=>v({...n,sell_paid_amount:h.target.value}),name:"sell_paid_amount"})})]})})]})}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("table",{className:"table text-xs text-center",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Base Fare + Ticket Issue Charge"}),e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Tax"}),e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Service Charge"}),e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Discount"}),e.jsx("th",{className:"text-xs border bg-neutral/10",children:"Total + Currency"})]})}),k||!n?e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:"100%",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 py-8",children:[e.jsx(ne,{className:"animate-spin"})," Loading..."]})})})}):n&&(o==null?void 0:o.map((h,t)=>{var G,L,K,Q,ee,y,H,ie,V,be,je,ge;const{pax_id:$,customer:A,sell:Y}=h||{},{title:O,first_name:b,last_name:P,pax_type:D}=A||{},q=O+" "+b+" "+P,{currency:X}=Y||{};return e.jsxs("tbody",{children:[e.jsx("tr",{children:e.jsx("th",{colSpan:"100%",className:"p-2 text-[13px] border text-start",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:["Name:"," ",e.jsx("span",{className:"font-normal",children:q})]}),e.jsxs("div",{children:["Passenger Type:"," ",e.jsx("span",{className:"font-normal",children:He(D)})]})]})})}),e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 border bg-neutral/5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{autoComplete:"off",type:"number",readOnly:s===!1,className:`w-20 hide_arrow_key rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:(G=n[t])==null?void 0:G.base_fare,onChange:Z=>v({...n,[t]:{...n[t],base_fare:Z.target.value}}),name:"base_fare"}),e.jsx("span",{children:"+"}),e.jsx("input",{autoComplete:"off",type:"number",readOnly:s===!1,className:`w-20 hide_arrow_key rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:(L=n[t])==null?void 0:L.ticket_issue_charge,name:"ticket_issue_charge",onChange:Z=>v({...n,[t]:{...n[t],ticket_issue_charge:Z.target.value}})}),e.jsx("span",{children:"="}),e.jsx("input",{autoComplete:"off",type:"number",readOnly:!0,className:`w-20 hide_arrow_key rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:parseFloat((K=n[t])==null?void 0:K.base_fare)+parseFloat((Q=n[t])==null?void 0:Q.ticket_issue_charge)})]})}),e.jsx("td",{className:"p-2 border bg-neutral/5",children:e.jsx("input",{autoComplete:"off",type:"number",readOnly:s===!1,className:`min-w-[64px] hide_arrow_key w-full rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:(ee=n[t])==null?void 0:ee.tax,onChange:Z=>v({...n,[t]:{...n[t],tax:Z.target.value}}),name:"tax"})}),e.jsx("td",{className:"p-2 border bg-neutral/5",children:e.jsx("input",{autoComplete:"off",type:"number",readOnly:s===!1,className:`min-w-[64px] hide_arrow_key w-full rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:(y=n[t])==null?void 0:y.service_charge,onChange:Z=>v({...n,[t]:{...n[t],service_charge:Z.target.value}}),name:"service_charge"})}),e.jsx("td",{className:"p-2 border bg-neutral/5",children:e.jsx("input",{autoComplete:"off",type:"number",readOnly:s===!1,className:`min-w-[64px] hide_arrow_key w-full rounded-sm input input-xs focus:outline-none ${s?"input-bordered bg-base-200 shadow-inner":"bg-transparent"}`,value:(H=n[t])==null?void 0:H.discount,onChange:Z=>v({...n,[t]:{...n[t],discount:Z.target.value}}),name:"discount"})}),e.jsxs("td",{className:"p-2 font-medium border bg-neutral/5",children:[(parseFloat(((ie=n[t])==null?void 0:ie.base_fare)||0)+parseFloat(((V=n[t])==null?void 0:V.ticket_issue_charge)||0)+parseFloat(((be=n[t])==null?void 0:be.tax)||0)+parseFloat(((je=n[t])==null?void 0:je.service_charge)||0)-parseFloat(((ge=n[t])==null?void 0:ge.discount)||0)).toFixed(2)," ",X]})]})]},$)})),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end bg-neutral/5",children:"Total Base Fare ="}),e.jsxs("td",{className:"bg-neutral/5",children:[S," ",B]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end bg-neutral/5",children:"Total Service Charge ="}),e.jsxs("td",{className:"bg-neutral/5",children:[d," ",B]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end bg-neutral/5",children:"Total Discount ="}),e.jsxs("td",{className:"bg-neutral/5",children:[I," ",B]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end bg-neutral/5",children:"Grand Total Price ="}),e.jsxs("td",{className:"bg-neutral/5",children:[U," ",B]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end bg-neutral/5",children:"Total Paid ="}),e.jsxs("td",{className:"bg-neutral/5",children:[(n==null?void 0:n.sell_paid_amount)||0," ",B]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end bg-neutral/5",children:"Balance ="}),e.jsxs("td",{className:"bg-neutral/5",children:[U-(Number(n==null?void 0:n.sell_paid_amount)||0)," ",B]})]})]})]})}),!s&&e.jsx("div",{className:"flex justify-end mt-5",children:e.jsxs("button",{type:"button",onClick:()=>x(!0),className:"font-normal normal-case rounded btn btn-primary btn-sm",children:[e.jsx(bs,{})," Send Email"]})})]})]}),M&&e.jsx(Fs,{isActive:m,setIsActive:x,tracking_id:a,primary_customer_data:M})]})};$e.propTypes={tracking_id:T.string,booking_status:T.string};const Hs=({supplier_uid:a,supplier_confirmation_id:l})=>{var c;const[s,j]=E.useState(!1),[m,x]=E.useState(null),[r,i]=E.useState(null),[n,v]=E.useState([]),{member_id:_}=((c=te.useState())==null?void 0:c.user_data)||{},{axiosInstance:g}=re(),N=async()=>{var p,S;if(!s){j(!0);try{const d=await g.post("/secure?pathName=/terminal/create-session",{member_id:_,supplier_uid:a});if(((p=d.data)==null?void 0:p.status)==="success"){const{tracking_id:I,session_token:U}=d.data,B=await g.post("/secure?pathName=/terminal/execute-command",{member_id:_,tracking_id:I,session_token:U,terminal_command:`*${l}`}),{terminal_history:M}=B.data;v(M),x(I),i(U)}else throw new Error(((S=d.data)==null?void 0:S.reason)||"Something went wrong")}catch(d){console.error(d)}finally{j(!1)}}},[f,k]=E.useState(!1),F=async p=>{if(p.preventDefault(),!f){k(!0);try{const S=p.target.terminal_command.value,d=await g.post("/secure?pathName=/terminal/execute-command",{member_id:_,tracking_id:m,session_token:r,terminal_command:S}),{terminal_history:I}=d.data;v(I),p.target.reset()}catch(S){console.error(S)}finally{k(!1)}}},[o,u]=E.useState(!1),w=async()=>{var p,S;if(!o){u(!0);try{const d=await g.post("/secure?pathName=/terminal/end-session",{member_id:_,tracking_id:m,session_token:r});if(((p=d.data)==null?void 0:p.status)==="success")x(null),i(null),v([]);else throw new Error(((S=d.data)==null?void 0:S.reason)||"Something went wrong")}catch(d){console.error(d)}finally{u(!1)}}};return e.jsxs("div",{className:"w-full p-4 pt-2 border rounded-md",children:[e.jsx("h3",{className:"pb-2 text-lg font-semibold",children:"Terminal Window"}),e.jsx("hr",{className:"mb-4"}),!m&&!r&&e.jsx("div",{className:"flex gap-5 sm:items-end max-sm:flex-col",children:e.jsx("button",{onClick:N,className:`normal-case btn btn-primary rounded-md shadow shadow-primary/30 min-h-0 h-10 ${s?"pointer-events-none":""}`,children:s?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"mr-2 animate-spin"})," Starting..."]}):"Start Session"})}),m&&r&&e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:F,className:"flex gap-5 max-sm:flex-col sm:items-end",autoComplete:"off",children:[e.jsxs("div",{className:"flex-1 gap-2 form-control",children:[e.jsx("p",{className:"text-sm font-medium text-neutral",children:"Type Terminal Command"}),e.jsx("input",{name:"terminal_command",className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30 ",required:!0})]}),e.jsx("button",{type:"submit",className:`normal-case btn btn-primary rounded-md shadow shadow-primary/30 min-h-0 h-10 ${f?"pointer-events-none":""}`,children:f?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"mr-2 animate-spin"})," Running..."]}):"Run"}),e.jsx("button",{type:"button",onClick:()=>w(),className:`normal-case btn btn-primary btn-outline rounded-md shadow shadow-primary/30 min-h-0 h-10 ${o?"pointer-events-none":""}`,children:o?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"mr-2 animate-spin"})," Closing..."]}):"Close"})]}),e.jsx("div",{className:"grid gap-4 mt-8",children:n.map(p=>{var S;return e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"p-3 border rounded bg-neutral/5",children:[p!=null&&p.command_response?(S=JSON.parse(p.command_response))==null?void 0:S.map((d,I)=>e.jsx("p",{className:"text-sm",children:d},I)):null,e.jsx("p",{className:"mt-1 text-xs text-end",children:W(new Date((p==null?void 0:p.timestamp)*1e3)).format("ddd, MMM Do YYYY, h:mm:ss a")})]}),e.jsxs("div",{className:"p-3 border rounded bg-neutral/10",children:[e.jsx("p",{className:"text-sm",children:p==null?void 0:p.terminal_command}),e.jsx("p",{className:"mt-1 text-xs text-end",children:W(new Date((p==null?void 0:p.timestamp)*1e3)).format("ddd, MMM Do YYYY, h:mm:ss a")})]})]},p==null?void 0:p.timestamp)})})]})]})},zs=["supernsn","manager","support","accounts"],Re=({booking_details:a,isImportGDSPNR:l=!1})=>{var $,A,Y,O;const[s,j]=E.useState("itinerary"),{booking_manage:m,price_view:x,system_config:r}=J.useState(),[i,n]=E.useState(!0),{booking_hold_vocuher_download:v,booking_send_vocuher:_,customer_invoice_features:g}=m||{},{show_fmg_price:N,show_supplier_price:f,show_partner_price:k,show_sell_price:F}=x||{},{general:o,booking:{booking_status:u},tracking_id:w,special_notice_status:c,special_notice:p,supplier:{info:{supplier_uid:S}},pax:{data:d},refund_data:I}=a,{sell:U,purchase:B,fmg:M,supplier:R}=(($=a==null?void 0:a.flight)==null?void 0:$.price)||{},{user_access_level:C}=((A=te.useState())==null?void 0:A.user_data)||{},h=zs.includes(C),t=b=>btoa(JSON.stringify(b));return e.jsxs("div",{className:"p-4 rounded-lg lg:col-span-5 bg-base-200",children:[e.jsxs("div",{className:"mb-8 border rounded",children:[!l&&e.jsxs("div",{className:"flex justify-between p-4 border-b max-sm:flex-col",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"mb-1 font-semibold",children:["Booking ID: ",o==null?void 0:o.booking_id]}),e.jsxs("p",{className:"text-neutral",children:["PNR: ",o==null?void 0:o.supplier_confirmation_id]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[u==="confirm"&&e.jsxs(oe,{to:`/voucher/flight?q=${btoa(w)}`,target:"_blank",className:"h-9 min-h-0 text-sm btn btn-sm border-base-content/30 hover:bg-neutral/70 hover:!text-white btn-outline btn-info normal-case rounded-md",children:[e.jsx(z,{path:ze,size:.8})," E-ticket"]}),(u==="confirm"||u==="hold"&&(v==null?void 0:v.toUpperCase())==="YES")&&e.jsxs("div",{className:"dropdown dropdown-end",children:[e.jsxs("button",{tabIndex:"0",className:"h-9 min-h-0 text-sm btn btn-sm border-base-content/30 hover:bg-neutral/70 hover:!text-white btn-outline btn-info normal-case rounded-md",children:[e.jsx(z,{path:Ge,size:.8})," Download"," ",e.jsx(_e,{})]}),e.jsxs("ul",{tabIndex:"0",className:"z-20 p-2 mt-3 overflow-hidden !rounded shadow-md menu menu-sm dropdown-content shadow-primary/20 bg-base-200 w-64 join join-vertical",children:[e.jsx("li",{className:"border-t join-item",children:e.jsxs("details",{open:!0,children:[e.jsx("summary",{className:"!py-2 rounded-none hover:bg-primary/10",children:"With Fare"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(oe,{to:`/voucher?q=${t({tracking_id:w,price:!0})}`,target:"_blank",className:"!py-1 !rounded",children:"Download Voucher"})}),d==null?void 0:d.map(b=>e.jsx(Ne.Fragment,{children:e.jsx("li",{className:"border-t join-item",children:e.jsxs(oe,{to:`/voucher?q=${t({tracking_id:w,price:!0,pax_id:b==null?void 0:b.pax_id,ticket:!0})}`,target:"_blank",className:"!py-1 !rounded",children:[b==null?void 0:b.title," ",b==null?void 0:b.first_name," ",b==null?void 0:b.last_name]})})},b==null?void 0:b.Id))]})]})}),e.jsx("li",{className:"border-t join-item",children:e.jsxs("details",{children:[e.jsx("summary",{className:"!py-2 rounded-none hover:bg-primary/10",children:"Without Fare"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(oe,{to:`/voucher?q=${t({tracking_id:w})}`,target:"_blank",className:"!py-1 !rounded",children:"Download Voucher"})}),d==null?void 0:d.map(b=>e.jsx(Ne.Fragment,{children:e.jsx("li",{className:"border-t join-item",children:e.jsxs(oe,{to:`/voucher?q=${t({tracking_id:w,pax_id:b==null?void 0:b.pax_id,ticket:!0})}`,target:"_blank",className:"!py-1 !rounded",children:[b==null?void 0:b.title," ",b==null?void 0:b.first_name," ",b==null?void 0:b.last_name]})})},b==null?void 0:b.Id))]})]})})]})]}),u==="hold"&&e.jsx(e.Fragment,{children:e.jsxs("button",{type:"button",onClick:()=>{var b;return(b=document.getElementById("send_booking_pay_link_modal"))==null?void 0:b.showModal()},className:"h-9 min-h-0 text-sm btn btn-sm border-base-content/30 hover:bg-neutral/70 hover:!text-white btn-outline btn-info normal-case rounded-md",children:[e.jsx(z,{path:ve,size:.8})," Send Pay Link"," "]})}),(u==="hold"&&_==="ACTIVE"&&v==="YES"||u==="confirm"&&_==="ACTIVE")&&e.jsxs("button",{type:"button",onClick:()=>{var b;return(b=document.getElementById("send_voucher_modal"))==null?void 0:b.showModal()},className:"h-9 min-h-0 text-sm btn btn-sm border-base-content/30 hover:bg-neutral/70 hover:!text-white btn-outline btn-info normal-case rounded-md",children:[e.jsx(z,{path:ve,size:.8})," Send Voucher"]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"h-9 w-9 p-0 min-h-0 btn btn-sm border-base-content/30 hover:!text-white btn-outline btn-neutral normal-case",children:e.jsx(js,{className:"text-xl"})})]})]}),u==="hold"&&c==="active"&&e.jsx("div",{className:"p-2",children:e.jsx("div",{className:"p-2 text-sm border rounded-md border-warning/20 text-error",children:e.jsxs("div",{className:"relative flex items-end gap-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-red-600 b-1",children:"***Attention***"}),e.jsx("div",{className:`text-red-400 inner-html ${i?"":"line-clamp-1"}`,dangerouslySetInnerHTML:{__html:pe(p)||""}})]}),e.jsx("button",{onClick:()=>n(!i),className:"absolute bottom-0 right-0 pl-3 text-xs font-medium text-info shrink-0 bg-gradient-to-r from-base-200/50 via-base-200 to-base-200",children:i?e.jsxs(e.Fragment,{children:["View Less ",e.jsx(gs,{})]}):e.jsxs(e.Fragment,{children:["View Details ",e.jsx(_e,{})]})})]})})}),u==="initiated"&&e.jsx("div",{className:"p-2",children:e.jsx("div",{className:"p-2 text-sm border rounded-md border-warning/20 text-error",children:e.jsxs("div",{className:"relative flex items-end gap-5",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-yellow-500 b-1",children:"***Attention***"}),e.jsx("div",{className:`text-yellow-400 ${i?"":"line-clamp-1"}`,children:e.jsxs("p",{children:["The session for this booking has been expired. Please click ",e.jsx("strong",{children:"Search again"})," to make a new booking."]})})]}),e.jsx(Ts,{booking_details:a})]})})}),e.jsx("div",{className:"w-full overflow-auto whitespace-nowrap hide_scrollbar",children:e.jsxs(Ms,{slidesPerView:"auto",spaceBetween:0,freeMode:!0,modules:[Es,$s,Bs],mousewheel:!0,navigation:{prevEl:".tab-btn-prev",nextEl:".tab-btn-next"},className:"px-4 text-sm font-medium",children:[e.jsx(se,{onClick:()=>j("itinerary"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="itinerary"?"border-b-primary":""}`,children:"Itinerary"}),F==="YES"&&e.jsxs(se,{onClick:()=>j("fare_breakdown_customer"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="fare_breakdown_customer"?"border-b-primary":""}`,children:[e.jsx("p",{children:"Fare"}),e.jsx("p",{className:"text-[10px] font-light",children:"(Customer)"})]}),k==="YES"&&e.jsxs(se,{onClick:()=>j("fare_breakdown"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="fare_breakdown"?"border-b-primary":""}`,children:[e.jsx("p",{children:"Fare"}),e.jsx("p",{className:"text-[10px] font-light",children:"(Agent)"})]}),(N==null?void 0:N.toUpperCase())==="YES"&&e.jsxs(se,{onClick:()=>j("fare_breakdown_fmg"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="fare_breakdown_fmg"?"border-b-primary":""}`,children:[e.jsx("p",{children:"FMG Fare"}),e.jsxs("p",{className:"text-[10px] font-light",children:["(",(Y=M==null?void 0:M.total)==null?void 0:Y.currency,")"]})]}),f==="YES"&&e.jsxs(se,{onClick:()=>j("fare_breakdown_supplier"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="fare_breakdown_supplier"?"border-b-primary":""}`,children:[e.jsx("p",{children:"Supplier Fare"}),e.jsxs("p",{className:"text-[10px] font-light",children:["(Airlines - ",(O=R==null?void 0:R.total)==null?void 0:O.currency,")"]})]}),(u==="confirm"||u==="hold")&&(r==null?void 0:r.show_gds_terminal_option)==="YES"&&e.jsx(se,{onClick:()=>j("terminal"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="terminal"?"border-b-primary":""}`,children:"Terminal"}),!l&&h&&(g==null?void 0:g.toUpperCase())==="ACTIVE"&&(u==="confirm"||u==="hold")&&e.jsxs(se,{onClick:()=>j("customer_invoice"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="customer_invoice"?"border-b-primary":""}`,children:[e.jsx("p",{children:"Invoice"}),e.jsx("p",{className:"text-[10px] font-light",children:"(Custom)"})]}),u==="cancel"&&(I==null?void 0:I.length)>0&&e.jsx(se,{onClick:()=>j("customer_invoice"),className:`px-4 py-2 border-b-2 border-transparent cursor-pointer w-fit text-center leading-tight h-12 flex items-center flex-col justify-start  ${s==="customer_invoice"?"border-b-primary":""}`,children:e.jsx("p",{children:"Refund"})}),e.jsx("button",{className:"absolute top-0 bottom-0 left-0 z-20 w-4 text-lg duration-100 bg-black/5 text-primary tab-btn-prev hover:bg-primary hover:text-primary-content",children:e.jsx(fs,{})}),e.jsx("button",{className:"absolute top-0 bottom-0 right-0 z-20 w-4 text-lg duration-100 bg-black/5 text-primary tab-btn-next hover:bg-primary hover:text-primary-content",children:e.jsx(Ns,{})})]})})]}),e.jsxs("div",{id:"flight-tab-content",className:"tab-content",children:[s==="itinerary"&&e.jsx(Me,{booking_details:a,isImportGDSPNR:l}),s==="fare_breakdown_customer"&&F==="YES"&&e.jsx(de,{price:U,isCustomer:!0,tracking_id:w,title:"Fare Breakdown (Customer)",description:"After adding your markup to make this amount visible to your customer."}),((k==null?void 0:k.toUpperCase())==="YES"||l)&&s==="fare_breakdown"&&e.jsx(de,{price:B,title:"Agent Fare",description:"The fare expressed in your currency. This represents the amount you need to pay, serving as the cost of the tickets."}),((N==null?void 0:N.toUpperCase())==="YES"||l)&&s==="fare_breakdown_fmg"&&e.jsx(de,{price:M,title:"FMG Fare",description:"Adjusted after deducting airline commission and modifying the markup and margin."}),((f==null?void 0:f.toUpperCase())==="YES"||l)&&s==="fare_breakdown_supplier"&&e.jsx(de,{price:R,title:"Supplier Fare",description:"The actual fare from the airline's Global Distribution System (GDS)"}),s==="activity_logs"&&e.jsx(Ls,{}),(g==null?void 0:g.toUpperCase())==="ACTIVE"&&h&&s==="customer_invoice"&&e.jsx($e,{tracking_id:w,booking_status:u}),(u==="confirm"||u==="hold")&&(r==null?void 0:r.show_gds_terminal_option)==="YES"&&s==="terminal"&&e.jsx(Hs,{supplier_uid:S,supplier_confirmation_id:o==null?void 0:o.supplier_confirmation_id}),u==="cancel"&&s==="refund"&&e.jsx(Rs,{refund_data:I})]})]})};Re.propTypes={booking_details:T.object.isRequired};const Ue=({info:a})=>{const{book_by:l,ip_address:s}=a;return e.jsx("div",{className:"mb-5 border rounded card",children:e.jsxs("div",{className:"gap-0 px-2 py-3 card-body",children:[e.jsx("h5",{className:"mb-1 text-sm font-semibold",children:"Book By"}),e.jsxs("div",{children:[" ",e.jsxs("a",{href:"#",className:"flex items-center",children:[e.jsxs("div",{className:"w-10 p-1 mr-2 border rounded-full avatar shrink-0",children:[" ",e.jsx("img",{src:"https://png.pngtree.com/png-vector/20220709/ourmid/pngtree-businessman-user-avatar-wearing-suit-with-red-tie-png-image_5809521.png",alt:"",className:"rounded-full"})," "]}),e.jsx("div",{className:"grow",children:e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium",children:l}),e.jsx("p",{className:"text-[13px]",children:s})]})})]})]})]})})};Ue.propTypes={info:T.object.isRequired};const Ye=({details:a})=>{var i;const{brand_name:l,partner_profile_code:s,support_email:j,country:m,website:x}=a||{},{data:r=[]}=xe(["COUNTRY"],async()=>{const n=window.location.origin,v=await vs.get(`${n}/country.json`);return Object.values(v.data.data).map(_=>({label:`${_.country_name} (${_.country_code})`,value:_.country_code}))});return e.jsx("div",{className:"mb-5 border rounded card",children:e.jsxs("div",{className:"gap-0 px-2 py-3 text-center card-body",children:[e.jsx("h5",{className:"mb-1 text-sm font-semibold",children:l}),e.jsxs("div",{className:"space-y-1 text-[11px] text-start",children:[s&&e.jsxs("div",{className:"font-semibold",children:["Partner Code:"," ",e.jsx("span",{className:"font-normal",children:s})]}),j&&e.jsxs("div",{className:"font-semibold",children:["Email:"," ",e.jsx("a",{href:"mailto:support_email",className:"font-normal hover:underline",children:j})]}),x&&e.jsxs("div",{className:"font-semibold",children:["Website:"," ",e.jsx("a",{href:"{website}",className:"font-normal hover:underline",children:x})]}),m&&e.jsxs("div",{className:"font-semibold",children:["Country:"," ",e.jsx("span",{className:"font-normal",children:(i=r==null?void 0:r.find(n=>(n==null?void 0:n.value)===m))==null?void 0:i.label})]})]})]})})};Ye.propTypes={details:T.object.isRequired};const Oe=({auto_cancel:a})=>{const[l,s]=E.useState(j(a));E.useEffect(()=>{const n=setInterval(()=>{s(j(a))},1e3);return()=>clearInterval(n)},[a]);function j(n){const v=new Date,g=new Date(n)-v;if(g<=0)return{days:0,hours:0,minutes:0,seconds:0};const N=Math.floor(g/(1e3*60*60*24)),f=Math.floor(g%(1e3*60*60*24)/(1e3*60*60)),k=Math.floor(g%(1e3*60*60)/(1e3*60)),F=Math.floor(g%(1e3*60)/1e3);return{days:N,hours:f,minutes:k,seconds:F}}const{days:m,hours:x,minutes:r,seconds:i}=l;return e.jsxs("h3",{className:"text-sm",children:["Auto Cancel"," ",e.jsx("span",{className:"font-semibold tracking-tight text-red-500",children:`${m}d ${x}h ${r}m ${i}s`})]})};Oe.propTypes={auto_cancel:T.string};const De=({booking_details:a,can_modify:l,airports:s,flight_supplier_options:j,refetchData:m})=>{var k,F,o,u,w,c,p,S,d,I,U,B,M,R;const{member_id:x}=((k=te.useState())==null?void 0:k.user_data)||{},[r,i]=E.useState({tracking_id:(a==null?void 0:a.tracking_id)||"",member_id:x,supplier_uid:((o=(F=a==null?void 0:a.supplier)==null?void 0:F.info)==null?void 0:o.supplier_uid)||"",supplier_confirmation_id:((u=a==null?void 0:a.general)==null?void 0:u.supplier_confirmation_id)||"",airlines_pnr:((w=a==null?void 0:a.general)==null?void 0:w.airlines_pnr)||"",booking_status:((c=a==null?void 0:a.booking)==null?void 0:c.booking_status)||"hold",ticket_status:((p=a==null?void 0:a.booking)==null?void 0:p.ticket_status)||"queue",departure_airport:((S=a==null?void 0:a.flight)==null?void 0:S.departure_airport)||"",arrival_airport:((d=a==null?void 0:a.flight)==null?void 0:d.arrival_airport)||"",journey_type:((U=(I=a==null?void 0:a.flight)==null?void 0:I.search_parameter)==null?void 0:U.journey_type)||"OneWay",auto_cancel_status:((B=a==null?void 0:a.booking)==null?void 0:B.auto_cancel_status)||"pending",auto_cancel:((M=a==null?void 0:a.booking)==null?void 0:M.auto_cancel)||"",booking_remarks:((R=a==null?void 0:a.general)==null?void 0:R.booking_remarks)||""}),[n,v]=E.useState(!1),[_,g]=E.useState(null),{axiosInstance:N}=re(),f=async C=>{var h,t,$;if(C.preventDefault(),!n){g(null),v(!0);try{const A=await N.post("/flight/update-booking-info",r);if(((h=A.data)==null?void 0:h.status)==="success")ce.close(),m(),le("success","Success!",(t=A.data)==null?void 0:t.reason);else throw new Error(($=A==null?void 0:A.data)==null?void 0:$.reason)}catch(A){console.error(A),g(A.message)}finally{v(!1)}}};return e.jsxs("form",{onSubmit:f,className:"relative px-6 py-4 text-start",children:[e.jsx("h3",{className:"pb-2 text-lg font-semibold",children:"Update Booking Info"}),e.jsx("hr",{className:"mb-4"}),_&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 py-1 pl-4 mx-auto border border-l-4 rounded-r border-warning text-warning w-fit",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(Ce,{})}),e.jsx("div",{className:"text-sm",children:_})]}),e.jsx("button",{onClick:()=>g(null),className:"btn btn-ghost btn-circle btn-sm text-error hover:bg-transparent hover:text-red-500",children:e.jsx(Se,{})})]})}),e.jsxs("div",{className:"flex flex-col gap-5 sm:grid sm:grid-cols-2",children:[(l==null?void 0:l.supplier_confirmation_id)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Order ID/GDS PNR"}),e.jsx("input",{type:"text",name:"supplier_confirmation_id",className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(r==null?void 0:r.supplier_confirmation_id)||"",onChange:C=>i(h=>({...h,supplier_confirmation_id:C.target.value}))})]}),(l==null?void 0:l.airlines_pnr)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Airlines PNR"}),e.jsx("input",{type:"text",name:"airlines_pnr",className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(r==null?void 0:r.airlines_pnr)||"",onChange:C=>i(h=>({...h,airlines_pnr:C.target.value}))})]}),(l==null?void 0:l.booking_status)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Booking Status"}),e.jsxs("select",{type:"text",name:"booking_status",className:"w-full h-10 text-sm bg-transparent rounded select select-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(r==null?void 0:r.booking_status)||"hold",onChange:C=>i(h=>({...h,booking_status:C.target.value})),children:[e.jsx("option",{value:"hold",children:"Hold"}),e.jsx("option",{value:"confirm",children:"Confirm"}),e.jsx("option",{value:"cancel",children:"Cancel"})]})]}),(l==null?void 0:l.auto_cancel_status)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Auto Cancel Status"}),e.jsxs("select",{type:"text",name:"auto_cancel_status",className:"w-full h-10 text-sm bg-transparent rounded select select-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(r==null?void 0:r.auto_cancel_status)||"pending",onChange:C=>i(h=>({...h,auto_cancel_status:C.target.value})),children:[e.jsx("option",{value:"pending",children:"Schedule Auto Cancel"}),e.jsx("option",{value:"processing",children:"Cancel On Process"}),e.jsx("option",{value:"auto-cancel-review",children:"Auto Cancel Failed"}),e.jsx("option",{value:"auto-cancel",children:"Complete"})]})]}),(l==null?void 0:l.auto_cancel)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Auto Cancel"}),e.jsx(Us,{className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",disabled:!((r==null?void 0:r.auto_cancel_status)==="pending"||(r==null?void 0:r.auto_cancel_status)==="processing"),defaultValue:((r==null?void 0:r.auto_cancel_status)==="pending"||(r==null?void 0:r.auto_cancel_status)==="processing")&&(r==null?void 0:r.auto_cancel)||"",action:C=>i(h=>({...h,auto_cancel:C}))})]}),(l==null?void 0:l.ticket_status)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Ticket Status"}),e.jsxs("select",{type:"text",name:"ticket_status",className:"w-full h-10 text-sm bg-transparent rounded select select-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(r==null?void 0:r.ticket_status)||"queue",onChange:C=>i(h=>({...h,ticket_status:C.target.value})),children:[e.jsx("option",{value:"queue",children:"Pending Check"}),e.jsx("option",{value:"processing",children:"Verifying Ticket Number"}),e.jsx("option",{value:"issued",children:"Ticket Issued"})]})]}),(l==null?void 0:l.booking_remarks)==="YES"&&e.jsxs("label",{className:"col-span-2 gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Booking Remarks"}),e.jsx("textarea",{name:"booking_remarks",className:"w-full text-sm bg-transparent rounded textarea textarea-bordered focus:outline-0 focus:border-neutral/30",defaultValue:(r==null?void 0:r.booking_remarks)||"",onChange:C=>i(h=>({...h,booking_remarks:C.target.value}))})]}),(l==null?void 0:l.departure_airport)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Departure Airport"}),e.jsx(he,{name:"departure_airport",className:"w-full h-10 text-sm bg-transparent !rounded input input-bordered min-h-8 focus:outline-0 focus:!border-neutral/30 !border-base-content/20",action:C=>i(h=>{var t;return{...h,departure_airport:((t=C==null?void 0:C.at(0))==null?void 0:t.value)||""}}),defaultValue:(r==null?void 0:r.departure_airport)||"",options:s})]}),(l==null?void 0:l.arrival_airport)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Arrival Airport"}),e.jsx(he,{name:"arrival_airport",className:"w-full h-10 text-sm bg-transparent !rounded input input-bordered min-h-8 focus:outline-0 focus:!border-neutral/30 !border-base-content/20",action:C=>i(h=>{var t;return{...h,arrival_airport:((t=C==null?void 0:C.at(0))==null?void 0:t.value)||""}}),defaultValue:(r==null?void 0:r.arrival_airport)||"",options:s})]}),(l==null?void 0:l.supplier_uid)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Supplier UID"}),e.jsx(he,{type:"text",name:"supplier_uid",className:"w-full h-10 text-sm bg-transparent !rounded input input-bordered min-h-8 focus:outline-0 focus:!border-neutral/30 !border-base-content/20",action:C=>i(h=>{var t;return{...h,supplier_uid:((t=C==null?void 0:C.at(0))==null?void 0:t.value)||""}}),defaultValue:(r==null?void 0:r.supplier_uid)||"",options:j})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx("button",{onClick:()=>ce.close(),type:"button",className:"normal-case rounded-md btn btn-primary btn-outline",children:"Close"}),e.jsx("button",{type:"submit",className:"normal-case rounded-md btn btn-primary",children:n?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"animate-spin"})," Updating..."]}):e.jsx(e.Fragment,{children:"Update"})})]})]})};De.propTypes={booking_details:T.object.isRequired,can_modify:T.object,airlines:T.array,airports:T.array,flight_supplier_options:T.array,refetchData:T.func};const Pe=({booking_details:a})=>{var g,N;const{data:l}=((g=J.useState())==null?void 0:g.supplier_option)||{},{can_modify:s}=((N=J.useState())==null?void 0:N.booking_manage)||{},j=we(ce),{axiosInstance:m}=re(),x=l==null?void 0:l.map(f=>({label:`${f==null?void 0:f.title} (${f==null?void 0:f.supplier_uid})`,value:f==null?void 0:f.supplier_uid})),{data:r}=xe({queryKey:["AIRLINES_DATA"],queryFn:async()=>{var F,o;const f=await m.get("/tools/airlines-data");return(o=Object.values((F=f.data)==null?void 0:F.data))==null?void 0:o.map(u=>({label:`${u==null?void 0:u.airline_name} (${u==null?void 0:u.iata_code})`,value:u==null?void 0:u.iata_code}))}}),{data:i}=xe({queryKey:["AIRPORTS_DATA"],queryFn:async()=>{var F;return(F=(await m.get("/tools/airport-autosuggetion-data")).data)==null?void 0:F.map(o=>({label:`${o==null?void 0:o.airport_name} (${o==null?void 0:o.code})`,value:o==null?void 0:o.code}))}}),n=ue(),v=()=>{n.invalidateQueries(["FLIGHT_BOOKING_DETAILS"])},_=()=>{j.fire({html:e.jsx(De,{booking_details:a,can_modify:s,airlines:r,airports:i,flight_supplier_options:x,refetchData:v}),showConfirmButton:!1,showCloseButton:!0,customClass:{popup:"w-full max-w-5xl",htmlContainer:"!m-0",closeButton:"text-red-500"}})};return e.jsxs("button",{onClick:_,className:"h-8 font-normal normal-case rounded btn btn-outline btn-warning flex-nowrap whitespace-nowrap btn-xs",children:[e.jsx(_s,{className:"shrink-0"}),"Update Booking"]})};Pe.propTypes={booking_details:T.object.isRequired};const Gs=()=>e.jsx("div",{className:"mb-5 border rounded card",children:e.jsxs("div",{className:"gap-0 px-2 py-3 space-y-1 text-[13px] text-center card-body",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"font-semibold",children:"Segment"}),e.jsx("div",{className:"font-semibold",children:"Status"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"font-semibold",children:"MXP - DXB"}),e.jsxs("div",{className:"font-semibold",children:["Confirmed ",e.jsx("span",{className:"text-lime-400",children:"(HK)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"font-semibold",children:"DXB - DEL"}),e.jsxs("div",{className:"font-semibold",children:["Time Change ",e.jsx("span",{className:"text-red-500",children:"(TK)"})]})]})]})}),qe=({details:a})=>{const{brand_name:l,partner_profile_code:s,website:j}=a||{};return e.jsx("div",{className:"mb-5 border rounded card",children:e.jsxs("div",{className:"gap-0 px-2 py-3 text-center card-body",children:[e.jsx("h5",{className:"mb-1 text-sm font-semibold",children:l}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s&&e.jsx("div",{className:"badge badge-sm badge-neutral",children:s}),j&&e.jsx("div",{className:"badge badge-sm badge-neutral",children:j})]})]})})};qe.propTypes={details:T.object.isRequired};const Ks=()=>e.jsx("div",{className:"flex items-center justify-between px-2 py-3 mb-5 space-y-1 border rounded",children:e.jsxs("div",{children:[e.jsx("h4",{className:"mb-1 text-sm font-semibold",children:"Sync Schedule"}),e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"font-medium",children:"Next Sync:"})," ",W().format("HH:MM A DdMMM,YY")]}),e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"font-medium",children:"Last Sync:"})," ",W().format("HH:MM A DdMMM,YY")," ",e.jsx("span",{className:"rounded badge badge-xs bg-lime-400 text-white text-[10px]",children:"Successful"}),e.jsx("button",{className:"ml-2 text-xs",children:e.jsx(ke,{})})]})]})}),ye=["supernsn","administrator","manager"],Ve=({booking_details:a})=>{var t,$,A,Y,O,b,P,D,q,X,G,L,K,Q,ee;const{user_access_level:l}=((t=te.useState())==null?void 0:t.user_data)||{},{booking:s,general:j,partner:m,tracking_id:x,flight:r}=a||{},{sell:i}=(($=a==null?void 0:a.flight)==null?void 0:$.price)||{},{booking_manage:n,system_config:v,price_view:_}=J.useState(),{online_payment_option:g}=_||{},{booking_auto_cancel:N,flight_confirm_cancel:f,flight_issue_ticket:k,flight_issue_ticket_reissue:F,flight_price_change_alert:o}=n||{},{service_type:u,timestamp:w,last_update:c}=j||{},{booking_status:p,ticket_status:S}=s||{},{search_parameter:d,modify:I}=r||{},{axiosInstance:U}=re(),{member_id:B}=((A=te.useState())==null?void 0:A.user_data)||{},[M,R]=E.useState(!1),C=ue(),h=async()=>{var y,H,ie;if(!M){R(!0);try{const V=await U.post("/secure?pathName=/supplier-booking-details",{member_id:B,tracking_id:x});if(((y=V==null?void 0:V.data)==null?void 0:y.status)==="success")await C.invalidateQueries(["FLIGHT_BOOKING_DETAILS"]),le("success","Booking Details Synced",(H=V.data)==null?void 0:H.reason);else throw new Error((ie=V==null?void 0:V.data)==null?void 0:ie.reason)}catch(V){le("error","Sync Failed!",V.message)}finally{R(!1)}}};return e.jsxs("div",{className:"sticky p-4 rounded-lg bg-base-200 h-fit top-5 lg:col-span-2",children:[e.jsx("div",{className:`mb-5 rounded card ${s.booking_status==="hold"?"bg-warning border-warning":""} ${s.booking_status==="confirm"?"bg-success border-success":""} ${s.booking_status==="cancel"?"bg-error border-error":"bg-info border-info"}`,children:e.jsxs("div",{className:"gap-0 px-2 py-3 text-center card-body",children:[e.jsx("h3",{className:"text-2xl font-semibold leading-tight text-white capitalize",children:(N==null?void 0:N.toUpperCase())==="DISABLE"&&s.booking_status==="hold"?"Immediate Purchase":s.booking_status}),(N==null?void 0:N.toUpperCase())==="ACTIVE"&&((s==null?void 0:s.booking_status)==="confirm"||(s==null?void 0:s.booking_status)==="hold")&&e.jsx(e.Fragment,{children:e.jsx("p",{className:"text-sm",children:W(new Date(s.auto_cancel)).format("DD-MMM-YY HH:mma")})}),(N==null?void 0:N.toUpperCase())==="ACTIVE"&&s.booking_status==="hold"&&e.jsx(Oe,{auto_cancel:s.auto_cancel})]})}),e.jsx("div",{className:"mb-5 border rounded card bg-base-100",children:e.jsx("div",{className:"px-2 py-3 text-sm card-body",children:e.jsxs("ul",{className:"space-y-0.5",children:[e.jsx("li",{children:e.jsx("p",{className:"pb-2",children:"Booking Summery:"})}),e.jsxs("li",{className:"text-xs",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Created:"})," ",W(new Date(w*1e3)).format(`${v.default_date_format_print} HH:mm a`)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Last Update:"})," ",W(new Date(c*1e3)).format(`${v.default_date_format_print} HH:mm a`)]})]}),e.jsx("li",{children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Service Type:"})," ",u]})}),e.jsx("li",{children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Journey Type:"})," ",d.journey_type]})}),e.jsx("li",{children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:" Booking Status:"})," ",e.jsx("span",{className:`badge badge-sm text-white text-[10px] capitalize ${p==="hold"?"badge-warning":p==="confirm"?"badge-success":"badge-info"}`,children:p})]})}),p==="confirm"&&e.jsx("li",{children:e.jsxs("p",{className:"text-xs",children:[e.jsx("strong",{children:"Ticket Status:"})," ",e.jsx("span",{className:"badge badge-sm badge-secondary text-[10px] capitalize",children:S})]})})]})})}),e.jsxs("div",{className:"p-3 mb-3 text-sm rounded bg-base-100",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3",children:[e.jsx("p",{children:"Fare/Pax type"}),e.jsx("p",{className:"font-medium",children:"Amount"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3",children:[e.jsx("p",{children:"Base Fare"}),e.jsxs("p",{className:"font-medium",children:[ae((Y=i==null?void 0:i.base_fare)==null?void 0:Y.currency)," ",(b=Number((O=i==null?void 0:i.base_fare)==null?void 0:O.amount))==null?void 0:b.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3",children:[e.jsx("p",{children:"Tax"}),e.jsxs("p",{className:"font-medium",children:[ae((P=i==null?void 0:i.tax)==null?void 0:P.currency)," ",(q=Number((D=i==null?void 0:i.tax)==null?void 0:D.amount))==null?void 0:q.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3",children:[e.jsx("p",{children:"Total"}),e.jsxs("p",{className:"font-medium",children:[ae((X=i==null?void 0:i.total)==null?void 0:X.currency)," ",(L=Number((G=i==null?void 0:i.total)==null?void 0:G.amount))==null?void 0:L.toFixed(2)]})]}),e.jsx("hr",{className:"mb-3 border border-neutral/20"}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3",children:[e.jsx("p",{children:"Total Fare"}),e.jsx("p",{className:"font-medium",children:"Amount"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Total Published Fare"}),e.jsxs("p",{className:"font-medium",children:[ae((K=i==null?void 0:i.total)==null?void 0:K.currency)," ",(ee=Number((Q=i==null?void 0:i.total)==null?void 0:Q.amount))==null?void 0:ee.toFixed(2)]})]})]}),["confirm","hold"].includes(s.booking_status)&&ye.includes(l)&&(I==null?void 0:I.itinerary)==="active"&&e.jsx("div",{className:"mb-5 border rounded card",children:e.jsxs("div",{className:"px-2 py-3 text-center card-body",children:[e.jsx("h5",{className:"text-sm font-semibold",children:"Manage Flight Booking"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.booking_status==="hold"&&e.jsxs(e.Fragment,{children:[(k==null?void 0:k.toUpperCase())==="ACTIVE"&&e.jsxs("button",{onClick:()=>{var y;return(y=document.getElementById("issue_ticket_modal"))==null?void 0:y.showModal()},className:"h-8 normal-case rounded btn btn-outline btn-success flex-nowrap whitespace-nowrap btn-xs",children:[e.jsx(z,{path:me,size:.7})," ","Issue Ticket"]}),g==="ACTIVE"&&e.jsxs("button",{onClick:()=>Ke.update(y=>{y.isActive=!0}),className:"h-8 normal-case rounded btn btn-outline btn-primary flex-nowrap whitespace-nowrap btn-xs",children:[e.jsx(z,{path:me,size:.8})," ","Issue Ticket by Card"]})]}),s.booking_status==="confirm"&&(F==null?void 0:F.toUpperCase())==="ACTIVE"&&e.jsxs("button",{onClick:()=>{var y;return(y=document.getElementById("issue_ticket_modal"))==null?void 0:y.showModal()},className:"h-8 normal-case rounded btn btn-outline btn-success flex-nowrap whitespace-nowrap btn-xs",children:[e.jsx(z,{path:me,size:.7})," ","Reissue Ticket"]}),(s.booking_status==="hold"||s.booking_status==="confirm")&&e.jsxs(e.Fragment,{children:[((f==null?void 0:f.toUpperCase())==="ACTIVE"||s.booking_status==="hold")&&e.jsxs("button",{onClick:()=>{var y;return(y=document.getElementById("cancel_flight_modal"))==null?void 0:y.showModal()},className:"h-8 normal-case rounded btn btn-outline btn-error flex-nowrap whitespace-nowrap btn-xs",children:[e.jsx(z,{path:Qe,size:.7})," Cancel"," ",s.booking_status==="hold"?"Flight":"Ticket"]}),s.booking_status==="hold"&&(o==null?void 0:o.toUpperCase())==="YES"&&e.jsxs("button",{onClick:()=>{var y;return(y=document.getElementById("get_price_alert_modal"))==null?void 0:y.showModal()},className:"h-8 text-xs font-normal normal-case rounded btn btn-outline btn-warning flex-nowrap whitespace-nowrap btn-xs",children:[e.jsx(ys,{className:"shrink-0"}),"Get Price Alert"]}),e.jsx("button",{onClick:h,className:"h-8 text-xs font-normal normal-case rounded btn btn-outline btn-info flex-nowrap whitespace-nowrap btn-xs",children:M?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Is,{}),"Sync Booking"]})}),e.jsx(Pe,{booking_details:a})]})]})]})}),e.jsx(Ye,{details:m}),["confirm","hold"].includes(s.booking_status)&&ye.includes(l)&&(I==null?void 0:I.itinerary)==="active"&&e.jsx("div",{className:"mb-5 border rounded card",children:e.jsxs("div",{className:"px-2 py-3 text-center card-body",children:[e.jsx("h5",{className:"text-sm font-semibold",children:"Manage Flight Booking"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsxs("button",{className:"relative p-1 tracking-tight normal-case rounded btn btn-xs btn-primary btn-outline",children:["Send SMS"," ",e.jsx("span",{className:"absolute badge badge-xs text-[9px] badge-primary -top-1.5 -right-2",children:"1"})]}),e.jsx("button",{className:"p-1 tracking-tight normal-case rounded btn btn-xs btn-primary btn-outline",children:"ReQuote"}),e.jsx("button",{className:"p-1 tracking-tight normal-case rounded btn btn-xs btn-primary btn-outline",children:"Low Finder"}),e.jsx("button",{className:"p-1 tracking-tight normal-case rounded btn btn-xs btn-primary btn-outline",children:"Clean"})]})]})}),e.jsx(Gs,{}),e.jsx(qe,{details:m}),e.jsx(Ue,{info:j}),(s==null?void 0:s.booking_status)==="confirm"&&e.jsx("div",{className:"mb-5 border rounded card",children:e.jsxs("div",{className:"gap-0 px-2 py-3 text-center card-body",children:[e.jsx("h5",{className:"mb-3 text-sm font-semibold",children:"Scan QR code for details"}),e.jsxs("div",{children:[" ",e.jsx("a",{href:"#",children:e.jsx("img",{className:"w-full mx-auto rounded max-w-24",alt:"Inno Global Demo",src:`https://api.qrserver.com/v1/create-qr-code/?size=270x270&data=${location.origin}/voucher/flight?q=${btoa(x)}`,"data-holder-rendered":"true"})})," "]})]})}),e.jsx(Ks,{}),e.jsx("div",{className:"flex items-center justify-between px-2 py-3 mb-5 space-y-1 border rounded",children:e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-semibold text-primary",children:[e.jsx(z,{path:We,size:.7})," Submitted Contacts Details to Airlines"]}),e.jsxs("p",{className:"text-xs",children:[e.jsx(z,{path:Je,size:.7})," Email:",m==null?void 0:m.agency_email]}),e.jsxs("p",{className:"text-xs",children:[e.jsx(z,{path:Xe,size:.7})," Contact Number:"," ",m==null?void 0:m.agency_isd_code,m==null?void 0:m.agency_contact_no]})]})})]})};Ve.propTypes={booking_details:T.object.isRequired};const xa=()=>{const{site_title:a,price_view:l}=J.useState(),{online_payment_option:s}=l||{},[j]=ws(),m=j.get("tracking_id"),{user_data:{member_id:x}}=te.useState(u=>u),{axiosInstance:r}=re(),{data:i,isLoading:n,error:v,refetch:_}=xe(["FLIGHT_BOOKING_DETAILS",m,x],async()=>{var c,p,S;const u=await r.post("/booking-details",{tracking_id:m,member_id:x}),w=(p=(c=u.data)==null?void 0:c.booking)==null?void 0:p.booking_status;if(["hold","confirm","cancel","initiated"].includes(w))return u.data;throw{...u,message:((S=u.data)==null?void 0:S.reason)||"Request failed!"}});if(n)return e.jsx(Ze,{});if(v)throw v;const{general:{booking_id:g},booking:{booking_status:N},pax:{primary:f},flight:{modify:{itinerary:k}},special_notice_status:F,special_notice:o}=i;return e.jsxs(e.Fragment,{children:[e.jsx(es,{children:e.jsxs("title",{children:["Flight Booking Details",a?" - "+a:""]})}),e.jsx("main",{className:"container min-h-screen pt-20 mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 gap-5 pt-2 lg:grid-cols-7",children:[e.jsx(Re,{booking_details:i}),e.jsx(Ve,{booking_details:i})]})}),N==="hold"&&k==="active"&&e.jsxs(e.Fragment,{children:[e.jsx(Ys,{data:{booking_id:g,tracking_id:m},refetchBookingDetails:_}),s==="ACTIVE"&&e.jsx(Os,{data:i}),e.jsx(qs,{data:{booking_id:g,tracking_id:m,guest_info:f}})]}),(N==="hold"||N==="confirm")&&k==="active"&&e.jsxs(e.Fragment,{children:[e.jsx(Vs,{data:{booking_id:g,tracking_id:m,guest_info:f}}),e.jsx(Ds,{data:{booking_id:g,tracking_id:m,booking_status:N,special_notice_status:F,special_notice:o},refetchBookingDetails:_}),e.jsx(Ps,{data:{booking_id:g,tracking_id:m},refetchBookingDetails:_})]})]})};export{xa as default};
