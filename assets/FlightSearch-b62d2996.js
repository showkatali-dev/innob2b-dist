import{a1 as Z,e as I,m as Ye,ak as T,o as e,G as Je,a2 as ir,U as nr,al as We,a6 as or,am as Ge}from"./index-3f51aa04.js";import{b as lr,c as cr}from"./index.esm-1b792f18.js";import{S as ze,a as Le,b as dr,P as pr,F as ur,c as _r,d as mr}from"./Searchbox3-3aec67f5.js";import{P as Qe,x as Ue,D as xr,E as fr,a as jr,c as yr,b as br,w as Ve,r as hr,G as vr,H as gr,I as Sr,J as Nr,v as wr}from"./App-7d2219c6.js";import{S as Xe,F as Fr,a as Or}from"./SearchboxSkeleton-01ce6093.js";import{D as kr,a as Ar,b as Cr}from"./drawer-b57f7cdd.js";import{S as Ze}from"./SingleSelect-d84b87ba.js";import"./index.esm-3c90946e.js";import"./RangeSliderInput-c7069082.js";import"./Checkbox-b27bfa98.js";import"./SuppliersSelection2-5642bad5.js";import"./MultipleFlight2-838c19a3.js";import"./index-e501f6c6.js";import"./FlightItineraryData-9a06484c.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./sweetalert2-react-content.es-fff6c100.js";import"./FareTypeSection-cbd78e5a.js";import"./InputDate-4bfbb72f.js";import"./shortcut-buttons-flatpickr.min-7f1fff53.js";import"./PrimaryTabsWithIcon-2ef7eb54.js";import"./index.esm-d3f84af5.js";const Ke=m=>{if(isNaN(m)||m<0)return"Invalid input";const u=Math.floor(m/3600),o=Math.floor(m%3600/60),_=m%60;return`${u.toString().padStart(2,"0")}H, ${o.toString().padStart(2,"0")}M, ${_.toString().padStart(2,"0")}S`},Re=({filterData:m})=>{var M,z;const u=Z.useState(),[o,_]=I.useState(null);I.useEffect(()=>{var p,y;o||!((y=(p=u.segment)==null?void 0:p.at(0))!=null&&y.departure_airport)||_(u)},[u,o]);const{general:l}=Ye.useState(p=>p.component_version)||{},{sortBy:E}=T.useState(p=>p.sorting),{cheapest_flight:g,fastest_flight:S,currency:$}=m,G=()=>{const p=localStorage.getItem("__sfs"),y=JSON.parse(p)||[];y.some(b=>JSON.stringify(b)===JSON.stringify(o))===!1&&(y.unshift(o),localStorage.setItem("__sfs",JSON.stringify(y)),ir.update(()=>y),nr("success","Success","Added to favorite"))};return e.jsxs("div",{className:Ue("flex items-center justify-between mb-4 overflow-auto rounded shadow-custom2 bg-base-200 hide_scrollbar",(l==null?void 0:l.dashboard)!=="3"&&"px-4"),children:[e.jsxs("ul",{className:Ue("flex items-end justify-start flex-1 gap-3 text-start flightResultSorting whitespace-nowrap",(l==null?void 0:l.dashboard)!=="3"&&"justify-center text-center"),children:[e.jsxs("li",{onClick:()=>T.update(p=>{p.sorting.sortBy="cheapest"}),className:`px-4 py-3 border-b-4 border-transparent cursor-pointer group ${E==="cheapest"?"active":""}`,children:[e.jsx("h6",{className:"font-medium",children:"Cheapest"}),e.jsxs("p",{className:"text-xs text-neutral/70 max-sm:hidden",children:["From ",Je($)," ",(M=g==null?void 0:g.total_price)==null?void 0:M.toFixed(2)," •"," ",Ke(g.duration_seconds)]})]}),e.jsxs("li",{onClick:()=>T.update(p=>{p.sorting.sortBy="fastest"}),className:`px-4 py-3 border-b-4 border-transparent cursor-pointer group ${E==="fastest"?"active":""}`,children:[e.jsx("h6",{className:"font-medium",children:"Fastest"}),e.jsxs("p",{className:"text-xs text-neutral/70 max-sm:hidden",children:["From ",Je($)," ",(z=S==null?void 0:S.total_price)==null?void 0:z.toFixed(2)," •"," ",Ke(S.duration_seconds)]})]})]}),(l==null?void 0:l.dashboard)==="3"&&e.jsx("div",{onClick:G,className:"px-2",children:e.jsxs("button",{className:"flex items-center pr-2 duration-100 rounded bg-primary text-primary-content group active:scale-95 max-sm:hidden",children:[e.jsx("span",{className:"inline-flex items-center justify-center p-2 text-sm duration-200 bg-primary-focus group-hover:text-red-500",children:e.jsx(lr,{})}),e.jsx("span",{className:"p-2 text-xs",children:"Save this search"})]})})]})};Re.propTypes={filterData:Qe.object.isRequired,currency:Qe.string};const Dr=()=>{const{sortBy:m,amountType:u}=T.useState(o=>o.sorting);return e.jsxs("div",{className:"flex items-center justify-end gap-2 mb-4",children:[e.jsx("div",{className:"mr-1 text-sm font-medium text-neutral",children:"Sort by"}),e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(Ze,{options:[{label:"Invoice Amount",value:"invoice"},{label:"Gross Amount",value:"gross"}],defaultValue:u,className:"btn btn-primary rounded-sm normal-case font-normal min-h-0 h-10 w-[160px] !pl-6 !pr-2 cursor-pointer no-animation",action:o=>T.update(_=>{var l;_.sorting.amountType=(l=o==null?void 0:o.at(0))==null?void 0:l.value}),searchable:!1,hide_arrow:!0}),e.jsx("div",{className:"absolute text-white left-2 z-[1] text-lg pointer-events-none",children:e.jsx(xr,{})})]}),e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(Ze,{options:[{label:"Cheapest",value:"cheapest"},{label:"Fastest",value:"fastest"}],defaultValue:m,className:"btn btn-primary rounded-sm normal-case font-normal min-h-0 h-10 w-[120px] !pl-6 !pr-2 cursor-pointer no-animation",action:o=>T.update(_=>{var l;_.sorting.sortBy=(l=o==null?void 0:o.at(0))==null?void 0:l.value}),searchable:!1,hide_arrow:!0}),e.jsx("div",{className:"absolute text-white left-2 z-[1] pointer-events-none",children:e.jsx(fr,{})})]})]})},Rr=()=>{var te,se,ie,ne,oe,le,ce,de,pe,ue,_e,me,xe,fe,je,ye,be,he,ve,ge,Se,Ne,we,Fe,Oe,ke,Ae,Ce;const{axiosInstance:m}=jr(),{filteredData:u}=We.useState(a=>a),{price:o,duration:_,baggage_summery:l,no_stop_summery:E,cabin_class:g,aircraft_names:S,departure:$,arrival:G,operating:M,sorting:z}=T.useState(a=>a),{site_title:p,login_required:y,system_config:b,component_version:x}=Ye.useState(),{search_result_version:V}=b||{},[er]=yr(),L=er.get("tracking_id"),rr=br(),[ar,tr]=I.useState(!0),[K,Y]=I.useState(null),{data:X=[]}=Ve(["AIRPORTS_DATA"],async()=>(await m.get("/tools/airport-autosuggetion-data")).data),{t:R}=hr(),{data:t,isLoading:A,error:ee}=Ve(["SEARCH_RESULT",L],async()=>{var s,n,c,j,N,w,h,P,F,v,C,D,B,O,Q,U;const a=await m.get(`/flight_logs?tracking_id=${L}&base_url=${b!=null&&b.supplier_logs_file_base_url?b==null?void 0:b.supplier_logs_file_base_url:""}&login_required=${y}`);if(!L)return rr("/"),null;if(((s=a==null?void 0:a.data)==null?void 0:s.status)==="success"){Ge.update(r=>{var i;r.modal.data=(i=a.data)==null?void 0:i.data[0]}),Y((n=a.data)==null?void 0:n.message);const q={},H={},J={};return(c=a.data)==null||c.data.forEach(r=>{var i,d,k,f,W,De,Be,Ie,Te,Ee,$e,Me,Pe,qe,He;(!q[(i=r==null?void 0:r.filter)==null?void 0:i.no_of_stops]||q[(d=r==null?void 0:r.filter)==null?void 0:d.no_of_stops]>((k=r==null?void 0:r.filter)==null?void 0:k.price))&&(q[(f=r==null?void 0:r.filter)==null?void 0:f.no_of_stops]=(W=r==null?void 0:r.filter)==null?void 0:W.price),(!H[(De=r==null?void 0:r.supplier)==null?void 0:De.supplier_code]||H[(Be=r==null?void 0:r.supplier)==null?void 0:Be.supplier_code]>((Ie=r==null?void 0:r.filter)==null?void 0:Ie.price))&&(H[(Te=r==null?void 0:r.supplier)==null?void 0:Te.supplier_code]=(Ee=r==null?void 0:r.filter)==null?void 0:Ee.price),(!J[($e=r==null?void 0:r.filter)==null?void 0:$e.carrier_operating]||J[(Me=r==null?void 0:r.filter)==null?void 0:Me.carrier_operating]>((Pe=r==null?void 0:r.filter)==null?void 0:Pe.price))&&(J[(qe=r==null?void 0:r.filter)==null?void 0:qe.carrier_operating]=(He=r==null?void 0:r.filter)==null?void 0:He.price)}),a.data.filter_data={...a.data.filter_data,priceByStops:q,priceBySuppliers:H,priceByAirlines:J,currency:(h=(w=(N=(j=a.data)==null?void 0:j.data[0])==null?void 0:N.price)==null?void 0:w.total)==null?void 0:h.currency,departureAirport:(C=(v=(F=(P=a.data)==null?void 0:P.data[0])==null?void 0:F.search_parameter)==null?void 0:v.departure_airport)==null?void 0:C.at(0),arrivalAirport:(Q=(O=(B=(D=a.data)==null?void 0:D.data[0])==null?void 0:B.search_parameter)==null?void 0:O.arrival_airport)==null?void 0:Q.at(-1)},a.data}else throw{...a,message:((U=a.data)==null?void 0:U.reason)||"Request failed!"}});I.useEffect(()=>{if(!A){if(t){let a=[...t.data];a=a.filter(s=>s.filter.price>o.min_price&&s.filter.price<o.max_price||!o.min_price||!o.max_price),a=a.filter(s=>!(_!=null&&_.min_duration)||s.filter.journey.duration_seconds>_.min_duration&&s.filter.journey.duration_seconds<_.max_duration),a=a.filter(s=>Object.values(l).every(n=>n===!1)?!0:l[s.filter.baggage_summery]===!0),a=a.filter(s=>Object.values(E).every(n=>n===!1)?!0:E[s.filter.no_stop_summery]===!0),a=a.filter(s=>{var n;return Object.values($).every(c=>c.value===!1)?!0:((n=$[s.filter.departure_timing_slot])==null?void 0:n.value)===!0}),a=a.filter(s=>{var n;return Object.values(G).every(c=>c.value===!1)?!0:((n=G[s.filter.arrival_timing_slot])==null?void 0:n.value)===!0}),a=a.filter(s=>Object.values(M).every(n=>n===!1)?!0:M[s.filter.carrier_operating]===!0),a=a.filter(s=>Object.values(g).every(n=>n===!1)?!0:g[s.filter.cabin_class]===!0),a=a.filter(s=>Object.values(S).every(n=>n===!1)?!0:S[s.filter.aircraft_name]===!0),a=a.map(s=>{var c;return{...s,package_count:((c=[...a].filter(j=>(j==null?void 0:j.filter_unique_filter_code)===(s==null?void 0:s.filter_unique_filter_code)))==null?void 0:c.length)||1}}),a=V==="6"?a.reduce((s,n)=>{var F,v,C,D;const c={...n},{journey_type:j,result_type:N,flight_group:w,supplier:h}=c||{},P=(D=(C=(v=(F=w==null?void 0:w.at(0))==null?void 0:F.routes)==null?void 0:v.at(0))==null?void 0:C.operating)==null?void 0:D.carrier;if(N==="general"&&j==="OneWay"&&P==="FZ"&&(h==null?void 0:h.supplier_code)==="flydubai"){const B=s.findIndex(O=>(O==null?void 0:O.special_name)==="showkat");B===-1?(c.special_name="showkat",c.result_type="group",c.round_group=[{group:{flight_option:"OneWay",data:[n]}}],s.push(c)):s[B].round_group[0].group.data.push(c)}else s.push(c);return s},[]):a,a.sort((s,n)=>z.sortBy==="cheapest"?s.filter.price-n.filter.price:s.filter.journey.duration_seconds-n.filter.journey.duration_seconds),We.update(s=>{s.filteredData=a})}tr(!1)}},[o,_,t,l,E,$,G,M,z,S,g,A,V]),I.useEffect(()=>{var a;if(((a=t==null?void 0:t.data)==null?void 0:a.length)>0&&X.length>0){const{search_parameter:{journey_type:s,non_stop_flight:n,baggage_option:c,booking_class:j,segment:N,travelers_adult:w,travelers_child:h,travelers_child_age:P,travelers_infants:F,travelers_infants_age:v,preferred_carrier:C,supplier_uid:D,fare_type:B,fare_corporate_code:O,travelers_ptc:Q,fare_option:U,partner_id:q,fare_account_code:H}}=t.data[0],J=window.location.origin,r=X.reduce((i,d)=>(i[d.code]=d,i),{});Z.update(i=>{i.partner_id=q,i.fare_type=B,i.fare_corporate_code=O,i.fare_account_code=H,i.travelers_ptc=Q,i.fare_option=U,i.journey_type=s,i.non_stop_flight=n,i.baggage_option=c,i.booking_class=j,i.travelers_adult=Number(w)||0,i.travelers_child=Number(h)||0,i.travelers_child_age=P.slice(0,Number(h))||[],i.travelers_infants=Number(F)||0,i.travelers_infants_age=(v==null?void 0:v.slice(0,Number(F)))||[],N.forEach((d,k)=>{i.segment[k]={...d,departure_airport_type:d.departure_airport_type,departure_airport:d.departure_airport_type==="AIRPORT"?r[d.departure_airport]:Object.values(r).find(f=>f.city_code===d.departure_airport),arrival_airport_type:d.arrival_airport_type,arrival_airport:d.arrival_airport_type==="AIRPORT"?r[d.arrival_airport]:Object.values(r).find(f=>f.city_code===d.arrival_airport)}}),i.flight_count=N.length>2?N.length:2,i.supplier_uid=D}),vr.get(`${J}/airlines_list.json`).then(i=>{const d=Object.keys(i.data.data).map(k=>{const{iata_code:f,airline_name:W}=i.data.data[k];return{label:`${W} (${f})`,value:f}});Z.update(k=>{k.preferred_carrier=C.map(f=>d.find(W=>W.value===f))||[]})}),ae(!1)}},[t,X]);const re=gr.useMediaQuery({query:"(max-width: 640px)"}),[sr,ae]=I.useState(!1);if(ee)throw ee;return e.jsxs("main",{className:"container min-h-screen pt-20",children:[e.jsx(or,{children:e.jsxs("title",{children:["Flight Search",p?" - "+p:""]})}),re&&e.jsxs(kr,{open:sr,onOpenChange:ae,children:[e.jsx(Ar,{asChild:!0,children:e.jsxs("button",{className:"flex items-center justify-center w-full gap-2 px-5 py-4 mb-3 duration-100 rounded-md shadow-custom2 bg-base-200 hover:text-primary",children:[e.jsx(Sr,{}),e.jsx("span",{children:R("modify_search")})]})}),e.jsx(Cr,{children:e.jsx("div",{className:"max-h-[90vh] overflow-auto",children:!A&&(t!=null&&t.filter_data)?((te=x==null?void 0:x.flight)==null?void 0:te.search_box)==="2"?e.jsx(ze,{}):e.jsx(Le,{}):e.jsx(Xe,{})})})]}),e.jsxs("button",{onClick:()=>Ge.update(a=>{a.flight_search_sidebar.mobile.isActive=!0}),className:"flex items-center justify-center w-full gap-2 px-5 py-4 duration-100 rounded-md shadow-custom2 bg-base-200 hover:text-primary lg:hidden",children:[e.jsx(Nr,{}),e.jsx("span",{children:R("Filters")})]}),!re&&e.jsx(e.Fragment,{children:!A&&(t!=null&&t.filter_data)?((se=x==null?void 0:x.flight)==null?void 0:se.search_box)==="2"?e.jsx(ze,{}):((ie=x==null?void 0:x.flight)==null?void 0:ie.search_box)==="3"?e.jsx(dr,{}):e.jsx(Le,{}):e.jsx(Xe,{})}),((le=(oe=(ne=t==null?void 0:t.data)==null?void 0:ne.at(0))==null?void 0:oe.search_parameter)==null?void 0:le.journey_type)!=="MultiCity"&&((ce=t==null?void 0:t.data)==null?void 0:ce.length)>0&&e.jsx(pr,{search_parameter:(de=t==null?void 0:t.data[0])==null?void 0:de.search_parameter}),!A&&(t==null?void 0:t.filter_data)&&K&&e.jsx("div",{className:"mb-4 overflow-hidden border rounded-md shadow bg-base-200 border-warning animate-pulse",children:e.jsxs("div",{className:"relative px-3 py-2 bg-warning/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"py-1 text-warning",children:e.jsx(cr,{className:"text-xl"})}),e.jsx("div",{children:e.jsx("p",{className:"text-xs font-normal",children:K})})]}),e.jsx("button",{onClick:()=>Y(null),className:"absolute top-1 right-1 btn btn-ghost btn-circle btn-sm !bg-transparent",children:e.jsx(wr,{})})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mt-5 mb-5 lg:grid-cols-4",children:[!A&&(t!=null&&t.filter_data)?((pe=x==null?void 0:x.flight)==null?void 0:pe.search_filter)==="2"?e.jsx(ur,{filterData:t.filter_data,additionalData:{date:(_e=(ue=t.data[0])==null?void 0:ue.search_parameter)==null?void 0:_e.departure_date[0],departure_from:(xe=(me=t.data[0])==null?void 0:me.search_parameter)==null?void 0:xe.departure_airport[0],arrival_to:(ye=(je=(fe=t.data[0])==null?void 0:fe.search_parameter)==null?void 0:je.arrival_airport)==null?void 0:ye.at(-1),total_fight:(u==null?void 0:u.length)||0,journey_type:(he=(be=t.data[0])==null?void 0:be.search_parameter)==null?void 0:he.journey_type,tracking_id:L}}):e.jsx(_r,{filterData:t.filter_data,additionalData:{date:(ge=(ve=t.data[0])==null?void 0:ve.search_parameter)==null?void 0:ge.departure_date[0],departure_from:(Ne=(Se=t.data[0])==null?void 0:Se.search_parameter)==null?void 0:Ne.departure_airport[0],arrival_to:(Oe=(Fe=(we=t.data[0])==null?void 0:we.search_parameter)==null?void 0:Fe.arrival_airport)==null?void 0:Oe.at(-1),total_fight:(u==null?void 0:u.length)||0,journey_type:(Ae=(ke=t.data[0])==null?void 0:ke.search_parameter)==null?void 0:Ae.journey_type,tracking_id:L}}):e.jsx(Fr,{}),e.jsx("section",{className:"lg:col-span-3",children:e.jsxs("div",{children:[!A&&(t!=null&&t.filter_data)?V==="7"?e.jsx(Dr,{}):e.jsx(Re,{filterData:t.filter_data,currency:t==null?void 0:t.currency,search_parameter:(Ce=t==null?void 0:t.data[0])==null?void 0:Ce.search_parameter}):e.jsx("div",{className:"h-20 mb-5 skeleton-box"}),ar?e.jsx(Or,{}):e.jsx(mr,{})]})})]})]})};export{Rr as default};
