import{a4 as w,o as a,m as D,e as Y,O as n,X as S,Y as T,G as m,Q as M}from"./index.js";import{P as l,a as I,p as H,b as L,q as C,ab as F,ac as $,ad as B,a4 as b}from"./App.js";import{I as O}from"./InputDateRange.js";import{D as j}from"./DropDownSelectCheckout.js";import{T as k}from"./TextInputCheckout.js";import{C as G}from"./CustomPopOver.js";import"./shortcut-buttons-flatpickr.min.js";import"./SingleSelect.js";const g=({label:c,isRequired:u=!1,action:i,defaultValue:p,placeholder:o="",minDate:t})=>{const r=w();return a.jsxs("div",{className:"sb-input-container",children:[a.jsxs("label",{className:"sb-label",htmlFor:r,children:[c," ",u&&"*"]}),a.jsx(O,{action:i,className:"sb-input",defaultValue:p,minDate:t,placeholder:o})]})};g.propTypes={label:l.string.isRequired,isRequired:l.bool,action:l.func.isRequired,defaultValue:l.array,minDate:l.string,placeholder:l.string};const P=[{label:"Any",value:"any"},{label:"Flight",value:"FLIGHT"},{label:"Hotel",value:"HOTEL"}],R=[{label:"Any",value:"any"},{label:"Hold",value:"hold"},{label:"Confirm",value:"confirm"},{label:"Failed",value:"failed"},{label:"Cancel",value:"cancel"},{label:"Initiated",value:"initiated"},{label:"Pending",value:"pending"}],z=()=>{const{site_title:c,booking_manage:u}=D.useState(),{booking_auto_cancel:i}=u||{},{axiosInstance:p}=I(),[o]=H(),[t,r]=Y.useState({member_id:"all",service_type:"any",generated_date_start:"",generated_date_end:"",book_date_start:"",book_date_end:"",booking_status:"any"}),h={member_id:"all",service_type:o.get("service_type")||"any",generated_date_start:o.get("generated_date_start")||n().subtract(1,"month").format("YYYY-MM-DD"),generated_date_end:o.get("generated_date_end")||n().format("YYYY-MM-DD"),book_date_start:o.get("book_date_start")||"",book_date_end:o.get("book_date_end")||"",booking_status:o.get("booking_status")||"any"},{data:_,error:f,isLoading:y}=L(["MY_BOOKINGS",h],async()=>{var s,d;const e=await p.post("/booking-list",h);if(((s=e.data)==null?void 0:s.status)==="success")return r(h),e.data.data;throw{...e,message:((d=e.data)==null?void 0:d.reason)||"Request failed!"}}),v=C(),N=async e=>{e.preventDefault();const s=new URLSearchParams(Object.entries(t)).toString();v(`/my-bookings?${s}`)},x=(e,s)=>{r({service_type:"any",generated_date_start:"",generated_date_end:"",book_date_start:"",book_date_end:"",booking_status:"any",[e]:s})};if(y)return a.jsx(S,{});if(f)throw f;return a.jsxs("main",{className:"container min-h-screen pt-20",children:[a.jsx(T,{children:a.jsxs("title",{children:["Bookings",c?" - "+c:""]})}),a.jsxs("div",{className:"pt-2",children:[a.jsxs("form",{onSubmit:N,className:"relative p-4 mb-16 shadow-md bg-base-200 rounded-b-2xl rounded-2xl",children:[a.jsxs("div",{className:"grid grid-cols-1 gap-5 mb-5 sm:mb-8 sm:grid-cols-2 lg:grid-cols-4",children:[a.jsx(j,{label:"Service Type",action:e=>{var s;return r({...t,service_type:((s=e[0])==null?void 0:s.value)||""})},options:P,defaultValue:t.service_type||null,placeholder:"Select Service Type"}),a.jsx(g,{label:"Booking Created",action:e=>{e[0]&&e[1]?r({...t,generated_date_start:n(e[0]).format("YYYY-MM-DD"),generated_date_end:n(e[1]).format("YYYY-MM-DD")}):r({...t,generated_date_start:"",generated_date_end:""})},defaultValue:t.generated_date_start&&t.generated_date_end?[t.generated_date_start,t.generated_date_end]:null,placeholder:"Select Booking Created Dates"}),a.jsx(g,{label:"Stay Between / Departure & Arrival",action:e=>{e[0]&&e[1]?r({...t,book_date_start:n(e[0]).format("YYYY-MM-DD"),book_date_end:n(e[1]).format("YYYY-MM-DD")}):r({...t,book_date_start:"",book_date_end:""})},defaultValue:t.book_date_start&&t.book_date_end?[t.book_date_start,t.book_date_end]:null,placeholder:"Select"}),a.jsx(g,{label:"Auto Cancel Date Between",action:e=>console.log(e),placeholder:"Select"}),a.jsx(k,{label:"Booking ID",action:e=>x("booking_id",e.target.value),defaultValue:t.booking_id||null,placeholder:"Type Booking ID"}),a.jsx(k,{label:"PNR/Confirmation/Supplier ID",action:e=>x("supplier_confirmation_id",e.target.value),defaultValue:t.supplier_confirmation_id||null,placeholder:"Type Supplier Confirmation ID"}),a.jsx(k,{label:"Lead Guest Name",action:e=>x("primary_guest_name",e.target.value),defaultValue:t.primary_guest_name||null,placeholder:"Type Guest Name"}),a.jsx(j,{label:"Booking Status",action:e=>{var s;return r({...t,booking_status:(s=e[0])==null?void 0:s.value})},options:R,defaultValue:t.booking_status||null,placeholder:"Select Booking Status"})]}),a.jsx("button",{type:"submit",className:"btn btn-lg min-h-0 h-12 btn-primary sm:absolute static top-full left-1/2 sm:-translate-x-1/2 sm:-translate-y-1/2 sm:active:!-translate-x-1/2 sm:active:!-translate-y-1/2 sm:active:scale-95 !animate-none normal-case flex-nowrap font-normal max-sm:w-full",children:"Search"})]}),(_==null?void 0:_.length)>0?a.jsx("div",{className:"w-full mb-8 overflow-x-auto",children:a.jsxs("table",{className:"table text-sm mb-28 booking-list-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-sm border",children:"Sl"}),a.jsx("th",{className:"text-sm border",children:"Reference"}),a.jsx("th",{className:"text-sm border",children:"Stay (Departure & Arrival)"}),a.jsx("th",{className:"text-sm border",children:"Hotel/Airlines"}),a.jsx("th",{className:"text-sm border",children:"Amount"}),a.jsx("th",{className:"text-sm border",children:"Status"})]})}),a.jsx("tbody",{children:_.map((e,s)=>{var d;return a.jsxs("tr",{children:[a.jsx("th",{className:"text-sm border",children:s+1}),a.jsxs("td",{className:"max-w-xs overflow-hidden border",children:[a.jsxs("p",{className:"flex items-center gap-1",children:[e.service_type==="FLIGHT"&&a.jsx(F,{}),e.service_type==="HOTEL"&&a.jsx($,{})," ",a.jsxs("span",{className:"flex flex-wrap items-center",children:[e.booking_id," ",e.service_type==="FLIGHT"&&e.airlines_pnr&&a.jsxs("span",{className:"text-[10px] border-transparent rounded-full badge badge-sm bg-warning/10 text-warning whitespace-normal",children:["PNR: ",e.airlines_pnr]})]})]}),a.jsx("p",{children:n(new Date(e.timestamp*1e3)).format("DD MMM YYYY hh:mm a")}),a.jsx("p",{className:"text-xs",children:e.entry_n})]}),a.jsxs("td",{className:"border",children:[a.jsxs("p",{children:[n(new Date(e.checkin_departure_date)).format("DD-MMM-YY")," ","to"," ",n(new Date(e.checkout_arrival_date)).format("DD-MMM-YY")]}),(i==null?void 0:i.toUpperCase())==="ACTIVE"&&a.jsx("p",{className:"text-[10.5px] px-2 inline bg-black text-white rounded-full",children:e.auto_cancel})]}),a.jsxs("td",{className:"text-xs border",children:[a.jsx("p",{children:e.primary_guest_name}),e.service_type==="FLIGHT"&&a.jsxs("p",{children:[e.departure_airport,"-",e.arrival_airport," (",e.journey_type,")"]}),e.service_type==="HOTEL"&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("p",{children:((d=e.carrier_hotel)==null?void 0:d.length)>25?`${e.carrier_hotel.substring(0,25)}..`:e.carrier_hotel}),a.jsx(G,{button:a.jsx(B,{className:"text-info"}),position:"bottom",children:a.jsx("div",{className:"p-2",children:a.jsx("p",{children:e.carrier_hotel})})})]})]}),a.jsxs("td",{className:"text-xs border",children:[a.jsxs("p",{children:["Sell: ",m(e.currency)," ",e.sell_total_price]}),a.jsxs("p",{children:["Purchase: ",m(e.currency)," ",e.total_amount]}),a.jsxs("p",{children:["Margin: ",m(e.currency)," ",(e.sell_total_price-e.total_amount).toFixed(2)]})]}),a.jsx("td",{className:"border",children:e.booking_status==="confirm"?a.jsx(b,{to:e.service_type==="FLIGHT"?`/booking-details/flight?tracking_id=${e.tracking_id}`:e.service_type==="HOTEL"?`/booking-details/hotel?tracking_id=${e.tracking_id}`:`/booking-details/car?tracking_id=${e.tracking_id}`,className:"w-24 m-1 text-white normal-case rounded btn btn-sm btn-success flex-nowrap",children:"Confirm"}):e.booking_status==="hold"?a.jsx(b,{to:e.service_type==="FLIGHT"?`/booking-details/flight?tracking_id=${e.tracking_id}`:e.service_type==="HOTEL"?`/booking-details/hotel?tracking_id=${e.tracking_id}`:`/booking-details/car?tracking_id=${e.tracking_id}`,className:"w-24 m-1 text-white normal-case rounded btn btn-sm btn-warning flex-nowrap",children:"Hold"}):e.booking_status==="initiated"?a.jsx(b,{to:e.service_type==="FLIGHT"?`/booking-details/flight?tracking_id=${e.tracking_id}`:e.service_type==="HOTEL"?`/booking-details/hotel?tracking_id=${e.tracking_id}`:`/booking-details/car?tracking_id=${e.tracking_id}`,className:"w-24 m-1 normal-case rounded btn btn-sm btn-outline hover:text-white btn-info flex-nowrap",children:"Initiated"}):e.booking_status==="cancel"?a.jsx(b,{to:e.service_type==="FLIGHT"?`/booking-details/flight?tracking_id=${e.tracking_id}`:e.service_type==="HOTEL"?`/booking-details/hotel?tracking_id=${e.tracking_id}`:`/booking-details/car?tracking_id=${e.tracking_id}`,className:"w-24 m-1 text-white normal-case rounded btn btn-sm btn-error flex-nowrap",children:"Canceled"}):a.jsx("button",{onClick:()=>M("error",`Booking Status: ${e.booking_status}`,`This booking is not available for booking status ${e.booking_status}`),className:"w-24 m-1 normal-case rounded btn btn-sm btn-outline hover:text-white btn-error flex-nowrap",children:"Failed"})})]},e.booking_id)})})]})}):a.jsx("p",{className:"py-10 text-center text-error",children:"No result found"})]})]})};export{z as default};
