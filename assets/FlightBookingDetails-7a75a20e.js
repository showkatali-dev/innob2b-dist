import{e as y,q as e,o as P,u as z,m as U,T as L,P as X,I as R,aA as O,aB as Z,aC as ee,a4 as se,a5 as te}from"./index-5b04c002.js";import{P as I,d as q,e as Y,ab as ae,S as G,V as K,ac as ne,n as re}from"./App-94c4b974.js";import{B as le}from"./index-0011a7dd.js";import{e as oe,b as ce,g as ie}from"./index.esm-737ce12a.js";import{B as ue,a as de}from"./BookingAgencyDetails-bd8c2081.js";import{w as pe}from"./sweetalert2-react-content.es-8e626fa1.js";import{S as $}from"./SingleSelect-28827d9a.js";import{I as me}from"./InputDateWithTime-fe85b1e6.js";import{I as he,a as xe,C as ge,G as je}from"./IssueTicketByCardModal-d2f478ee.js";import{S as be,a as fe}from"./SendBookingPayLinkModal-c9066d2f.js";import"./RegenerateSearch-4453823e.js";import"./pp-b0a8c2b2.js";import"./InputDate-6167b1db.js";import"./index-4816f85e.js";import"./PhoneNumberSelect-5a46c622.js";import"./FlightItineraryData-f4389036.js";import"./ActivityLogs-af16ccca.js";import"./navigation-f473d6fa.js";import"./navigation-272d5ed6.js";import"./RefundData-739993af.js";const Q=({auto_cancel:t})=>{const[a,n]=y.useState(f(t));y.useEffect(()=>{const u=setInterval(()=>{n(f(t))},1e3);return()=>clearInterval(u)},[t]);function f(u){const N=new Date,r=new Date(u)-N;if(r<=0)return{days:0,hours:0,minutes:0,seconds:0};const m=Math.floor(r/(1e3*60*60*24)),o=Math.floor(r%(1e3*60*60*24)/(1e3*60*60)),j=Math.floor(r%(1e3*60*60)/(1e3*60)),x=Math.floor(r%(1e3*60)/1e3);return{days:m,hours:o,minutes:j,seconds:x}}const{days:h,hours:g,minutes:S,seconds:s}=a;return e.jsx("div",{className:"mb-5 rounded card bg-error border-error",children:e.jsxs("div",{className:"p-5 text-center card-body",children:[e.jsx("p",{className:"text-sm text-white",children:"System will cancel the booking automatically"}),e.jsx("h3",{className:"mt-2 font-mono text-2xl font-extrabold text-white capitalize",children:`${h}d ${g}h ${S}m ${s}s`})]})})};Q.propTypes={auto_cancel:I.string};const W=({booking_details:t,can_modify:a,airlines:n,airports:f,flight_supplier_options:h,refetchData:g})=>{var x,d,c,v,_,T,A,B,E,F,p,M,V,b;const{member_id:S}=((x=U.useState())==null?void 0:x.user_data)||{},[s,u]=y.useState({tracking_id:(t==null?void 0:t.tracking_id)||"",member_id:S,supplier_uid:((c=(d=t==null?void 0:t.supplier)==null?void 0:d.info)==null?void 0:c.supplier_uid)||"",supplier_confirmation_id:((v=t==null?void 0:t.general)==null?void 0:v.supplier_confirmation_id)||"",airlines_pnr:((_=t==null?void 0:t.general)==null?void 0:_.airlines_pnr)||"",booking_status:((T=t==null?void 0:t.booking)==null?void 0:T.booking_status)||"hold",ticket_status:((A=t==null?void 0:t.booking)==null?void 0:A.ticket_status)||"queue",departure_airport:((B=t==null?void 0:t.flight)==null?void 0:B.departure_airport)||"",arrival_airport:((E=t==null?void 0:t.flight)==null?void 0:E.arrival_airport)||"",journey_type:((p=(F=t==null?void 0:t.flight)==null?void 0:F.search_parameter)==null?void 0:p.journey_type)||"OneWay",auto_cancel_status:((M=t==null?void 0:t.booking)==null?void 0:M.auto_cancel_status)||"pending",auto_cancel:((V=t==null?void 0:t.booking)==null?void 0:V.auto_cancel)||"",booking_remarks:((b=t==null?void 0:t.general)==null?void 0:b.booking_remarks)||""}),[N,w]=y.useState(!1),[r,m]=y.useState(null),{axiosInstance:o}=q(),j=async l=>{var i,C,H;if(l.preventDefault(),!N){m(null),w(!0);try{const k=await o.post("/flight/update-booking-info",s);if(((i=k.data)==null?void 0:i.status)==="success")G.close(),g(),L("success","Success!",(C=k.data)==null?void 0:C.reason);else throw new Error((H=k==null?void 0:k.data)==null?void 0:H.reason)}catch(k){console.error(k),m(k.message)}finally{w(!1)}}};return e.jsxs("form",{onSubmit:j,className:"relative px-6 py-4 text-start",children:[e.jsx("h3",{className:"pb-2 text-lg font-semibold",children:"Update Booking Info"}),e.jsx("hr",{className:"mb-4"}),r&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 py-1 pl-4 mx-auto border border-l-4 rounded-r border-warning text-warning w-fit",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(oe,{})}),e.jsx("div",{className:"text-sm",children:r})]}),e.jsx("button",{onClick:()=>m(null),className:"btn btn-ghost btn-circle btn-sm text-error hover:bg-transparent hover:text-red-500",children:e.jsx(ce,{})})]})}),e.jsxs("div",{className:"flex flex-col gap-5 sm:grid sm:grid-cols-2",children:[(a==null?void 0:a.supplier_confirmation_id)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Order ID/GDS PNR"}),e.jsx("input",{type:"text",name:"supplier_confirmation_id",className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(s==null?void 0:s.supplier_confirmation_id)||"",onChange:l=>u(i=>({...i,supplier_confirmation_id:l.target.value}))})]}),(a==null?void 0:a.airlines_pnr)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Airlines PNR"}),e.jsx("input",{type:"text",name:"airlines_pnr",className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(s==null?void 0:s.airlines_pnr)||"",onChange:l=>u(i=>({...i,airlines_pnr:l.target.value}))})]}),(a==null?void 0:a.booking_status)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Booking Status"}),e.jsxs("select",{type:"text",name:"booking_status",className:"w-full h-10 text-sm bg-transparent rounded select select-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(s==null?void 0:s.booking_status)||"hold",onChange:l=>u(i=>({...i,booking_status:l.target.value})),children:[e.jsx("option",{value:"hold",children:"Hold"}),e.jsx("option",{value:"confirm",children:"Confirm"}),e.jsx("option",{value:"cancel",children:"Cancel"})]})]}),(a==null?void 0:a.auto_cancel_status)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Auto Cancel Status"}),e.jsxs("select",{type:"text",name:"auto_cancel_status",className:"w-full h-10 text-sm bg-transparent rounded select select-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(s==null?void 0:s.auto_cancel_status)||"pending",onChange:l=>u(i=>({...i,auto_cancel_status:l.target.value})),children:[e.jsx("option",{value:"pending",children:"Schedule Auto Cancel"}),e.jsx("option",{value:"processing",children:"Cancel On Process"}),e.jsx("option",{value:"auto-cancel-review",children:"Auto Cancel Failed"}),e.jsx("option",{value:"auto-cancel",children:"Complete"})]})]}),(a==null?void 0:a.auto_cancel)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Auto Cancel"}),e.jsx(me,{className:"w-full h-10 text-sm bg-transparent rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",disabled:!((s==null?void 0:s.auto_cancel_status)==="pending"||(s==null?void 0:s.auto_cancel_status)==="processing"),defaultValue:((s==null?void 0:s.auto_cancel_status)==="pending"||(s==null?void 0:s.auto_cancel_status)==="processing")&&(s==null?void 0:s.auto_cancel)||"",action:l=>u(i=>({...i,auto_cancel:l}))})]}),(a==null?void 0:a.ticket_status)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Ticket Status"}),e.jsxs("select",{type:"text",name:"ticket_status",className:"w-full h-10 text-sm bg-transparent rounded select select-bordered min-h-8 focus:outline-0 focus:border-neutral/30",defaultValue:(s==null?void 0:s.ticket_status)||"queue",onChange:l=>u(i=>({...i,ticket_status:l.target.value})),children:[e.jsx("option",{value:"queue",children:"Pending Check"}),e.jsx("option",{value:"processing",children:"Verifying Ticket Number"}),e.jsx("option",{value:"issued",children:"Ticket Issued"})]})]}),(a==null?void 0:a.booking_remarks)==="YES"&&e.jsxs("label",{className:"col-span-2 gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Booking Remarks"}),e.jsx("textarea",{name:"booking_remarks",className:"w-full text-sm bg-transparent rounded textarea textarea-bordered focus:outline-0 focus:border-neutral/30",defaultValue:(s==null?void 0:s.booking_remarks)||"",onChange:l=>u(i=>({...i,booking_remarks:l.target.value}))})]}),(a==null?void 0:a.departure_airport)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Departure Airport"}),e.jsx($,{name:"departure_airport",className:"w-full h-10 text-sm bg-transparent !rounded input input-bordered min-h-8 focus:outline-0 focus:!border-neutral/30 !border-base-content/20",action:l=>u(i=>{var C;return{...i,departure_airport:((C=l==null?void 0:l.at(0))==null?void 0:C.value)||""}}),defaultValue:(s==null?void 0:s.departure_airport)||"",options:f})]}),(a==null?void 0:a.arrival_airport)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Arrival Airport"}),e.jsx($,{name:"arrival_airport",className:"w-full h-10 text-sm bg-transparent !rounded input input-bordered min-h-8 focus:outline-0 focus:!border-neutral/30 !border-base-content/20",action:l=>u(i=>{var C;return{...i,arrival_airport:((C=l==null?void 0:l.at(0))==null?void 0:C.value)||""}}),defaultValue:(s==null?void 0:s.arrival_airport)||"",options:f})]}),(a==null?void 0:a.supplier_uid)==="YES"&&e.jsxs("label",{className:"gap-1 form-control",children:[e.jsx("span",{className:"text-sm",children:"Supplier UID"}),e.jsx($,{type:"text",name:"supplier_uid",className:"w-full h-10 text-sm bg-transparent !rounded input input-bordered min-h-8 focus:outline-0 focus:!border-neutral/30 !border-base-content/20",action:l=>u(i=>{var C;return{...i,supplier_uid:((C=l==null?void 0:l.at(0))==null?void 0:C.value)||""}}),defaultValue:(s==null?void 0:s.supplier_uid)||"",options:h})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx("button",{onClick:()=>G.close(),type:"button",className:"normal-case rounded-md btn btn-primary btn-outline",children:"Close"}),e.jsx("button",{type:"submit",className:"normal-case rounded-md btn btn-primary",children:N?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"animate-spin"})," Updating..."]}):e.jsx(e.Fragment,{children:"Update"})})]})]})};W.propTypes={booking_details:I.object.isRequired,can_modify:I.object,airlines:I.array,airports:I.array,flight_supplier_options:I.array,refetchData:I.func};const D=({booking_details:t})=>{var r,m;const{data:a}=((r=P.useState())==null?void 0:r.supplier_option)||{},{can_modify:n}=((m=P.useState())==null?void 0:m.booking_manage)||{},f=pe(G),{axiosInstance:h}=q(),g=a==null?void 0:a.map(o=>({label:`${o==null?void 0:o.title} (${o==null?void 0:o.supplier_uid})`,value:o==null?void 0:o.supplier_uid})),{data:S}=Y({queryKey:["AIRLINES_DATA"],queryFn:async()=>{var x,d;const o=await h.get("/tools/airlines-data");return(d=Object.values((x=o.data)==null?void 0:x.data))==null?void 0:d.map(c=>({label:`${c==null?void 0:c.airline_name} (${c==null?void 0:c.iata_code})`,value:c==null?void 0:c.iata_code}))}}),{data:s}=Y({queryKey:["AIRPORTS_DATA"],queryFn:async()=>{var x;return(x=(await h.get("/tools/airport-autosuggetion-data")).data)==null?void 0:x.map(d=>({label:`${d==null?void 0:d.airport_name} (${d==null?void 0:d.code})`,value:d==null?void 0:d.code}))}}),u=z(),N=()=>{u.invalidateQueries(["FLIGHT_BOOKING_DETAILS"])},w=()=>{f.fire({html:e.jsx(W,{booking_details:t,can_modify:n,airlines:S,airports:s,flight_supplier_options:g,refetchData:N}),showConfirmButton:!1,showCloseButton:!0,customClass:{popup:"w-full max-w-5xl",htmlContainer:"!m-0",closeButton:"text-red-500"}})};return e.jsxs("button",{onClick:w,className:"font-normal normal-case btn btn-outline btn-warning flex-nowrap whitespace-nowrap",children:[e.jsx(ae,{className:"text-lg"}),"Update Booking Info"]})};D.propTypes={booking_details:I.object.isRequired};const Ne=["supernsn","administrator","manager"],J=({booking_details:t})=>{var B,E,F;const{user_access_level:a}=((B=U.useState())==null?void 0:B.user_data)||{},{booking:n,general:f,partner:h,flight:g,tracking_id:S}=t||{},{system_config:s,booking_manage:u,price_view:N}=P.useState(),{online_payment_option:w}=N,{booking_auto_cancel:r,flight_confirm_cancel:m,flight_issue_ticket:o,flight_issue_ticket_reissue:j,flight_price_change_alert:x}=u||{},{axiosInstance:d}=q(),{member_id:c}=((E=U.useState())==null?void 0:E.user_data)||{},[v,_]=y.useState(!1),T=z(),A=async()=>{var p,M,V;if(!v){_(!0);try{const b=await d.post("/secure?pathName=/supplier-booking-details",{member_id:c,tracking_id:S});if(((p=b==null?void 0:b.data)==null?void 0:p.status)==="success")await T.invalidateQueries(["FLIGHT_BOOKING_DETAILS"]),L("success","Booking Details Synced",(M=b.data)==null?void 0:M.reason);else throw new Error((V=b==null?void 0:b.data)==null?void 0:V.reason)}catch(b){L("error","Sync Failed!",b.message)}finally{_(!1)}}};return e.jsxs("div",{className:"sticky p-4 rounded-lg bg-base-200 h-fit top-5",children:[e.jsx("div",{className:`mb-5 rounded card ${n.booking_status==="hold"?"bg-warning border-warning":""} ${n.booking_status==="confirm"?"bg-success border-success":""} ${n.booking_status==="cancel"?"bg-error border-error":"bg-info border-info"}`,children:e.jsxs("div",{className:"p-5 text-center card-body",children:[e.jsx("h3",{className:"mb-2 text-2xl font-semibold text-white capitalize",children:(r==null?void 0:r.toUpperCase())==="DISABLE"&&n.booking_status==="hold"?"Immediate Purchase":n.booking_status}),(r==null?void 0:r.toUpperCase())==="ACTIVE"&&((n==null?void 0:n.booking_status)==="confirm"||(n==null?void 0:n.booking_status)==="hold")&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm",children:(n==null?void 0:n.booking_status)==="hold"?"Auto Release of Bookings":"Last Update"}),e.jsx("p",{className:"text-sm",children:X(new Date(n.auto_cancel)).format(`dddd, ${s.default_date_format_print} HH:mma`)})]})]})}),(r==null?void 0:r.toUpperCase())==="ACTIVE"&&n.booking_status==="hold"&&e.jsx(Q,{auto_cancel:n.auto_cancel}),["confirm","hold"].includes(n.booking_status)&&Ne.includes(a)&&((F=g==null?void 0:g.modify)==null?void 0:F.itinerary)==="active"&&e.jsx("div",{className:"mb-5 border rounded card",children:e.jsxs("div",{className:"p-5 text-center card-body",children:[e.jsx("h5",{className:"mb-1 font-semibold",children:"Manage Flight Booking"}),e.jsxs("div",{className:"grid gap-2",children:[n.booking_status==="hold"&&e.jsx(e.Fragment,{children:(o==null?void 0:o.toUpperCase())==="ACTIVE"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{var p;return(p=document.getElementById("issue_ticket_modal"))==null?void 0:p.showModal()},className:"normal-case btn btn-outline btn-success flex-nowrap whitespace-nowrap",children:[e.jsx(R,{path:O,size:.8})," ","Issue Ticket"]}),w==="ACTIVE"&&e.jsxs("button",{onClick:()=>Z.update(p=>{p.isActive=!0}),className:"normal-case btn btn-outline btn-primary flex-nowrap whitespace-nowrap",children:[e.jsx(R,{path:O,size:.8})," ","Issue Ticket by Card"]})]})}),n.booking_status==="confirm"&&(j==null?void 0:j.toUpperCase())==="ACTIVE"&&e.jsxs("button",{onClick:()=>{var p;return(p=document.getElementById("issue_ticket_modal"))==null?void 0:p.showModal()},className:"normal-case btn btn-outline btn-success flex-nowrap whitespace-nowrap",children:[e.jsx(R,{path:O,size:.8})," ","Reissue Ticket"]}),(n.booking_status==="hold"||n.booking_status==="confirm")&&e.jsxs(e.Fragment,{children:[((m==null?void 0:m.toUpperCase())==="ACTIVE"||n.booking_status==="hold")&&e.jsxs("button",{onClick:()=>{var p;return(p=document.getElementById("cancel_flight_modal"))==null?void 0:p.showModal()},className:"normal-case btn btn-outline btn-error flex-nowrap whitespace-nowrap",children:[e.jsx(R,{path:ee,size:.8})," Cancel"," ",n.booking_status==="hold"?"Flight":"Ticket"]}),n.booking_status==="hold"&&(x==null?void 0:x.toUpperCase())==="YES"&&e.jsxs("button",{onClick:()=>{var p;return(p=document.getElementById("get_price_alert_modal"))==null?void 0:p.showModal()},className:"font-normal normal-case btn btn-outline btn-warning flex-nowrap whitespace-nowrap",children:[e.jsx(ne,{className:"text-lg"}),"Get Price Alert"]}),e.jsx("button",{onClick:A,className:"font-normal normal-case btn btn-outline btn-info flex-nowrap whitespace-nowrap",children:v?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{}),"Sync Booking Details"]})}),e.jsx(D,{booking_details:t})]})]})]})}),e.jsx(ue,{details:h}),e.jsx(de,{info:f})]})};J.propTypes={booking_details:I.object.isRequired};const $e=()=>{const{site_title:t,price_view:a}=P.useState(),{online_payment_option:n}=a||{},[f]=re(),h=f.get("tracking_id"),{user_data:{member_id:g}}=U.useState(c=>c),{axiosInstance:S}=q(),{data:s,isLoading:u,error:N,refetch:w}=Y(["FLIGHT_BOOKING_DETAILS",h,g],async()=>{var _,T,A;const c=await S.post("/booking-details",{tracking_id:h,member_id:g}),v=(T=(_=c.data)==null?void 0:_.booking)==null?void 0:T.booking_status;if(["hold","confirm","cancel","initiated"].includes(v))return c.data;throw{...c,message:((A=c.data)==null?void 0:A.reason)||"Request failed!"}});if(u)return e.jsx(se,{});if(N)throw N;const{general:{booking_id:r},booking:{booking_status:m},pax:{primary:o},flight:{modify:{itinerary:j}},special_notice_status:x,special_notice:d}=s;return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsxs("title",{children:["Flight Booking Details",t?" - "+t:""]})}),e.jsx("main",{className:"container min-h-screen pt-20 mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 gap-5 pt-2 lg:grid-cols-4",children:[e.jsx(le,{booking_details:s}),e.jsx(J,{booking_details:s})]})}),m==="hold"&&j==="active"&&e.jsxs(e.Fragment,{children:[e.jsx(he,{data:{booking_id:r,tracking_id:h},refetchBookingDetails:w}),n==="ACTIVE"&&e.jsx(xe,{data:s}),e.jsx(be,{data:{booking_id:r,tracking_id:h,guest_info:o}})]}),(m==="hold"||m==="confirm")&&j==="active"&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{data:{booking_id:r,tracking_id:h,guest_info:o}}),e.jsx(ge,{data:{booking_id:r,tracking_id:h,booking_status:m,special_notice_status:x,special_notice:d},refetchBookingDetails:w}),e.jsx(je,{data:{booking_id:r,tracking_id:h},refetchBookingDetails:w})]})]})};export{$e as default};
