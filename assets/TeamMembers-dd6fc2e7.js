import{o as A,e as m,m as C,q as e,a5 as I,ab as $,T as F}from"./index-5c0e37d6.js";import{d as D,e as B,p as H,L as M,c as R,ad as K}from"./App-1de86f53.js";const Q=["supernsn","administrator","manager","report"],z=["supernsn","administrator"],G=({email:h})=>{const[n,j]=m.useState(!1),{axiosInstance:l}=D(),y=async a=>{var r,p,u;if(n)return;j(!0);const x=window.location.origin;try{const o={random_key:$().slice(0,8),email:a,password_reset_url:`${x}/reset-password`},d=await l.post("/user/password-reset",o);if(((r=d.data)==null?void 0:r.status)==="success")F("success","Success",(p=d.data)==null?void 0:p.reason);else throw new Error(((u=d.data)==null?void 0:u.reason)||"Something went wrong")}catch(o){F("error","Failed!",o.message)}finally{j(!1)}};return e.jsx("button",{type:"button",onClick:()=>y(h),className:R("text-white normal-case rounded btn btn-warning btn-xs",n?"btn-outline":""),children:n?"Processing...":"Send Password"})},V=()=>{var E,k;const{site_title:h,component_version:n}=A.useState(),{axiosInstance:j}=D(),[l,y]=m.useState([]),[a,x]=m.useState(1),[r,p]=m.useState(""),[u,o]=m.useState(0),{user_data:{login_key:d,member_id:L,email:P}}=C.useState(),{data:w,isLoading:U,error:T}=B({queryKey:["TEAM_MEMBERS",d,L],queryFn:async()=>{const s=await j.post("/user/team-members",{login_key:d,member_id:L});return o(Math.ceil(s.data.length/10)),s.data}});m.useEffect(()=>{var f;if(!w)return;const s=[],i=(f=r==null?void 0:r.toLowerCase())==null?void 0:f.trim();w.forEach(t=>{var c,g,b,N;((g=(c=t==null?void 0:t.fullname)==null?void 0:c.toLowerCase())!=null&&g.includes(i)||(N=(b=t==null?void 0:t.email)==null?void 0:b.toLowerCase())!=null&&N.includes(i)||((t==null?void 0:t.isd_code)+(t==null?void 0:t.mobile)).includes(i))&&s.push(t)}),o(Math.ceil(s.length/10));const S=s.slice((a-1)*10,(a-1)*10+10);y(S)},[w,a,r]);const q=s=>{s.preventDefault();const i=s.target.search.value;x(1),p(i)},{user_access_level:v}=((E=C.useState())==null?void 0:E.user_data)||{};if(T)throw T;const _=(k=n==null?void 0:n.general)==null?void 0:k.team;return e.jsxs(e.Fragment,{children:[e.jsx(I,{children:e.jsxs("title",{children:[_==="2"?"Team Members":"Users List"," Team Members",h?" - "+h:""]})}),e.jsx("div",{className:"mb-8 sm:col-span-3 lg:col-span-4",children:U?e.jsxs("div",{className:"flex items-center justify-center h-full gap-2 text-xl",children:[e.jsx(K,{className:"mr-2 animate-spin text-primary"})," ","Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col justify-between gap-4 mb-5 md:items-center md:flex-row",children:[e.jsxs("div",{className:"py-3",children:[e.jsx("h3",{className:"text-lg font-medium",children:_==="2"?"Team Members":"Users List"}),e.jsx("p",{className:"text-sm text-neutral",children:"Reset team member password or update profile"})]}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("form",{onSubmit:q,className:"rounded join focus-within:ring-1 ring-primary",children:[e.jsx("input",{autoComplete:"off",type:"text",name:"search",placeholder:"Type name/email/phone number",className:"h-10 min-h-0 text-sm bg-transparent rounded join-item input input-bordered focus:outline-0"}),e.jsx("button",{type:"submit",className:"h-10 min-h-0 rounded join-item btn btn-primary",children:e.jsx(H,{})})]}),["supernsn","administrator"].includes(v)&&e.jsxs(M,{to:"/settings/create-member",className:"h-10 normal-case rounded btn btn-primary btn-outline min-h-8",children:["Add New ",_==="2"?"Member":"User"]})]})]}),e.jsxs("div",{className:"overflow-auto",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table text-center team",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border",children:"Sl"}),e.jsx("th",{className:"border",children:"User Details"}),e.jsx("th",{className:"border",children:"Login Email"}),e.jsx("th",{className:"border",children:"Action"})]})}),e.jsx("tbody",{children:(l==null?void 0:l.length)>0?l.map((s,i)=>{const{created_timestamp:S,user_pic:f,status:t,email:c,fullname:g,user_access_level_title:b,team_member_id:N}=s;return e.jsxs("tr",{children:[e.jsx("td",{children:(a-1)*10+i+1}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"avatar",children:e.jsx("div",{className:"w-12 h-12 mask mask-squircle",children:e.jsx("img",{src:f,alt:""})})}),e.jsxs("div",{className:"text-start",children:[e.jsx("p",{className:"text-sm",children:g}),e.jsx("p",{className:"text-xs",children:b})]})]})}),e.jsxs("td",{className:"text-start",children:[e.jsx("p",{children:c}),e.jsx("div",{className:R("badge text-white text-[10px] badge-xs rounded",t==="active"?"badge-success":"badge-warning"),children:t})]}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-center gap-3",children:[P!==c&&Q.includes(v)&&e.jsx(G,{email:c}),P===c?e.jsx(M,{to:"/user/profile",className:"text-white normal-case rounded btn btn-error btn-xs",children:"Update"}):z.includes(v)?e.jsx(M,{to:`/settings/team/${N}`,className:"text-white normal-case rounded btn btn-primary btn-xs",children:"Modify"}):null]})})]},S)}):e.jsx("tr",{children:e.jsx("td",{className:"py-5 text-center text-error",colSpan:"100%",children:"No Data"})})})]})}),e.jsx("div",{className:"flex justify-center mt-5",children:e.jsxs("div",{className:"rounded join",children:[e.jsx("button",{onClick:()=>{x(s=>s>1?s-1:s)},className:`h-10 min-h-0 join-item btn btn-primary ${a===1?"pointer-events-none text-primary-content/50 hover:text-primary-content/50":""}`,children:"«"}),e.jsxs("div",{className:"flex items-center justify-center h-10 px-4 text-sm border border-primary bg-base-200 join-item",children:["Page ",a]}),e.jsx("button",{onClick:()=>{x(s=>s<u?s+1:s)},className:`h-10 min-h-0 join-item btn btn-primary ${a>=u?"pointer-events-none text-primary-content/50 hover:text-primary-content/50":""}`,children:"»"})]})})]})]})})]})};export{V as default};
