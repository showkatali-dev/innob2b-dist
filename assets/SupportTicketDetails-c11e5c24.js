import{m as R,e as I,u as H,q as e,T as A,o as U,a5 as D}from"./index-adb6807e.js";import{P,d as C,V as O,aL as V,e as K,d9 as Q,db as E,c$ as z,ad as M}from"./App-2ee69fad.js";import{S as W}from"./SupportTicketSidebar-f9e4a8ed.js";const F=({ticket_details:f,setAddSupportTicketNote:l})=>{const{ticket_status:r,ticket_id:c}=f||{},{user_data:{member_id:o}}=R.useState(),{axiosInstance:d}=C(),[t,j]=I.useState(!1),b=H(),v=async g=>{var k,u,x,p,a;if(g.preventDefault(),t)return;j(!0);const m=g.target,N=m.attachment_file.files[0],w=await new Promise(s=>{N||s(null);const n=new FileReader;n.readAsDataURL(N),n.onload=async()=>{var y,_;try{const i=n.result,h=i.match(/^data:image\/([^;]+)/),L=h?h[1]:null,q=i.replace(/^data:image\/[^;]+;base64,/,""),T=await d.post("/tools/upload-base64-file",{image_type:"data",category:"support-ticket",fileExtension:L,documents_image_url:q,member_id:o});((y=T.data)==null?void 0:y.status)==="success"?s((_=T.data)==null?void 0:_.ObjectURL):s(null)}catch(i){console.error(i),s(null)}}}),S={member_id:o,ticket_id:c,ticket_status:m.ticket_status.value,attachment_link:w,notes:m.notes.value};try{const s=await d.post("/support-ticket/reply",S);if(l(!1),((k=s.data)==null?void 0:k.status)==="success")A("success","Reply Sent!",(u=s==null?void 0:s.data)==null?void 0:u.reason),b.invalidateQueries(["SUPPORT_TICKET_DETAILS",o,c]);else throw new Error(((x=s.data)==null?void 0:x.reason)||"Something wrong!")}catch(s){A("error","Error!",(a=(p=s==null?void 0:s.response)==null?void 0:p.data)==null?void 0:a.reason)}finally{j(!1)}};return e.jsxs("form",{onSubmit:v,className:"flex gap-4 p-3 mb-8 border rounded-md border-primary",children:[e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{name:"notes",className:"w-full h-full p-0 bg-transparent rounded min-h-16 textarea focus:outline-0",placeholder:"Write a note..."})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"gap-1 form-control",children:[e.jsx("label",{className:"text-sm font-medium",children:"Ticket Status"}),e.jsxs("select",{className:"w-full bg-transparent rounded select select-sm select-bordered select-primary focus:outline-0",name:"ticket_status",defaultValue:r,children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"hold",children:"Hold"}),e.jsx("option",{value:"close",children:"Close"})]})]}),e.jsxs("div",{className:"gap-1 form-control",children:[e.jsx("label",{className:"text-sm font-medium",children:"Attachment"}),e.jsx("input",{autoComplete:"off",className:"w-full bg-transparent rounded file-input file-input-sm file-input-bordered file-input-ghost focus:outline-0",type:"file",accept:"image/*",name:"attachment_file"})]}),e.jsx("button",{type:"submit",className:"w-40 ml-auto tracking-wider normal-case rounded-md btn-sm btn btn-primary",children:t?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"animate-spin"})," Processing..."]}):e.jsx(e.Fragment,{children:"Update Ticket"})})]})]})};F.propTypes={ticket_details:P.object.isRequired,setAddSupportTicketNote:P.func.isRequired};const J=()=>{var u,x,p;const{site_title:f}=U.useState(),{ticket_id:l}=V(),[r,c]=I.useState(!1),{axiosInstance:o}=C(),{member_id:d}=((u=R.useState())==null?void 0:u.user_data)||{},{data:t,isLoading:j,error:b}=K({queryKey:["SUPPORT_TICKET_DETAILS",d,l],queryFn:async()=>{var s,n;const a=await o.post("/support-ticket/details",{member_id:d,ticket_id:l});if(((s=a.data)==null?void 0:s.status)==="success")return a.data;throw{...a,message:((n=a.data)==null?void 0:n.reason)||"Request failed!"}}});if(b)throw b;const{fullname:v,email:g,phone:m,category:N,ticket_status:w,support_message:S,attachment_link:k}=(t==null?void 0:t.summery)||{};return e.jsx(e.Fragment,{children:e.jsxs("main",{className:"container min-h-screen pt-20",children:[e.jsx(D,{children:e.jsxs("title",{children:["Support Ticket - ",l,f?" - "+f:""]})}),e.jsx("h1",{className:"mb-5 text-3xl font-semibold",children:"Support Ticket"}),e.jsx("hr",{className:"border-neutral/20"}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-4 lg:grid-cols-5",children:[e.jsx(W,{}),e.jsx("div",{className:"sm:col-span-3 lg:col-span-4",children:j?e.jsxs("div",{className:"flex items-center justify-center h-full gap-2 text-xl",children:[e.jsx(M,{className:"mr-2 animate-spin text-primary"})," ","Loading..."]}):e.jsxs("div",{className:"p-4 rounded-lg bg-base-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("h5",{className:"text-xl font-semibold",children:[e.jsx(Q,{})," Ticket ID - ",l]}),e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[e.jsxs("div",{className:"text-xs",children:[e.jsxs("p",{className:"capitalize",children:["Category: ",N]}),e.jsxs("p",{className:"text-base font-semibold capitalize",children:["Ticket Status: ",w]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("a",{href:k,target:"_blank",rel:"noreferrer",className:"tracking-wider text-white normal-case rounded-md shadow btn-sm btn btn-info",children:[e.jsx(E,{})," View Attachment"]}),e.jsx("button",{onClick:()=>c(!r),className:"tracking-wider normal-case rounded-md shadow btn-sm btn btn-primary",children:r?"Cancel":e.jsxs(e.Fragment,{children:[e.jsx(z,{})," Add Note"]})})]})]})]}),r&&e.jsx(F,{ticket_details:(t==null?void 0:t.summery)||{},setAddSupportTicketNote:c}),e.jsxs("div",{className:"flex gap-4 p-3 mb-8 border rounded-md",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{children:S})}),e.jsxs("div",{className:"p-3 rounded-md bg-base-100",children:[e.jsx("h6",{className:"mb-1 font-semibold text-primary",children:"Ticket by"}),e.jsx("p",{className:"mb-1 text-sm font-semibold",children:v}),e.jsx("div",{className:"text-xs",children:e.jsxs("div",{className:"text-xs",children:[e.jsxs("p",{children:["Email: ",g]}),e.jsxs("p",{children:["Phone Number: ",m]})]})})]})]}),e.jsxs("h3",{className:"mb-3 text-lg font-semibold",children:[((x=t==null?void 0:t.data)==null?void 0:x.length)||0," Answers"]}),e.jsx("div",{className:"flex flex-col gap-4",children:(p=t==null?void 0:t.data)==null?void 0:p.map(a=>{const{Id:s,fullname:n,email:y,phone:_,notes:i,attachment_link:h}=a||{};return e.jsxs("div",{className:"flex gap-4 p-3 mb-8 border rounded-md",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{children:i})}),e.jsxs("div",{className:"p-3 rounded-md bg-base-100",children:[e.jsx("h6",{className:"mb-1 font-semibold text-primary",children:"Reply by"}),e.jsx("p",{className:"mb-1 text-sm font-semibold",children:n}),e.jsx("div",{className:"text-xs",children:e.jsxs("div",{className:"text-xs",children:[e.jsxs("p",{children:["Email: ",y]}),e.jsxs("p",{children:["Phone Number: ",_]})]})}),h&&e.jsxs("a",{href:h,target:"_blank",rel:"noreferrer",className:"tracking-wider normal-case rounded btn btn-link btn-xs",children:[e.jsx(E,{})," View Attachment"]})]})]},s)})})]})})]})]})})};export{J as default};
