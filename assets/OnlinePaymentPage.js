import{m as S,e as f,o as e,X as Q,Y as D,Q as k,l as W,I as X,b5 as K,a4 as B}from"./index.js";import{b as G,cu as L,c as J,r as P,p as U,T as Z,aa as O,F as ee}from"./App.js";import{P as te}from"./PhoneNumberSelect.js";import{I as se}from"./InputDateWithTime.js";import"./shortcut-buttons-flatpickr.min.js";const ae=({pay_tracking_id:u})=>{var o;const{site_title:y}=S.useState(),{checkout_url:_}=((o=S.useState())==null?void 0:o.system_config)||{},[s,g]=f.useState(null),[a,x]=f.useState(!1),{data:m,isLoading:N}=G({queryKey:["PAYMENT_INFO",u],queryFn:async()=>{var r;const l=await P.post(`${_}/review`,{pay_tracking_id:u});return g(((r=l.data)==null?void 0:r.payment_option[0])||null),l.data}}),v=async()=>{var l,r;if(!a){x(!0);try{const i={pay_tracking_id:u,gateway_partner_code:s==null?void 0:s.gateway_partner_code},d=await P.post(`${_}/pay`,i);if(((l=d.data)==null?void 0:l.status)==="success")window.location.replace((r=d.data)==null?void 0:r.gateway_redirect_url);else throw new Error("Failed to process payment")}catch(i){console.error(i),k("error","Error",i==null?void 0:i.message)}finally{x(!1)}}};if(N)return e.jsx(Q,{});if((m==null?void 0:m.status)!=="success")return e.jsx(L,{to:"/online-payment"});const{payment_option:b}=m||{},{amount:j,currency:h,charges:c,payable:n}=(s==null?void 0:s.gateway)||{};return e.jsxs("main",{className:"container min-h-screen pt-20",children:[e.jsx(D,{children:e.jsxs("title",{children:["Payment",y?" - "+y:""]})}),e.jsxs("div",{className:"w-full pt-2",children:[e.jsx("h3",{className:"pb-2 text-lg font-semibold",children:"Review Payment"}),e.jsx("hr",{className:"mb-4"}),e.jsxs("div",{className:"grid gap-5 overflow-hidden border rounded-lg sm:grid-cols-2 text-start",children:[e.jsx("div",{className:"p-5 bg-primary text-primary-content",children:e.jsxs("div",{children:[e.jsx("h1",{children:"Summary of Payment"}),e.jsxs("ul",{className:"pl-3 mt-4 text-sm leading-relaxed list-disc list-inside list text-primary-content/80",children:[e.jsxs("li",{className:"capitalize",children:["Payment Option: ",s==null?void 0:s.gateway_name]}),e.jsxs("li",{children:["Amount: ",j," ",h]}),e.jsxs("li",{children:["Fixed Charge: ",c==null?void 0:c.fixed_charge," ",h]}),e.jsxs("li",{children:["Service Fee: ",c==null?void 0:c.service_fee," ",h]}),e.jsxs("li",{children:["Total Payable: ",n," ",h]})]})]})}),e.jsxs("div",{className:"p-5 text-start",children:[e.jsx("h2",{className:"mb-2 text-lg font-semibold",children:"Select Payment Option"}),e.jsx("div",{className:"grid grid-cols-2 gap-5",children:b==null?void 0:b.map(l=>{const{gateway_name:r,gateway_code:i}=l||{};return e.jsxs("div",{onClick:()=>g(l),className:J("capitalize flex justify-center items-center rounded w-full ring-base-content/20 h-16 ring-[1px] !border-l-8 border-2 border-transparent cursor-pointer text-lg font-bold text-primary gap-1",(s==null?void 0:s.gateway_name)===r&&"border-warning ring-0"),children:[e.jsx("img",{src:i==="stripe"?"/stripe_logo.webp":"/bkash_logo.png",alt:"",className:"w-8"})," ",e.jsx("span",{children:r})]},i)})}),e.jsx("div",{className:"flex justify-end mt-12",children:e.jsx("button",{onClick:v,className:"h-10 min-h-0 text-base font-normal normal-case rounded btn btn-primary",children:a?"Processing...":"Pay Now"})})]})]})]})]})},ce=()=>{var C;const{site_title:u,system_config:y}=S.useState(),{checkout_url:_}=y||{},[s,g]=f.useState(!1),[a,x]=f.useState(null),{member_id:m,fullname:N,email:v,partner_id:b,default_currency:j,isd_code:h,mobile:c}=((C=W.useState())==null?void 0:C.user_data)||{},[n,o]=f.useState({isd_code:h,contact_number:c,service_details:"",name:N,email:v,amount:"",payment_link_valid:""}),[l]=U(),r=l.get("pay_tracking_id"),i=async t=>{var E,q,I;if(t.preventDefault(),s)return;g(!0),x(null);const{name:$,email:A,isd_code:M,contact_number:V,amount:z,service_details:R,payment_link_valid:F}=n,{origin:w}=location,Y={name:$,email:A,member_id:m,isd_code:M,contact_number:V,ftm_partner_id:b,service_details:R,payment_type:"amount",amount:z,currency:j,payment_link_valid:F,collection_type:"payment_link",tracking_id:B().slice(0,8),payment_link_base_url:w+"/online-payment",redirect_url:w+"/online-payment/status"};try{const p=await P.post(`${_}/request`,Y);if(((E=p.data)==null?void 0:E.status)==="success"){const{pay_tracking_id:H}=p.data;x({payment_link:`${w}/online-payment?pay_tracking_id=${H}`,pay_link_valid:F,message:(q=p.data)==null?void 0:q.reason})}else k("error","Sending Failed!",(I=p.data)==null?void 0:I.reason)}catch(p){k("error","Sending Failed!",p.message)}finally{g(!1)}};let{pathname:d,search:T}=Z();return d=d.endsWith("/")?d.slice(0,-1):d,r?e.jsx(ae,{pay_tracking_id:r}):m?e.jsxs("main",{className:"container min-h-screen pt-20",children:[e.jsx(D,{children:e.jsxs("title",{children:["Payment",u?" - "+u:""]})}),e.jsxs("form",{onSubmit:i,className:"w-full pt-2",children:[e.jsx("h3",{className:"pb-2 text-lg font-semibold",children:"Send Payment Link"}),e.jsx("hr",{className:"mb-4"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-y-4 gap-x-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Enter your name."}),e.jsx("input",{autoComplete:"off",type:"text",name:"name",className:"w-full h-10 text-sm rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30 ",value:n.name,onChange:t=>o({...n,name:t.target.value}),required:!0,placeholder:"Name"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Enter Your Email"}),e.jsx("input",{autoComplete:"off",type:"text",name:"receiver_id",className:"w-full h-10 text-sm rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30 ",value:n.email,onChange:t=>o({...n,email:t.target.value}),required:!0,placeholder:"Email"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Mobile"}),e.jsx(te,{placeholder:"Enter Mobile Number",className:"!h-10 !text-sm !bg-transparent !rounded input !input-bordered focus:outline-0 min-h-8 !w-full",defaultValue:String(n.isd_code||"")+String(n.contact_number||""),action:t=>o({...n,isd_code:t==null?void 0:t.isd_code,contact_number:t==null?void 0:t.mobile})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Input Amount."}),e.jsxs("div",{className:"w-full join",children:[e.jsx("span",{className:"flex items-center px-4 border rounded-l bg-neutral/10 text-neutral join-item border-neutral/20",children:j}),e.jsx("input",{autoComplete:"off",type:"text",name:"amount",className:"flex-1 w-full h-10 text-sm rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30 hide_arrow_key join-item",value:n.amount||"",onChange:t=>o({...n,amount:t.target.value}),required:!0,placeholder:"Amount"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Service Details."}),e.jsx("textarea",{type:"text",name:"service_details",className:"w-full text-sm rounded textarea textarea-bordered min-h-16 focus:outline-0 focus:border-neutral/30",required:!0,value:n.service_details||"",onChange:t=>o({...n,service_details:t.target.value}),placeholder:"Service Details",maxLength:249})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral",children:"Input Validity."}),e.jsx(se,{name:"payment_link_valid",action:t=>o({...n,payment_link_valid:t}),defaultValue:n.payment_link_valid,minDate:"today",className:"w-full h-10 text-sm rounded input input-bordered min-h-8 focus:outline-0 focus:border-neutral/30",required:!0,placeholder:"Valid till"})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{type:"submit",className:`normal-case btn btn-primary rounded-md min-w-[160px] shadow shadow-primary/30 min-h-0 h-10 ${s?"pointer-events-none":""}`,children:s?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"mr-2 animate-spin"})," Processing..."]}):"Send"})})]}),a&&e.jsxs("div",{className:"relative flex items-center gap-4 p-4 mt-8 border rounded-lg border-success bg-success/10 text-success",children:[e.jsx("button",{onClick:()=>x(null),className:"absolute top-1 right-1 btn btn-ghost btn-circle btn-sm",children:e.jsx(ee,{})}),e.jsx("button",{onClick:t=>{navigator.clipboard.writeText(a==null?void 0:a.payment_link),t.target.textContent="Copied",setTimeout(()=>t.target.textContent="Copy",2e3)},className:"absolute font-normal normal-case bottom-1 right-2 !glass btn btn-ghost btn-xs text-primary/70 hover:text-primary",children:"Copy link"}),e.jsx(X,{path:K,size:1,className:"text-xl"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:a==null?void 0:a.message}),e.jsxs("p",{children:["Payment link:"," ",e.jsx("a",{href:a==null?void 0:a.payment_link,target:"_blank",rel:"noreferrer",children:a==null?void 0:a.payment_link}),"."]})]})]})]}):e.jsx(L,{to:"/login",replace:!0,state:{pathname:d+T}})};export{ce as default};
