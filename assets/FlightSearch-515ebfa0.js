import{q as e,P as se,o as De,H as ke,al as he,m as pa,e as B,ac as ja,a0 as Oe,am as P,a1 as ya,T as ga,an as Ae,a5 as va}from"./index-5b04c002.js";import{b as Sa,c as Na,d as wa}from"./index.esm-737ce12a.js";import{P as q,u as Be,h as Fa,i as Ma,c as Ye,d as ua,e as _a,j as xa,k as Ca,l as ka,m as Oa,n as Da,o as Aa,r as Ya,p as Ba,q as Ea,b as Ta}from"./App-94c4b974.js";import{F as $a,G as Ia,a as qa,b as Pa,c as Ha,d as Wa,S as za,e as La,f as Ja,A as Qa,g as Va,h as ia,i as oa,j as Ga,k as Ka,l as Ua,m as Xa}from"./Searchbox3-683ed3bd.js";import{F as Za,Q as Ra}from"./index-7ce34572.js";import{S as la,F as er,a as ar}from"./SearchboxSkeleton-693c05c8.js";import{D as rr,a as tr,b as sr}from"./drawer-1fd21456.js";import{S as da}from"./SingleSelect-28827d9a.js";import{f as nr,M as ir}from"./navigation-f473d6fa.js";import{S as or,N as lr,a as dr}from"./navigation-272d5ed6.js";import"./Checkbox-129b4780.js";import"./RangeSliderInput-3d8ccc66.js";import"./SuppliersSelection2-d5da592a.js";import"./MultipleFlight2-870da493.js";import"./FlightItineraryData-f4389036.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./sweetalert2-react-content.es-8e626fa1.js";import"./SearchOption-19826379.js";import"./InputDate-6167b1db.js";import"./index-4816f85e.js";import"./PrimaryTabsWithIcon-709f4d4a.js";import"./index.esm-2088f1a1.js";const ma=({departure_date:c,journey_type:l})=>{const{t:o}=Be();return e.jsxs("div",{className:`grid ${l==="OneWay"?"grid-cols-7":"grid-cols-8"}`,children:[l==="RoundTrip"&&e.jsxs("div",{className:"bg-neutral/10 text-[13px] font-medium py-1 flex flex-col justify-center items-center border-r-2 border-r-base-200",children:[e.jsxs("div",{className:"flex items-start gap-1 pl-5",children:[e.jsx("h3",{className:"font-semibold text-[11px]",children:o("Depart")}),e.jsx("span",{children:e.jsx(Fa,{})})]}),e.jsxs("div",{className:"flex items-end gap-1 pr-5",children:[e.jsx("span",{children:e.jsx(Ma,{})}),e.jsx("h3",{className:"font-semibold text-[11px]",children:o("Return")})]})]}),[...Array(7)].map((x,i)=>e.jsx("div",{className:"bg-neutral/10 text-[13px] font-medium py-2 justify-center flex h-full items-center border-x-2 border-x-base-200 last:border-r-0 px-2",children:e.jsx("p",{children:se(c).add(i,"days").format("ddd, MMM DD YYYY")})},i))]})};ma.propTypes={departure_date:q.string,journey_type:q.string};const fa=({data:c,journey_type:l,departure_date:o,arrival_date:x,best_fare:i,setFlight:v,flight:b,setCalendarSearch:w,calendarSearch:M})=>{const{first_best_fare:E,second_best_fare:D,third_best_fare:N}=i||{},{supplier_option:p}=De.useState(),h=p==null?void 0:p.data;return e.jsx("div",{className:`grid gap-x-1 ${l==="OneWay"?"grid-cols-7":"grid-cols-8"}`,children:c==null?void 0:c.map((s,m)=>{var H;if(s===null)return e.jsx("div",{className:"py-2",children:e.jsx("div",{className:"flex w-full h-full py-1 rounded-lg bg-base-200 min-h-[34px]"})},m);if((s==null?void 0:s.data_type)==="date")return s.date?e.jsx("div",{className:"flex items-center justify-center bg-neutral/10 border-y-4 border-y-base-200",children:e.jsx("div",{className:"text-[13px] font-medium py-2",children:e.jsx("p",{children:s.date?se(s==null?void 0:s.date).format("ddd, MMM DD YYYY"):"One Way"})})},m):null;{const S=h==null?void 0:h.find(C=>{var R,G;return(C==null?void 0:C.supplier_uid)===((G=(R=s==null?void 0:s.flight_key)==null?void 0:R.split("-"))==null?void 0:G.at(0))}),u=s.calendar_flight_date===(o==null?void 0:o.at(0))&&(s.calendar_arrival_date===x||l==="OneWay");return e.jsx("div",{className:"py-2",children:e.jsx("div",{onClick:()=>{v(s),w(!0)},className:Ye("flex flex-col items-center justify-center w-full py-1 rounded-sm text-[13px] cursor-pointer border-2 hover:border-primary min-h-[34px]",u&&!M||M&&(b==null?void 0:b.flight_key)===(s==null?void 0:s.flight_key)?"border-primary":"border-transparent",(s==null?void 0:s.calendar_total_sell)===E?"bg-secondary/30":(s==null?void 0:s.calendar_total_sell)===D?"bg-success/30":(s==null?void 0:s.calendar_total_sell)===N?"bg-warning/30":"bg-base-100"),children:e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("img",{src:S==null?void 0:S.logo,alt:S==null?void 0:S.title,className:"w-5 h-5 p-0.5 rounded-full border border-primary"}),e.jsxs("h6",{children:[ke(s==null?void 0:s.calendar_total_currency)," ",(H=s==null?void 0:s.calendar_total_sell)==null?void 0:H.toLocaleString()]}),e.jsx("img",{src:`https://gtrs-airlineimages.s3.ap-southeast-1.amazonaws.com/icon/${s.calendar_carrier}.png`,alt:"",className:"h-6"})]})})},m)}})})};fa.propTypes={data:q.array,journey_type:q.string,departure_date:q.string,arrival_date:q.string};const cr=({setCalendarSearch:c=()=>{}})=>e.jsx("button",{onClick:()=>{he.update(l=>{l.price_calendar.isActive=!1}),c(!1)},className:"absolute z-10 flex items-center justify-center text-sm text-white rounded-full w-7 h-7 bg-red-400/50 hover:bg-red-400 -top-2 -right-2",children:e.jsx(Sa,{})}),ha=({search_parameter:c,calendarSearch:l,setCalendarSearch:o,isCalenderSearch:x})=>{var ne,je,ae;const{t:i}=Be(),{system_config:v,supplier_option:b,price_view:{show_flight_fare_rules:w,show_fare_summery:M}={}}=De.useState(),{search_result_version:E}=v||{},{show_supplier_option:D}=b||{},{user_data:N}=pa.useState(),{departure_date:p,arrival_date:h,...s}=c||{},{isActive:m}=he.useState(a=>a.price_calendar),{axiosInstance:H}=ua(),{isLoading:S,data:u={}}=_a({queryKey:["CALENDER_SEARCH",s,p,h],enabled:!!p&&!!s,queryFn:async()=>{var y,T,ie,oe,ye,le,de,ce,pe;const a=await H.post("/flight/search-calender",{member_id:"1",...s,departure_date:p,arrival_date:h,calendar_days:"7"});if(((y=a.data)==null?void 0:y.status)==="success"){const ue=(oe=(ie=(T=a.data)==null?void 0:T.data)==null?void 0:ie.at(0))==null?void 0:oe.calendar_flight_date,_e=(de=(le=(ye=a.data)==null?void 0:ye.data)==null?void 0:le.at(0))==null?void 0:de.calendar_arrival_date,{journey_type:re}=a.data,K=[...Array(re==="RoundTrip"?56:8)].map((k,A)=>{var xe,me;if((A+1)%8===1)return{data_type:"date",date:re==="RoundTrip"?se(_e).add(A/8+A%8,"days").format("YYYY-MM-DD"):null};{const ge=se(ue).add((A-1)%8,"days").format("YYYY-MM-DD"),ve=se(_e).add(Math.floor((A-1)/8),"days").format("YYYY-MM-DD");return((me=(xe=a.data)==null?void 0:xe.data)==null?void 0:me.find(fe=>fe.calendar_flight_date===ge&&(fe.calendar_arrival_date===ve||re==="OneWay")))||null}}),F=[...new Set((pe=(ce=K==null?void 0:K.map(k=>k==null?void 0:k.calendar_total_sell))==null?void 0:ce.filter(k=>!!k))==null?void 0:pe.sort((k,A)=>k-A))];return{departure_date:ue,new_data:K,first_best_fare:(F==null?void 0:F.at(0))||0,second_best_fare:(F==null?void 0:F.at(1))||0,third_best_fare:(F==null?void 0:F.at(2))||0}}}}),{first_best_fare:C,second_best_fare:R,third_best_fare:G}=u||{};B.useEffect(()=>{var a;m&&!S&&!(((a=u==null?void 0:u.new_data)==null?void 0:a.length)>0)&&(ja.error("No data found"),he.update(y=>{y.price_calendar.isActive=!1}))},[S,m,(ne=u==null?void 0:u.new_data)==null?void 0:ne.length]);const[j,be]=B.useState(null);if(!S&&!(((je=u==null?void 0:u.new_data)==null?void 0:je.length)>0))return null;const ee=async a=>{var y;await Oe.update(T=>{T.segment[0].departure_date=a.calendar_flight_date,T.segment[0].arrival_date=a.calendar_arrival_date,T.search_option="standard"}),(y=document.getElementById("flight_search_button"))==null||y.click()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`mb-4 rounded-2xl max-sm:hidden ${m||l?"block":"hidden"}`,children:e.jsxs("div",{className:"relative border rounded-lg shadow-md bg-base-200",children:[!x&&e.jsx(cr,{setCalendarSearch:o}),((ae=u==null?void 0:u.new_data)==null?void 0:ae.length)>0&&e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("div",{className:"flex items-center justify-center py-1 rounded text-[13px] cursor-pointer min-h-[34px] w-fit font-medium",children:i("Legend")}),e.jsx("div",{className:"flex items-center justify-center py-1 text-[13px] cursor-pointer min-h-[34px] w-fit font-medium px-4 rounded-sm bg-secondary/30",children:i("first_best_fare")}),e.jsx("div",{className:"flex items-center justify-center py-1 text-[13px] cursor-pointer min-h-[34px] w-fit font-medium px-4 rounded-sm bg-success/30",children:i("second_best_fare")}),e.jsx("div",{className:"flex items-center justify-center py-1 text-[13px] cursor-pointer min-h-[34px] w-fit font-medium px-4 rounded-sm bg-warning/30",children:i("third_best_fare")})]}),e.jsxs("div",{className:"grid overflow-hidden text-center rounded-t-lg",children:[e.jsx(ma,{departure_date:u==null?void 0:u.departure_date,journey_type:s==null?void 0:s.journey_type}),e.jsx(fa,{data:(u==null?void 0:u.new_data)||[],journey_type:s==null?void 0:s.journey_type,departure_date:p,arrival_date:h,calendarSearch:l,setFlight:be,setCalendarSearch:o,flight:j,best_fare:{first_best_fare:C,second_best_fare:R,third_best_fare:G}})]})]}),S&&e.jsx($a,{})]})}),j&&l&&e.jsxs("div",{className:"mt-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h1",{className:"text-lg font-semibold",children:se(j==null?void 0:j.calendar_flight_date).format("ddd, MMM DD YYYY")}),e.jsxs("button",{onClick:()=>ee(j),className:"normal-case rounded shadow-sm btn-primary btn-sm shadow-primary/50",children:["View All Flights ",e.jsx(xa,{})]})]}),(j==null?void 0:j.result_type)==="group"?e.jsx(Ia,{flight:j},j.flight_key):e.jsx(qa,{flight:j},j.flight_key),["1","4","5","7"].includes(E)&&e.jsx(Pa,{}),e.jsx(Ha,{}),M==="YES"&&e.jsx(Wa,{}),w==="YES"&&e.jsx(Za,{}),(N==null?void 0:N.login_key)&&e.jsx(Ra,{}),e.jsx(za,{}),e.jsx(La,{}),e.jsx(Ja,{}),e.jsx(Qa,{}),["supernsn","administrator"].includes(N==null?void 0:N.user_access_level)&&D==="YES"&&e.jsx(Va,{})]})]})};ha.propTypes={search_parameter:q.object};const ca=c=>{if(isNaN(c)||c<0)return"Invalid input";const l=Math.floor(c/3600),o=Math.floor(c%3600/60),x=c%60;return`${l.toString().padStart(2,"0")}H, ${o.toString().padStart(2,"0")}M, ${x.toString().padStart(2,"0")}S`},ba=({filterData:c})=>{var D,N;const l=Oe.useState(),[o,x]=B.useState(null);B.useEffect(()=>{var p,h;o||!((h=(p=l.segment)==null?void 0:p.at(0))!=null&&h.departure_airport)||x(l)},[l,o]);const{general:i}=De.useState(p=>p.component_version)||{},{sortBy:v}=P.useState(p=>p.sorting),{cheapest_flight:b,fastest_flight:w,currency:M}=c,E=()=>{const p=localStorage.getItem("__sfs"),h=JSON.parse(p)||[];h.some(s=>JSON.stringify(s)===JSON.stringify(o))===!1&&(h.unshift(o),localStorage.setItem("__sfs",JSON.stringify(h)),ya.update(()=>h),ga("success","Success","Added to favorite"))};return e.jsxs("div",{className:Ye("flex items-center justify-between mb-4 overflow-auto rounded shadow-custom2 bg-base-200 hide_scrollbar",(i==null?void 0:i.dashboard)!=="3"&&"px-4"),children:[e.jsxs("ul",{className:Ye("flex items-end justify-start flex-1 gap-3 text-start flightResultSorting whitespace-nowrap",(i==null?void 0:i.dashboard)!=="3"&&"justify-center text-center"),children:[e.jsxs("li",{onClick:()=>P.update(p=>{p.sorting.sortBy="cheapest"}),className:`px-4 py-3 border-b-4 border-transparent cursor-pointer group ${v==="cheapest"?"active":""}`,children:[e.jsx("h6",{className:"font-medium",children:"Cheapest"}),e.jsxs("p",{className:"text-xs text-neutral/70 max-sm:hidden",children:["From ",ke(M)," ",(D=b==null?void 0:b.total_price)==null?void 0:D.toFixed(2)," •"," ",ca(b.duration_seconds)]})]}),e.jsxs("li",{onClick:()=>P.update(p=>{p.sorting.sortBy="fastest"}),className:`px-4 py-3 border-b-4 border-transparent cursor-pointer group ${v==="fastest"?"active":""}`,children:[e.jsx("h6",{className:"font-medium",children:"Fastest"}),e.jsxs("p",{className:"text-xs text-neutral/70 max-sm:hidden",children:["From ",ke(M)," ",(N=w==null?void 0:w.total_price)==null?void 0:N.toFixed(2)," •"," ",ca(w.duration_seconds)]})]})]}),(i==null?void 0:i.dashboard)==="3"&&e.jsx("div",{onClick:E,className:"px-2",children:e.jsxs("button",{className:"flex items-center pr-2 duration-100 rounded bg-primary text-primary-content group active:scale-95 max-sm:hidden",children:[e.jsx("span",{className:"inline-flex items-center justify-center p-2 text-sm duration-200 bg-primary-focus group-hover:text-red-500",children:e.jsx(Na,{})}),e.jsx("span",{className:"p-2 text-xs",children:"Save this search"})]})})]})};ba.propTypes={filterData:q.object.isRequired,currency:q.string};const pr=()=>{const{sortBy:c,amountType:l}=P.useState(o=>o.sorting);return e.jsxs("div",{className:"flex items-center justify-end gap-2 mb-4",children:[e.jsx("div",{className:"mr-1 text-sm font-medium text-neutral",children:"Sort by"}),e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(da,{options:[{label:"Invoice Amount",value:"invoice"},{label:"Gross Amount",value:"gross"}],defaultValue:l,className:"btn btn-primary rounded-sm normal-case font-normal min-h-0 h-10 w-[160px] !pl-6 !pr-2 cursor-pointer no-animation",action:o=>P.update(x=>{var i;x.sorting.amountType=(i=o==null?void 0:o.at(0))==null?void 0:i.value}),searchable:!1,hide_arrow:!0}),e.jsx("div",{className:"absolute text-white left-2 z-[1] text-lg pointer-events-none",children:e.jsx(Ca,{})})]}),e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(da,{options:[{label:"Cheapest",value:"cheapest"},{label:"Fastest",value:"fastest"}],defaultValue:c,className:"btn btn-primary rounded-sm normal-case font-normal min-h-0 h-10 w-[120px] !pl-6 !pr-2 cursor-pointer no-animation",action:o=>P.update(x=>{var i;x.sorting.sortBy=(i=o==null?void 0:o.at(0))==null?void 0:i.value}),searchable:!1,hide_arrow:!0}),e.jsx("div",{className:"absolute text-white left-2 z-[1] pointer-events-none",children:e.jsx(ka,{})})]})]})},ur=({filterData:c})=>{const{priceByAirlines:l,currency:o}=c,{operating:x}=P.useState();return e.jsx("div",{className:"mb-4",children:e.jsxs(or,{slidesPerView:"auto",spaceBetween:0,freeMode:!0,modules:[nr,lr,ir],mousewheel:!0,navigation:{prevEl:".btn-prev",nextEl:".btn-next"},className:"px-4 text-sm font-medium rounded shadow-custom2 bg-base-200",children:[Object.entries(x).sort((i,v)=>l[i[0]]-l[v[0]]).map(([i,v])=>e.jsxs(dr,{onClick:()=>P.update(b=>{b.operating[i]=!v}),className:`px-4 w-fit py-2 h-12 flex items-center justify-center gap-2 border-r cursor-pointer ${v?"bg-primary text-primary-content [&_p]:text-primary-content/90":"bg-base-200 [&_p]:text-neutral"}`,children:[e.jsx("img",{src:`https://gtrs-airlineimages.s3.ap-southeast-1.amazonaws.com/icon/${i}.png`,alt:"",className:"w-8 h-8 rounded-full p-0.5 border bg-base-200"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("h6",{className:"font-semibold",children:i}),e.jsxs("p",{className:"text-xs",children:[ke(o)," ",l[i]]})]})]},i)),e.jsx("button",{className:"absolute top-0 bottom-0 left-0 z-20 w-5 text-lg duration-100 !border-transparent shadow-[0_4px_16px_0_rgba(0,0,0,0.2)] bg-base-200 text-primary btn-prev hover:text-primary disabled:!opacity-100 disabled:!text-opacity-20",children:e.jsx(Oa,{})}),e.jsx("button",{className:"absolute top-0 bottom-0 right-0 z-20 w-5 text-lg duration-100 !border-transparent shadow-[0_-4px_16px_0_rgba(0,0,0,0.2)] bg-base-200 text-primary btn-next hover:text-primary disabled:!opacity-100 disabled:!text-opacity-20",children:e.jsx(xa,{})})]})})},Er=()=>{var de,ce,pe,ue,_e,re,K,F,k,A,xe,me,ge,ve,fe,Ee,Te,$e,Ie,qe,Pe,He,We,ze,Le,Je,Qe,Ve;const{axiosInstance:c}=ua(),{filteredData:l}=Ae.useState(t=>t),{price:o,duration:x,baggage_summery:i,no_stop_summery:v,cabin_class:b,aircraft_names:w,departure:M,arrival:E,operating:D,sorting:N}=P.useState(t=>t),{site_title:p,login_required:h,system_config:s,component_version:m}=De.useState(),{user_data:H}=pa.useState(),{search_result_version:S}=s||{},[u]=Da(),C=u.get("tracking_id"),R=Aa(),[G,j]=B.useState(null),{t:be}=Be(),[ee,ne]=B.useState(!1),[je,ae]=B.useState(!0),{data:a,isLoading:y,error:T}=_a(["SEARCH_RESULT",C,H==null?void 0:H.login_key],async()=>{var n,d,f,Y,W,z,$,te,L,I,U,X,Z,J,Se,Ne,we;const t=await c.get(`/flight_logs?tracking_id=${C}&base_url=${s!=null&&s.supplier_logs_file_base_url?s==null?void 0:s.supplier_logs_file_base_url:""}&login_required=${h}`);if(!C)return R("/"),null;if(((n=t==null?void 0:t.data)==null?void 0:n.status)==="success"){const Fe=await c.get("/tools/airlines-data").then(r=>Object.entries(r.data.data).map(([Me,Ce])=>({value:Me,name:Ce.airline_name})));if(t.data.airlines_data=Fe.map(r=>({label:`${r.name} (${r.value})`,value:r.value})),!((d=t.data)!=null&&d.filter_data))ne(!0),t.data.isCalenderSearch=!0;else{const r=Object.values(t.data.filter_data.carrier.operating);t.data.filter_data.airlines=Fe.filter(O=>r.includes(O.value))}const _=await c.get("/tools/airport-autosuggetion-data").then(r=>r.data);t.data.airports=_.reduce((r,O)=>(r[O.code]=O,r),{}),he.update(r=>{var O;r.modal.data=(O=t.data)==null?void 0:O.data[0]}),j((f=t.data)==null?void 0:f.message);const g={},Q={},V={};return(Y=t.data)==null||Y.data.forEach(r=>{var O,Me,Ce,Ge,Ke,Ue,Xe,Ze,Re,ea,aa,ra,ta,sa,na;(!g[(O=r==null?void 0:r.filter)==null?void 0:O.no_of_stops]||g[(Me=r==null?void 0:r.filter)==null?void 0:Me.no_of_stops]>((Ce=r==null?void 0:r.filter)==null?void 0:Ce.price))&&(g[(Ge=r==null?void 0:r.filter)==null?void 0:Ge.no_of_stops]=(Ke=r==null?void 0:r.filter)==null?void 0:Ke.price),(!Q[(Ue=r==null?void 0:r.supplier)==null?void 0:Ue.supplier_code]||Q[(Xe=r==null?void 0:r.supplier)==null?void 0:Xe.supplier_code]>((Ze=r==null?void 0:r.filter)==null?void 0:Ze.price))&&(Q[(Re=r==null?void 0:r.supplier)==null?void 0:Re.supplier_code]=(ea=r==null?void 0:r.filter)==null?void 0:ea.price),(!V[(aa=r==null?void 0:r.filter)==null?void 0:aa.carrier_operating]||V[(ra=r==null?void 0:r.filter)==null?void 0:ra.carrier_operating]>((ta=r==null?void 0:r.filter)==null?void 0:ta.price))&&(V[(sa=r==null?void 0:r.filter)==null?void 0:sa.carrier_operating]=(na=r==null?void 0:r.filter)==null?void 0:na.price)}),t.data.filter_data={...t.data.filter_data,priceByStops:g,priceBySuppliers:Q,priceByAirlines:V,currency:(te=($=(z=(W=t.data)==null?void 0:W.data[0])==null?void 0:z.price)==null?void 0:$.total)==null?void 0:te.currency,departureAirport:(X=(U=(I=(L=t.data)==null?void 0:L.data[0])==null?void 0:I.search_parameter)==null?void 0:U.departure_airport)==null?void 0:X.at(0),arrivalAirport:(Ne=(Se=(J=(Z=t.data)==null?void 0:Z.data[0])==null?void 0:J.search_parameter)==null?void 0:Se.arrival_airport)==null?void 0:Ne.at(-1)},t.data}else throw{...t,message:((we=t.data)==null?void 0:we.reason)||"Request failed!"}});B.useEffect(()=>{if(!y){if(ee){ae(!1);return}if(a){if(Object.keys(o).length===0){Ae.update(n=>{n.filteredData=a.data}),ae(!1);return}let t=[...a.data];t=t.filter(n=>n.filter.price>o.min_price&&n.filter.price<o.max_price||!o.min_price||!o.max_price),t=t.filter(n=>!(x!=null&&x.min_duration)||n.filter.journey.duration_seconds>x.min_duration&&n.filter.journey.duration_seconds<x.max_duration),t=t.filter(n=>Object.values(i).every(d=>d===!1)?!0:i[n.filter.baggage_summery]===!0),t=t.filter(n=>Object.values(v).every(d=>d===!1)?!0:v[n.filter.no_stop_summery]===!0),t=t.filter(n=>{var d;return Object.values(M).every(f=>f.value===!1)?!0:((d=M[n.filter.departure_timing_slot])==null?void 0:d.value)===!0}),t=t.filter(n=>{var d;return Object.values(E).every(f=>f.value===!1)?!0:((d=E[n.filter.arrival_timing_slot])==null?void 0:d.value)===!0}),t=t.filter(n=>Object.values(D).every(d=>d===!1)?!0:D[n.filter.carrier_operating]===!0),t=t.filter(n=>Object.values(b).every(d=>d===!1)?!0:b[n.filter.cabin_class]===!0),t=t.filter(n=>Object.values(w).every(d=>d===!1)?!0:w[n.filter.aircraft_name]===!0),t=t.map(n=>{var f;return{...n,package_count:((f=[...t].filter(Y=>(Y==null?void 0:Y.filter_unique_filter_code)===(n==null?void 0:n.filter_unique_filter_code)))==null?void 0:f.length)||1}}),t=S==="6"?t.reduce((n,d)=>{var L,I,U,X;const f={...d},{journey_type:Y,result_type:W,flight_group:z,supplier:$}=f||{},te=(X=(U=(I=(L=z==null?void 0:z.at(0))==null?void 0:L.routes)==null?void 0:I.at(0))==null?void 0:U.operating)==null?void 0:X.carrier;if(W==="general"&&Y==="OneWay"&&te==="FZ"&&($==null?void 0:$.supplier_code)==="flydubai"){const Z=n.findIndex(J=>(J==null?void 0:J.special_name)==="showkat");Z===-1?(f.special_name="showkat",f.result_type="group",f.round_group=[{group:{flight_option:"OneWay",data:[d]}}],n.push(f)):n[Z].round_group[0].group.data.push(f)}else n.push(f);return n},[]):t,t.sort((n,d)=>N.sortBy==="cheapest"?n.filter.price-d.filter.price:n.filter.journey.duration_seconds-d.filter.journey.duration_seconds),Ae.update(n=>{n.filteredData=t})}ae(!1)}},[o,x,a,i,v,M,E,D,N,w,b,y,S,ee]);const ie=a==null?void 0:a.isCalenderSearch;B.useEffect(()=>{var t;if(((t=a==null?void 0:a.data)==null?void 0:t.length)>0){const{search_parameter:{journey_type:n,non_stop_flight:d,baggage_option:f,booking_class:Y,segment:W,travelers_adult:z,travelers_child:$,travelers_child_age:te,travelers_infants:L,travelers_infants_age:I,preferred_carrier:U,supplier_uid:X,fare_type:Z,fare_corporate_code:J,travelers_ptc:Se,fare_option:Ne,partner_id:we,fare_account_code:Fe}}=a.data[0];Oe.update(_=>{_.search_option=ie?"calendar":"standard",_.partner_id=we,_.fare_type=Z,_.fare_corporate_code=J,_.fare_account_code=Fe,_.travelers_ptc=Se,_.fare_option=Ne,_.journey_type=n,_.non_stop_flight=d,_.baggage_option=f,_.booking_class=Y,_.travelers_adult=Number(z)||0,_.travelers_child=Number($)||0,_.travelers_child_age=te.slice(0,Number($))||[],_.travelers_infants=Number(L)||0,_.travelers_infants_age=(I==null?void 0:I.slice(0,Number(L)))||[],W.forEach((g,Q)=>{_.segment[Q]={...g,departure_airport_type:g.departure_airport_type,departure_airport:g.departure_airport_type==="AIRPORT"?a.airports[g.departure_airport]:Object.values(a.airports).find(V=>V.city_code===g.departure_airport),arrival_airport_type:g.arrival_airport_type,arrival_airport:g.arrival_airport_type==="AIRPORT"?a.airports[g.arrival_airport]:Object.values(a.airports).find(V=>V.city_code===g.arrival_airport)}}),_.flight_count=W.length>2?W.length:2,_.supplier_uid=X}),Oe.update(_=>{_.preferred_carrier=U.map(g=>a.airlines_data.find(Q=>Q.value===g))||[]}),le(!1)}},[a,ie]);const oe=Ya.useMediaQuery({query:"(max-width: 640px)"}),[ye,le]=B.useState(!1);if(T)throw T;return e.jsxs("main",{className:"container min-h-screen pt-20 mb-12",children:[e.jsx(va,{children:e.jsxs("title",{children:["Flight Search",p?" - "+p:""]})}),oe&&e.jsxs(rr,{open:ye,onOpenChange:le,children:[e.jsx(tr,{asChild:!0,children:e.jsxs("button",{className:"flex items-center justify-center w-full gap-2 px-5 py-4 mb-3 duration-100 rounded-md shadow-custom2 bg-base-200 hover:text-primary",children:[e.jsx(Ba,{}),e.jsx("span",{children:be("modify_search")})]})}),e.jsx(sr,{children:e.jsx("div",{className:"max-h-[90vh] overflow-auto",children:!y&&(a!=null&&a.filter_data)?((de=m==null?void 0:m.flight)==null?void 0:de.search_box)==="2"?e.jsx(ia,{}):e.jsx(oa,{}):e.jsx(la,{})})})]}),e.jsxs("button",{onClick:()=>he.update(t=>{t.flight_search_sidebar.mobile.isActive=!0}),className:"flex items-center justify-center w-full gap-2 px-5 py-4 duration-100 rounded-md shadow-custom2 bg-base-200 hover:text-primary lg:hidden",children:[e.jsx(Ea,{}),e.jsx("span",{children:be("Filters")})]}),!oe&&e.jsx(e.Fragment,{children:!y&&(a!=null&&a.filter_data)?((ce=m==null?void 0:m.flight)==null?void 0:ce.search_box)==="2"?e.jsx(ia,{}):((pe=m==null?void 0:m.flight)==null?void 0:pe.search_box)==="3"?e.jsx(Ga,{}):e.jsx(oa,{}):e.jsx(la,{})}),((re=(_e=(ue=a==null?void 0:a.data)==null?void 0:ue.at(0))==null?void 0:_e.search_parameter)==null?void 0:re.journey_type)!=="MultiCity"&&((K=a==null?void 0:a.data)==null?void 0:K.length)>0&&e.jsx(ha,{search_parameter:(F=a==null?void 0:a.data[0])==null?void 0:F.search_parameter,calendarSearch:ee,setCalendarSearch:ne,isCalenderSearch:a==null?void 0:a.isCalenderSearch}),!y&&(a==null?void 0:a.filter_data)&&G&&e.jsx("div",{className:"mb-4 overflow-hidden border rounded-md shadow bg-base-200 border-warning animate-pulse",children:e.jsxs("div",{className:"relative px-3 py-2 bg-warning/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"py-1 text-warning",children:e.jsx(wa,{className:"text-xl"})}),e.jsx("div",{children:e.jsx("p",{className:"text-xs font-normal",children:G})})]}),e.jsx("button",{onClick:()=>j(null),className:"absolute top-1 right-1 btn btn-ghost btn-circle btn-sm !bg-transparent",children:e.jsx(Ta,{})})]})}),!ee&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 mt-5 mb-5 lg:grid-cols-4",children:[!y&&(a!=null&&a.filter_data)?((k=m==null?void 0:m.flight)==null?void 0:k.search_filter)==="2"?e.jsx(Ka,{filterData:a.filter_data,additionalData:{date:(xe=(A=a.data[0])==null?void 0:A.search_parameter)==null?void 0:xe.departure_date[0],departure_from:(ge=(me=a.data[0])==null?void 0:me.search_parameter)==null?void 0:ge.departure_airport[0],arrival_to:(Ee=(fe=(ve=a.data[0])==null?void 0:ve.search_parameter)==null?void 0:fe.arrival_airport)==null?void 0:Ee.at(-1),total_fight:(l==null?void 0:l.length)||0,journey_type:($e=(Te=a.data[0])==null?void 0:Te.search_parameter)==null?void 0:$e.journey_type,tracking_id:C}}):e.jsx(Ua,{filterData:a.filter_data,additionalData:{date:(qe=(Ie=a.data[0])==null?void 0:Ie.search_parameter)==null?void 0:qe.departure_date[0],departure_from:(He=(Pe=a.data[0])==null?void 0:Pe.search_parameter)==null?void 0:He.departure_airport[0],arrival_to:(Le=(ze=(We=a.data[0])==null?void 0:We.search_parameter)==null?void 0:ze.arrival_airport)==null?void 0:Le.at(-1),total_fight:(l==null?void 0:l.length)||0,journey_type:(Qe=(Je=a.data[0])==null?void 0:Je.search_parameter)==null?void 0:Qe.journey_type,tracking_id:C}}):e.jsx(er,{}),e.jsx("section",{className:"lg:col-span-3",children:e.jsxs("div",{children:[!y&&(a!=null&&a.filter_data)?S==="7"?e.jsx(pr,{}):e.jsx(ba,{filterData:a.filter_data,currency:a==null?void 0:a.currency,search_parameter:(Ve=a==null?void 0:a.data[0])==null?void 0:Ve.search_parameter}):e.jsx("div",{className:"h-20 mb-5 skeleton-box"}),!y&&(a==null?void 0:a.filter_data)&&e.jsx(ur,{filterData:a==null?void 0:a.filter_data}),je?e.jsx(ar,{}):e.jsx(Xa,{})]})})]})]})};export{Er as default};
